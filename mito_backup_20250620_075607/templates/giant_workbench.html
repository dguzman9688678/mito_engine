<!--
MITO Engine - AI Agent & Tool Creator
Name: MITO Engine
Version: 1.2.0
Created by: Daniel Guzman
Contact: guzman.danield@outlook.com
Description: AI Agent & Tool Creator
-->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, shrink-to-fit=no">
    <title>MITO Engine - Giant AI Workbench</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/vs2015.min.css">
    <style>
        :root {
            --primary-bg: #0f172a;
            --secondary-bg: #1e293b;
            --accent-bg: #334155;
            --text-primary: #f1f5f9;
            --text-secondary: #cbd5e1;
            --accent-color: #3b82f6;
            --success-color: #10b981;
            --warning-color: #f59e0b;
            --danger-color: #ef4444;
            --vh: 1vh;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        html, body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--primary-bg);
            color: var(--text-primary);
            margin: 0;
            padding: 0;
            height: 100vh;
            width: 100vw;
            overflow: hidden;
            -webkit-text-size-adjust: 100%;
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            user-select: none;
        }

        /* Tabs Navigation */
        .workbench-tabs {
            background: var(--secondary-bg);
            display: flex;
            align-items: center;
            padding: 0 20px;
            border-bottom: 1px solid var(--accent-bg);
            flex-shrink: 0;
            overflow-x: auto;
            scrollbar-width: none;
            -ms-overflow-style: none;
        }

        .workbench-tabs::-webkit-scrollbar {
            display: none;
        }

        .tab-item {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 12px 20px;
            cursor: pointer;
            white-space: nowrap;
            border-bottom: 2px solid transparent;
            color: var(--text-secondary);
            transition: all 0.2s ease;
            font-weight: 500;
            font-size: 0.9rem;
            position: relative;
        }

        .tab-item:hover {
            color: var(--text-primary);
            background: rgba(59, 130, 246, 0.1);
        }

        .tab-item.active {
            color: var(--accent-color);
            border-bottom-color: var(--accent-color);
            background: rgba(59, 130, 246, 0.05);
        }

        .tab-item .tab-icon {
            font-size: 1rem;
        }

        .tab-close {
            margin-left: 5px;
            padding: 2px 5px;
            border: none;
            background: none;
            color: var(--text-secondary);
            cursor: pointer;
            opacity: 0;
            transition: opacity 0.2s;
            font-size: 0.8rem;
        }

        .tab-item:hover .tab-close {
            opacity: 1;
        }

        .tab-close:hover {
            color: var(--danger-color);
        }

        .new-tab-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 40px;
            height: 40px;
            margin-left: 10px;
            background: var(--accent-bg);
            border: none;
            border-radius: 6px;
            color: var(--text-secondary);
            cursor: pointer;
            transition: all 0.2s;
        }

        .new-tab-btn:hover {
            background: var(--accent-color);
            color: white;
        }

        /* Tab Content Panels */
        .tab-content {
            display: none;
            width: 100%;
            height: 100%;
            overflow: hidden;
        }

        .tab-content.active {
            display: block;
        }

        /* Giant Workbench Layout */
        .giant-workbench {
            display: flex;
            flex-direction: column;
            height: 100vh;
            min-height: -webkit-fill-available;
            width: 100vw;
            background: var(--primary-bg);
            overflow: hidden;
        }

        /* Header Bar */
        .workbench-header {
            background: var(--secondary-bg);
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 15px 20px;
            border-bottom: 1px solid var(--accent-bg);
            flex-shrink: 0;
            min-height: 60px;
        }

        .workbench-logo {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 1.2rem;
            font-weight: bold;
        }

        .workbench-controls {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .control-btn {
            background: none;
            border: none;
            color: var(--text-secondary);
            padding: 8px 12px;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 0.9rem;
            font-weight: 500;
        }

        .control-btn:hover {
            color: var(--text-primary);
            background: rgba(255, 255, 255, 0.1);
        }

        .header-link:hover {
            color: var(--text-primary) !important;
            background: rgba(255, 255, 255, 0.1) !important;
        }

        .workbench-navbar {
            background: var(--accent-bg);
            display: flex;
            gap: 15px;
            padding: 10px 20px;
            overflow-x: auto;
            border-bottom: 1px solid var(--text-secondary);
            flex-shrink: 0;
            -webkit-overflow-scrolling: touch;
            white-space: nowrap;
        }

        .nav-link {
            color: var(--text-primary);
            text-decoration: none;
            padding: 4px 8px;
            border-radius: 4px;
            transition: background-color 0.2s;
        }

        .nav-link:hover {
            background: var(--accent-bg);
            text-decoration: none;
        }

        .nav-link.active {
            background: var(--accent-color);
            color: white;
        }



        /* Main Work Area */
        .workbench-main {
            background: var(--primary-bg);
            padding: 20px;
            overflow-y: auto;
            position: relative;
            flex: 1;
            min-height: 0;
        }

        .workspace-canvas {
            background: rgba(255, 255, 255, 0.02);
            border-radius: 12px;
            padding: 30px;
            min-height: 300px;
            border: 1px solid var(--accent-bg);
        }

        /* Secondary Area */
        .workbench-secondary {
            grid-area: secondary-area;
            background: var(--secondary-bg);
            padding: 20px;
            overflow-y: auto;
            border-left: 1px solid var(--accent-bg);
            border-right: 1px solid var(--accent-bg);
        }

        /* Tools Panel */
        .workbench-tools {
            grid-area: tools;
            background: var(--secondary-bg);
            padding: 20px;
            overflow-y: auto;
        }

        /* Footer Status Bar */
        .workbench-footer {
            grid-area: footer;
            background: var(--secondary-bg);
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 20px;
            border-top: 1px solid var(--accent-bg);
            font-size: 0.8rem;
            color: var(--text-secondary);
        }

        .status-left, .status-center, .status-right {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .separator {
            color: var(--accent-bg);
            margin: 0 4px;
        }

        #current-project {
            color: var(--accent-color);
            font-weight: 600;
        }

        #current-file {
            color: var(--text-primary);
        }

        #workspace-status {
            color: var(--success-color);
        }

        #ai-status {
            color: var(--text-primary);
        }

        #auto-save-status {
            color: var(--success-color);
        }

        #current-time {
            color: var(--text-secondary);
            font-family: monospace;
        }

        /* Settings Modal Fixes */
        #settings-modal {
            overflow-y: auto !important;
            -webkit-overflow-scrolling: touch;
        }

        #settings-modal > div {
            overflow-y: auto !important;
            max-height: calc(100vh - 80px) !important;
        }

        .workbench-card {
            margin: 15px 0 !important;
        }

        .workbench-card h5 {
            margin-bottom: 15px;
            color: var(--accent-color);
            font-size: 1.1rem;
        }

        /* Override Bootstrap card backgrounds to match dark theme */
        .card {
            background: var(--secondary-bg) !important;
            border: 1px solid var(--accent-bg) !important;
            color: var(--text-primary) !important;
        }

        .card-header {
            background: var(--accent-bg) !important;
            border-bottom: 1px solid var(--border-color) !important;
            color: var(--text-primary) !important;
        }

        .card-body {
            background: var(--secondary-bg) !important;
            color: var(--text-primary) !important;
        }

        /* Form controls in dark theme */
        .form-control {
            background: var(--accent-bg) !important;
            border: 1px solid var(--border-color) !important;
            color: var(--text-primary) !important;
        }

        .form-control:focus {
            background: var(--accent-bg) !important;
            border-color: var(--accent-color) !important;
            box-shadow: 0 0 0 0.2rem rgba(59, 130, 246, 0.25) !important;
            color: var(--text-primary) !important;
        }

        .form-control::placeholder {
            color: var(--text-secondary) !important;
        }

        /* Card Components */
        .workbench-card {
            background: var(--secondary-bg);
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            border: 1px solid var(--accent-bg);
        }

        .workbench-card h5 {
            color: var(--accent-color);
            margin-bottom: 15px;
        }

        /* Phase Progress */
        .phase-indicator {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 20px;
        }

        .phase-step {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8rem;
            font-weight: bold;
        }

        .phase-step.completed {
            background: var(--success-color);
        }

        .phase-step.active {
            background: var(--warning-color);
        }

        .phase-step.pending {
            background: var(--accent-bg);
        }

        .phase-line {
            flex: 1;
            height: 2px;
            background: var(--accent-bg);
        }

        /* AI Chat Integration */
        .chat-modal {
            display: none;
            position: fixed;
            top: 70px;
            right: 20px;
            width: 420px;
            height: calc(100vh - 120px);
            background: var(--primary-bg);
            border-radius: 12px;
            border: 1px solid var(--border-color);
            z-index: 1000;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
            resize: both;
            overflow: hidden;
            min-width: 300px;
            min-height: 400px;
            max-width: 800px;
        }

        .chat-modal.active {
            display: flex;
            flex-direction: column;
        }

        .chat-container {
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            position: relative;
        }

        /* Resize handle for better UX */
        .chat-modal::after {
            content: '';
            position: absolute;
            bottom: 0;
            right: 0;
            width: 20px;
            height: 20px;
            background: linear-gradient(-45deg, transparent 30%, var(--accent-color) 30%, var(--accent-color) 40%, transparent 40%, transparent 60%, var(--accent-color) 60%, var(--accent-color) 70%, transparent 70%);
            cursor: nw-resize;
        }

        .chat-header {
            padding: 12px 15px;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: var(--secondary-bg);
            cursor: move;
            user-select: none;
        }

        .chat-title {
            font-weight: 600;
            color: var(--accent-color);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .chat-controls {
            display: flex;
            gap: 5px;
        }

        .chat-control-btn {
            background: none;
            border: none;
            color: var(--text-secondary);
            font-size: 16px;
            cursor: pointer;
            padding: 4px;
            border-radius: 3px;
            transition: all 0.2s;
        }

        .chat-control-btn:hover {
            background: var(--accent-bg);
            color: var(--text-primary);
        }

        .chat-modal.minimized {
            height: 45px;
            resize: none;
        }

        .chat-modal.minimized .mito-chat {
            display: none;
        }

        .mito-chat {
            flex: 1;
            display: flex;
            flex-direction: column;
            padding: 15px;
        }

        .chat-messages {
            flex: 1;
            overflow-y: auto;
            margin-bottom: 15px;
            padding: 15px;
            background: rgba(255, 255, 255, 0.02);
            border-radius: 8px;
            min-height: 300px;
            max-height: 400px;
            scrollbar-width: thin;
            scrollbar-color: var(--accent-color) transparent;
        }
        
        .chat-messages::-webkit-scrollbar {
            width: 6px;
        }
        
        .chat-messages::-webkit-scrollbar-track {
            background: transparent;
        }
        
        .chat-messages::-webkit-scrollbar-thumb {
            background: var(--accent-color);
            border-radius: 3px;
        }

        .chat-input {
            display: flex;
            gap: 10px;
        }

        .chat-input input {
            flex: 1;
            background: var(--accent-bg);
            border: none;
            color: var(--text-primary);
            padding: 10px;
            border-radius: 6px;
        }

        .chat-input button {
            background: var(--accent-color);
            border: none;
            color: white;
            padding: 10px 15px;
            border-radius: 6px;
            cursor: pointer;
        }

        /* Code Editor */
        .code-editor {
            background: #1a1a1a;
            border-radius: 8px;
            padding: 15px;
            font-family: 'Consolas', 'Monaco', monospace;
            height: 400px;
            overflow-y: auto;
            border: 1px solid var(--accent-bg);
        }

        /* File Explorer */
        .file-explorer {
            background: var(--primary-bg);
            border-radius: 8px;
            padding: 15px;
            height: 250px;
            overflow-y: auto;
        }

        .file-item {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 6px;
            border-radius: 4px;
            cursor: pointer;
            margin-bottom: 2px;
        }

        .file-item:hover {
            background: var(--accent-bg);
        }

        /* System Monitor */
        .system-stats {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 20px;
        }

        .stat-item {
            background: var(--primary-bg);
            padding: 15px;
            border-radius: 8px;
            text-align: center;
        }

        .stat-value {
            font-size: 1.5rem;
            font-weight: bold;
            color: var(--accent-color);
        }

        .stat-label {
            font-size: 0.8rem;
            color: var(--text-secondary);
        }

        /* Button Styles */
        .btn-primary {
            background: var(--accent-color);
            border: none;
            color: white;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .btn-primary:hover {
            background: #2563eb;
        }

        .btn-success {
            background: var(--success-color);
            border: none;
            color: white;
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
        }

        .btn-warning {
            background: var(--warning-color);
            border: none;
            color: white;
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
        }

        /* Responsive Design */
        @media (max-width: 1400px) {
            .giant-workbench {
                grid-template-columns: 220px 1fr 350px 250px;
            }
        }

        @media (max-width: 1200px) {
            .giant-workbench {
                grid-template-areas: 
                    "header header header"
                    "sidebar main-area tools"
                    "sidebar main-area tools"
                    "footer footer footer";
                grid-template-columns: 200px 1fr 280px;
            }
            .workbench-secondary {
                display: none;
            }
        }

        @media (max-width: 900px) {
            .giant-workbench {
                grid-template-areas: 
                    "header header"
                    "main-area tools"
                    "main-area tools"
                    "footer footer";
                grid-template-columns: 1fr 250px;
            }
            .workbench-sidebar {
                display: none;
            }
        }

        /* Scrollbars */
        ::-webkit-scrollbar {
            width: 6px;
            height: 6px;
        }

        ::-webkit-scrollbar-track {
            background: var(--accent-bg);
        }

        ::-webkit-scrollbar-thumb {
            background: var(--accent-color);
            border-radius: 3px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #2563eb;
        }

        /* Mobile Responsive Design - Optimized for all devices */
        @media screen and (max-width: 768px) {
            html {
                height: 100%;
                height: -webkit-fill-available;
            }
            
            body {
                height: 100%;
                height: -webkit-fill-available;
                position: relative;
                overflow: hidden;
            }
            
            .giant-workbench {
                height: 100%;
                height: -webkit-fill-available;
                width: 100%;
                position: relative;
                overflow: hidden;
            }
            
            .workbench-header {
                flex-shrink: 0;
                padding: 8px 12px;
                min-height: 60px;
                display: flex;
                flex-direction: column;
                justify-content: center;
                align-items: center;
                gap: 8px;
            }
            
            .workbench-logo {
                font-size: 1.1rem;
                font-weight: 600;
                text-align: center;
            }
            
            .workbench-controls {
                display: flex;
                justify-content: center;
                flex-wrap: wrap;
                gap: 6px;
            }
            
            .control-btn {
                padding: 6px 12px;
                font-size: 12px;
                min-width: 60px;
                border-radius: 4px;
                white-space: nowrap;
                touch-action: manipulation;
                -webkit-tap-highlight-color: rgba(0,0,0,0);
                user-select: none;
            }
            
            .workbench-navbar {
                flex-shrink: 0;
                padding: 8px 6px;
                display: flex;
                gap: 6px;
                overflow-x: auto;
                overflow-y: hidden;
                -webkit-overflow-scrolling: touch;
                scrollbar-width: none;
                -ms-overflow-style: none;
                white-space: nowrap;
            }
            
            .workbench-navbar::-webkit-scrollbar {
                display: none;
            }
            
            .nav-link {
                flex-shrink: 0;
                padding: 8px 10px;
                font-size: 11px;
                white-space: nowrap;
                border-radius: 4px;
                touch-action: manipulation;
                -webkit-tap-highlight-color: rgba(0,0,0,0);
                user-select: none;
                min-width: fit-content;
            }
            
            .workbench-main {
                flex: 1;
                min-height: 0;
                padding: 8px;
                overflow-y: auto;
                overflow-x: hidden;
                -webkit-overflow-scrolling: touch;
                position: relative;
            }
            
            .workspace-canvas {
                padding: 12px;
                min-height: 200px;
                border-radius: 6px;
                overflow: visible;
            }
        }

        /* Ultra-small screens (phones in portrait) */
        @media screen and (max-width: 480px) {
            .workbench-header {
                padding: 6px 8px;
                min-height: 50px;
            }
            
            .workbench-logo {
                font-size: 1rem;
            }
            
            .control-btn {
                padding: 4px 8px;
                font-size: 11px;
                min-width: 50px;
            }
            
            .workbench-navbar {
                padding: 6px 4px;
                gap: 4px;
            }
            
            .nav-link {
                padding: 6px 8px;
                font-size: 10px;
            }
            
            .workbench-main {
                padding: 6px;
            }
            
            .workspace-canvas {
                padding: 8px;
                min-height: 150px;
            }
        }

        /* Touch and mobile-specific optimizations */
        @media (pointer: coarse) {
            .control-btn, .nav-link, button {
                min-height: 44px;
                min-width: 44px;
                touch-action: manipulation;
                -webkit-tap-highlight-color: rgba(0,0,0,0);
            }
        }

        /* Animations */
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        /* Context Menu */
        .context-menu {
            position: fixed;
            background: var(--secondary-bg);
            border: 1px solid var(--accent-bg);
            border-radius: 8px;
            padding: 5px 0;
            z-index: 10000;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
            display: none;
        }

        .context-menu-item {
            padding: 8px 16px;
            cursor: pointer;
            color: var(--text-primary);
            font-size: 0.9rem;
            border: none;
            background: none;
            width: 100%;
            text-align: left;
        }

        .context-menu-item:hover {
            background: var(--accent-bg);
        }

        .context-menu-item:disabled {
            color: var(--text-secondary);
            cursor: not-allowed;
        }

        /* Landscape orientation on mobile */
        @media screen and (max-width: 768px) and (orientation: landscape) {
            .workbench-header {
                flex-direction: row;
                justify-content: space-between;
                padding: 4px 8px;
                min-height: 40px;
            }
            
            .workbench-logo {
                font-size: 0.9rem;
            }
            
            .control-btn {
                padding: 4px 6px;
                font-size: 10px;
                min-width: 40px;
            }
        }

        /* Ensure horizontal scrolling for navbar on small screens */
        .workbench-navbar {
            scrollbar-width: thin;
            scrollbar-color: var(--accent-color) transparent;
        }

        .workbench-navbar::-webkit-scrollbar {
            height: 4px;
        }

        .workbench-navbar::-webkit-scrollbar-track {
            background: transparent;
        }

        .workbench-navbar::-webkit-scrollbar-thumb {
            background: var(--accent-color);
            border-radius: 2px;
        }
    </style>
</head>
<body>
    <div class="giant-workbench">
        <!-- Header -->
        <div class="workbench-header">
            <div class="workbench-logo">
                <span>MITO Engine</span>
            </div>
            <div class="workbench-controls">
                <div class="header-controls" style="display: flex; gap: 20px; margin-right: 20px; font-size: 0.85rem;">
                    <a href="#" onclick="toggleNotifications()" style="color: var(--text-secondary); text-decoration: none; padding: 8px 12px; transition: all 0.2s; position: relative;" class="header-link">
                        Notifications <span id="header-notification-count" style="background: var(--danger-color); border-radius: 50%; padding: 2px 6px; font-size: 0.7rem; margin-left: 4px; display: none;">0</span>
                    </a>
                    <a href="#" onclick="toggleChat()" style="color: var(--text-secondary); text-decoration: none; padding: 8px 12px; transition: all 0.2s;" class="header-link">Chat</a>
                    <a href="#" onclick="toggleSettings()" style="color: var(--text-secondary); text-decoration: none; padding: 8px 12px; transition: all 0.2s;" class="header-link">Settings</a>
                </div>
                <button class="control-btn" onclick="toggleFullscreen()">
                    Fullscreen
                </button>
                <button class="control-btn" onclick="saveWorkspace()">
                    Save
                </button>
                <button class="control-btn" onclick="toggleTheme()">
                    Theme
                </button>
                <div class="stat-value" style="font-size: 0.9rem;">Phase 6/6</div>
            </div>
        </div>

        <!-- Horizontal Navigation Bar -->
        <div class="workbench-navbar" style="background: var(--sidebar-bg); border-bottom: 1px solid var(--border-color); padding: 8px 20px; display: flex; gap: 15px; align-items: center; font-size: 0.85rem; flex-wrap: wrap;">
            <a href="#" onclick="switchTool('ai-factory')" class="nav-link active">AI Factory</a>
            <a href="#" onclick="switchTool('code-generator')" class="nav-link">Code Generator</a>
            <a href="#" onclick="switchTool('model-trainer')" class="nav-link">Model Trainer</a>
            <a href="#" onclick="switchTool('nlu-processor')" class="nav-link">NLU Processor</a>
            <a href="#" onclick="switchTool('phase-manager')" class="nav-link">Phase Manager</a>
            <a href="#" onclick="switchTool('project-templates')" class="nav-link">Templates</a>
            <a href="#" onclick="switchTool('agent-builder')" class="nav-link">Agent Builder</a>
            <a href="#" onclick="switchTool('ecosystem-orchestrator')" class="nav-link">Ecosystem</a>
            <a href="#" onclick="switchTool('file-manager')" class="nav-link">File Manager</a>
            <a href="#" onclick="switchTool('database-manager')" class="nav-link">Database</a>
            <a href="#" onclick="switchTool('deployment-manager')" class="nav-link">Deploy</a>

            <a href="#" onclick="switchTool('code-editor')" class="nav-link" style="background: linear-gradient(45deg, #3b82f6, #8b5cf6); padding: 8px 16px; border-radius: 6px; color: white; font-weight: bold; animation: pulse 2s infinite;">💻 Code Editor</a>
            <a href="#" onclick="switchTool('file-browser')" class="nav-link" style="background: linear-gradient(45deg, #f59e0b, #d97706); padding: 8px 16px; border-radius: 6px; color: white; font-weight: bold;">🗂️ Files</a>
            <a href="#" onclick="switchTool('image-generator')" class="nav-link">Images</a>
            <a href="#" onclick="switchTool('whiteboard')" class="nav-link">Whiteboard</a>
            <a href="#" onclick="switchTool('terminal')" class="nav-link">Terminal</a>
            <a href="#" onclick="switchTool('package-manager')" class="nav-link">Packages</a>
            <a href="#" onclick="switchTool('api-tester')" class="nav-link">API Test</a>
            <a href="#" onclick="switchTool('utilities')" class="nav-link">Utils</a>
            <a href="#" onclick="switchTool('system-monitor')" class="nav-link">Monitor</a>
            <a href="#" onclick="switchTool('knowledge-base')" class="nav-link">Knowledge</a>
            <a href="#" onclick="switchTool('collaboration')" class="nav-link">Live Collab</a>
        </div>

        <!-- Main Work Area -->
        <div class="workbench-main">
            <div class="workspace-canvas" id="main-canvas" style="height: calc(100vh - 120px); overflow-y: auto;">
                <!-- AI Factory Interface -->
                <div id="ai-factory-workspace" class="workspace-content">
                    <h3>AI Factory - Create Intelligent Applications</h3>
                    
                    <!-- Code Editor Location Notice -->
                    <div style="background: linear-gradient(45deg, #3b82f6, #8b5cf6); padding: 15px; border-radius: 8px; margin-bottom: 20px; text-align: center;">
                        <h5 style="color: white; margin: 0; display: flex; align-items: center; justify-content: center; gap: 10px;">
                            <i class="fas fa-arrow-up"></i>
                            💻 MITO Code Editor is located in the navigation bar above
                            <i class="fas fa-arrow-up"></i>
                        </h5>
                        <p style="color: rgba(255,255,255,0.9); margin: 5px 0 0 0; font-size: 0.9rem;">
                            Click the highlighted "💻 Code Editor" button in the top navigation to access the full editor with copy/paste functionality
                        </p>
                    </div>
                    
                    <!-- Current Project Phase -->
                    <div class="phase-indicator">
                        <div class="phase-step completed">1</div>
                        <div class="phase-line"></div>
                        <div class="phase-step completed">2</div>
                        <div class="phase-line"></div>
                        <div class="phase-step completed">3</div>
                        <div class="phase-line"></div>
                        <div class="phase-step completed">4</div>
                        <div class="phase-line"></div>
                        <div class="phase-step completed">5</div>
                        <div class="phase-line"></div>
                        <div class="phase-step completed">6</div>
                    </div>

                    <div class="workbench-card">
                        <h5>Current Phase: Production Ready (100% Complete)</h5>
                        <p>MITO autonomous agent fully operational with complete live collaboration system, all AI providers configured, and ready for business deployment.</p>
                        
                        <div style="margin: 20px 0;">
                            <div style="background: var(--accent-bg); height: 8px; border-radius: 4px; overflow: hidden;">
                                <div style="background: var(--success-color); height: 100%; width: 100%; transition: width 0.3s;"></div>
                            </div>
                        </div>

                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                            <button class="btn-success" onclick="testCollaboration()">Test Live Collab</button>
                            <button class="btn-primary" onclick="deployToProduction()">Ready for Deploy</button>
                        </div>
                    </div>

                    <!-- AI Configuration Panel -->
                    <div class="workbench-card">
                        <h5>AI Functions Configuration</h5>
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 10px; margin-bottom: 20px;">
                            <label style="display: flex; align-items: center; gap: 8px; padding: 10px; background: var(--accent-bg); border-radius: 6px;">
                                <input type="checkbox" checked>
                                <span>Search & Retrieval</span>
                            </label>
                            <label style="display: flex; align-items: center; gap: 8px; padding: 10px; background: var(--accent-bg); border-radius: 6px;">
                                <input type="checkbox" checked>
                                <span>NLP Processing</span>
                            </label>
                            <label style="display: flex; align-items: center; gap: 8px; padding: 10px; background: var(--accent-bg); border-radius: 6px;">
                                <input type="checkbox">
                                <span>Image Analysis</span>
                            </label>
                            <label style="display: flex; align-items: center; gap: 8px; padding: 10px; background: var(--accent-bg); border-radius: 6px;">
                                <input type="checkbox">
                                <span>Recommendations</span>
                            </label>
                        </div>
                        
                        <button class="btn-primary" onclick="generateCustomAI()">Generate AI Application</button>
                    </div>

                    <!-- Generated Code Preview -->
                    <div class="workbench-card" style="border: 2px solid var(--accent-color);">
                        <h5 style="display: flex; align-items: center; gap: 10px;"><i class="fas fa-code"></i>Generated Code Preview</h5>
                        <div class="code-editor" id="main-code-display" style="background: #1a1a1a; padding: 15px; border-radius: 8px; min-height: 300px; font-family: 'Consolas', 'Monaco', monospace; color: #f1f5f9; white-space: pre-wrap; overflow: auto; border: 1px solid #444;">
                            <div style="color: #6a9955; text-align: center; padding: 40px; font-size: 16px;">💻 Ask MITO to "generate code for..." and it will appear here</div>
                            <div style="color: #c586c0;">class</div> <span style="color: #4ec9b0;">SearchEngine</span>:
                            <div style="margin-left: 20px;">
                                <div style="color: #c586c0;">def</div> <span style="color: #dcdcaa;">__init__</span>(self):
                                <div style="margin-left: 20px;">
                                    <div>self.index = faiss.IndexFlatIP(768)</div>
                                    <div>self.model = AutoModel.from_pretrained('sentence-transformers/all-MiniLM-L6-v2')</div>
                                </div>
                            </div>
                            <br>
                            <div style="color: #6a9955;"># Continue development in Phase 3...</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Secondary Area -->
        <div class="workbench-secondary" style="display: none;">
        </div>

        <!-- Tools Panel -->
        <div class="workbench-tools" style="display: none;">
        </div>

        <!-- Footer Status Bar -->
        <div class="workbench-footer">
            <div class="status-left">
                <span id="current-project">AI Search Engine Project</span>
                <span class="separator">|</span>
                <span id="current-phase">Phase 2 of 6: Architecture Design</span>
                <span class="separator">|</span>
                <span id="current-file">No file selected</span>
            </div>
            <div class="status-center">
                <span id="workspace-status">Ready</span>
                <span class="separator">|</span>
                <span id="ai-status">Connected to Local AI</span>
            </div>
            <div class="status-right">
                <span id="auto-save-status">Auto-save: On</span>
                <span class="separator">|</span>
                <span id="current-time"></span>
            </div>
        </div>
    </div>

    <!-- Chat Modal -->
    <div id="chat-modal" class="chat-modal">
        <div class="chat-container">
            <div class="chat-header">
                <div class="chat-title">
                    <span>MITO Assistant</span>
                </div>
                <div class="chat-controls">
                    <button class="chat-control-btn" onclick="minimizeChat()" title="Minimize">−</button>
                    <button class="chat-control-btn" onclick="toggleChat()" title="Close">×</button>
                </div>
            </div>
            <div class="mito-chat">
                <div class="chat-messages" id="chat-messages">
                    <div style="margin-bottom: 10px; padding: 12px; background: var(--primary-bg); border-radius: 8px; border-left: 3px solid var(--accent-color);">
                        <strong>MITO:</strong> I'm ready to assist with your AI development. What would you like to work on?
                    </div>
                </div>
                <div class="chat-input">
                    <input type="text" placeholder="Ask MITO anything..." id="chat-input" style="padding: 12px; background: var(--accent-bg); border: 1px solid var(--border-color); color: var(--text-primary); border-radius: 6px;" onkeypress="if(event.key==='Enter') sendChatMessage()">
                    <button onclick="sendChatMessage()" class="control-btn" style="background: var(--accent-color); padding: 12px 20px;">Send</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Settings Modal -->
    <div id="settings-modal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 1000; overflow-y: auto;" onclick="if(event.target === this) closeSettings()">
        <div style="position: relative; top: 20px; left: 50%; transform: translateX(-50%); background: var(--primary-bg); padding: 30px; border-radius: 10px; max-width: 700px; width: 90%; border: 1px solid var(--border-color); margin-bottom: 40px; max-height: calc(100vh - 80px); overflow-y: auto;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                <h3 style="margin: 0;">MITO Engine Settings</h3>
                <button onclick="closeSettings()" style="background: none; border: none; color: var(--text-secondary); font-size: 24px; cursor: pointer; padding: 0; width: 30px; height: 30px; display: flex; align-items: center; justify-content: center; border-radius: 4px;" onmouseover="this.style.background='var(--accent-bg)'" onmouseout="this.style.background='none'">×</button>
            </div>
            
            <!-- System Performance (Hidden from Client View) -->
            <div class="workbench-card" style="margin: 20px 0;">
                <h5>System Performance</h5>
                <div class="system-metrics" style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; margin-bottom: 15px;">
                    <div class="metric-item" style="background: var(--accent-bg); padding: 12px; border-radius: 6px; text-align: center;">
                        <div class="metric-value" style="font-size: 1.2rem; font-weight: bold; color: var(--success-color);" id="ai-health-metric">94%</div>
                        <div class="metric-label" style="font-size: 0.8rem; color: var(--text-secondary);">AI Health</div>
                    </div>
                    <div class="metric-item" style="background: var(--accent-bg); padding: 12px; border-radius: 6px; text-align: center;">
                        <div class="metric-value" style="font-size: 1.2rem; font-weight: bold; color: var(--text-primary);" id="memory-metric">8.2GB</div>
                        <div class="metric-label" style="font-size: 0.8rem; color: var(--text-secondary);">Memory</div>
                    </div>
                    <div class="metric-item" style="background: var(--accent-bg); padding: 12px; border-radius: 6px; text-align: center;">
                        <div class="metric-value" style="font-size: 1.2rem; font-weight: bold; color: var(--success-color);" id="response-metric">2.1ms</div>
                        <div class="metric-label" style="font-size: 0.8rem; color: var(--text-secondary);">Response Time</div>
                    </div>
                    <div class="metric-item" style="background: var(--accent-bg); padding: 12px; border-radius: 6px; text-align: center;">
                        <div class="metric-value" style="font-size: 1.2rem; font-weight: bold; color: var(--success-color);" id="api-status-metric">Active</div>
                        <div class="metric-label" style="font-size: 0.8rem; color: var(--text-secondary);">API Status</div>
                    </div>
                </div>
            </div>

            <!-- API Usage & Costs -->
            <div class="workbench-card" style="margin: 20px 0;">
                <h5>API Usage & Costs</h5>
                <div id="settings-api-usage" style="font-size: 0.9rem;">
                    <div style="margin-bottom: 12px;">
                        <div style="display: flex; justify-content: space-between;">
                            <span>LLaMA:</span>
                            <span id="settings-llama-usage">0%</span>
                        </div>
                        <div style="height: 6px; background: var(--accent-bg); border-radius: 3px; margin-top: 4px;">
                            <div id="settings-llama-bar" style="height: 100%; background: var(--success-color); width: 0%; border-radius: 3px;"></div>
                        </div>
                    </div>
                    <div style="margin-bottom: 12px;">
                        <div style="display: flex; justify-content: space-between;">
                            <span>Claude:</span>
                            <span id="settings-claude-usage">0%</span>
                        </div>
                        <div style="height: 6px; background: var(--accent-bg); border-radius: 3px; margin-top: 4px;">
                            <div id="settings-claude-bar" style="height: 100%; background: var(--accent-color); width: 0%; border-radius: 3px;"></div>
                        </div>
                    </div>
                    <div style="margin-bottom: 12px;">
                        <div style="display: flex; justify-content: space-between; font-weight: bold;">
                            <span>Total Cost:</span>
                            <span id="settings-total-cost" style="color: var(--warning-color);">$0.00</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- API Configuration -->
            <div class="workbench-card" style="margin: 20px 0;">
                <h5>API Configuration</h5>
                <div style="display: grid; gap: 15px;">
                    <div>
                        <label>LLaMA API Key:</label>
                        <input type="password" id="llama-key" placeholder="Enter LLaMA API Key" style="width: 100%; padding: 8px; margin-top: 5px; background: var(--accent-bg); border: 1px solid var(--border-color); color: var(--text-primary); border-radius: 4px;">
                    </div>
                    <div>
                        <label>Claude API Key:</label>
                        <input type="password" id="claude-key" placeholder="Enter Claude API Key" style="width: 100%; padding: 8px; margin-top: 5px; background: var(--accent-bg); border: 1px solid var(--border-color); color: var(--text-primary); border-radius: 4px;">
                    </div>
                </div>
            </div>
            
            <!-- File Upload for MITO -->
            <div class="workbench-card" style="margin: 20px 0;">
                <h5>Upload Files to MITO</h5>
                <div style="margin-bottom: 15px;">
                    <label style="display: block; margin-bottom: 8px; color: var(--text-primary);">Select files to upload:</label>
                    <input type="file" id="mito-file-upload" multiple 
                           accept=".txt,.pdf,.png,.jpg,.jpeg,.gif,.csv,.json,.xml,.md,.py,.js,.html,.css,.yaml,.yml,.doc,.docx,.xls,.xlsx,.ppt,.pptx"
                           style="width: 100%; padding: 8px; background: var(--accent-bg); border: 1px solid var(--border-color); color: var(--text-primary); border-radius: 4px; margin-bottom: 10px;">
                    
                    <div style="display: flex; gap: 10px; margin-bottom: 10px;">
                        <button onclick="uploadFilesToMito()" style="background: var(--accent-color); color: white; border: none; padding: 8px 16px; border-radius: 4px; cursor: pointer; flex: 1;">Upload Files</button>
                        <button onclick="clearFileUpload()" style="background: var(--warning-color); color: white; border: none; padding: 8px 16px; border-radius: 4px; cursor: pointer;">Clear</button>
                    </div>
                    
                    <div style="margin-bottom: 15px;">
                        <label style="display: flex; align-items: center; color: var(--text-primary); font-size: 0.9rem;">
                            <input type="checkbox" id="mito-learn-from-files" checked style="margin-right: 8px;">
                            Allow MITO to learn and update from these files
                        </label>
                    </div>
                </div>
                
                <div id="file-upload-status" style="display: none; padding: 10px; background: var(--accent-bg); border-radius: 4px; margin-bottom: 10px;">
                    <div id="upload-progress-text" style="margin-bottom: 5px; font-size: 0.9rem;"></div>
                    <div style="background: var(--primary-bg); border-radius: 3px; height: 6px; overflow: hidden;">
                        <div id="upload-progress-bar" style="height: 100%; background: var(--accent-color); width: 0%; transition: width 0.3s ease;"></div>
                    </div>
                </div>
                
                <div id="uploaded-files-list" style="max-height: 200px; overflow-y: auto;"></div>
            </div>

            <!-- MITO Agent Status -->
            <div class="workbench-card" style="margin: 20px 0;">
                <h5>MITO Agent Status</h5>
                <div id="settings-mito-status" style="font-size: 0.9rem;">
                    <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                        <span>Status:</span>
                        <span id="settings-agent-status" style="color: var(--success-color);">Active</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                        <span>Queue:</span>
                        <span id="settings-task-queue">0 tasks</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                        <span>API Provider:</span>
                        <span id="settings-current-provider">Local</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                        <span>Autonomy:</span>
                        <span style="color: var(--warning-color);">Full</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                        <span>Knowledge Base:</span>
                        <span id="settings-knowledge-files" style="color: var(--success-color);">0 files</span>
                    </div>
                </div>
            </div>

            <!-- Usage Monitoring -->
            <div class="workbench-card" style="margin: 20px 0;">
                <h5>Usage Monitoring</h5>
                <div style="display: grid; gap: 10px;">
                    <div>
                        <label>Cost Alert Threshold ($):</label>
                        <input type="number" id="cost-threshold" value="50" min="0" step="10" style="width: 100%; padding: 8px; margin-top: 5px; background: var(--accent-bg); border: 1px solid var(--border-color); color: var(--text-primary); border-radius: 4px;">
                    </div>
                    <div>
                        <label>Usage Alert (%):</label>
                        <input type="number" id="usage-threshold" value="80" min="0" max="100" style="width: 100%; padding: 8px; margin-top: 5px; background: var(--accent-bg); border: 1px solid var(--border-color); color: var(--text-primary); border-radius: 4px;">
                    </div>
                </div>
            </div>

            <!-- Plugin Management -->
            <div class="workbench-card" style="margin: 20px 0;">
                <h5>Plugin Management</h5>
                <div style="display: grid; gap: 10px;">
                    <div style="display: flex; justify-content: space-between; align-items: center; padding: 8px; background: var(--accent-bg); border-radius: 4px;">
                        <div>
                            <strong>Code Formatter</strong>
                            <div style="font-size: 0.8rem; color: var(--text-secondary);">Auto-format code files</div>
                        </div>
                        <button onclick="togglePlugin('code-formatter')" class="control-btn" style="padding: 4px 8px; font-size: 0.8rem;">Enable</button>
                    </div>
                    <div style="display: flex; justify-content: space-between; align-items: center; padding: 8px; background: var(--accent-bg); border-radius: 4px;">
                        <div>
                            <strong>Git Integration</strong>
                            <div style="font-size: 0.8rem; color: var(--text-secondary);">Version control support</div>
                        </div>
                        <button onclick="togglePlugin('git-integration')" class="control-btn" style="padding: 4px 8px; font-size: 0.8rem; background: var(--success-color);">Enabled</button>
                    </div>
                    <div style="display: flex; justify-content: space-between; align-items: center; padding: 8px; background: var(--accent-bg); border-radius: 4px;">
                        <div>
                            <strong>AI Assistant Plus</strong>
                            <div style="font-size: 0.8rem; color: var(--text-secondary);">Enhanced AI capabilities</div>
                        </div>
                        <button onclick="togglePlugin('ai-assistant-plus')" class="control-btn" style="padding: 4px 8px; font-size: 0.8rem;">Enable</button>
                    </div>
                </div>
            </div>

            <!-- API Integrations -->
            <div class="workbench-card" style="margin: 20px 0;">
                <h5>API Integrations</h5>
                <div style="display: grid; gap: 10px;">
                    <div style="display: flex; justify-content: space-between; align-items: center; padding: 8px; background: var(--accent-bg); border-radius: 4px;">
                        <div>
                            <strong>GitHub API</strong>
                            <div style="font-size: 0.8rem; color: var(--text-secondary);">Repository management</div>
                        </div>
                        <button onclick="configureAPI('github')" class="control-btn" style="padding: 4px 8px; font-size: 0.8rem; background: var(--success-color);">Connected</button>
                    </div>
                    <div style="display: flex; justify-content: space-between; align-items: center; padding: 8px; background: var(--accent-bg); border-radius: 4px;">
                        <div>
                            <strong>Slack API</strong>
                            <div style="font-size: 0.8rem; color: var(--text-secondary);">Team notifications</div>
                        </div>
                        <button onclick="configureAPI('slack')" class="control-btn" style="padding: 4px 8px; font-size: 0.8rem;">Connect</button>
                    </div>
                    <div style="display: flex; justify-content: space-between; align-items: center; padding: 8px; background: var(--accent-bg); border-radius: 4px;">
                        <div>
                            <strong>Docker Hub</strong>
                            <div style="font-size: 0.8rem; color: var(--text-secondary);">Container registry</div>
                        </div>
                        <button onclick="configureAPI('docker')" class="control-btn" style="padding: 4px 8px; font-size: 0.8rem;">Connect</button>
                    </div>
                    <div style="display: flex; justify-content: space-between; align-items: center; padding: 8px; background: var(--accent-bg); border-radius: 4px;">
                        <div>
                            <strong>AWS Services</strong>
                            <div style="font-size: 0.8rem; color: var(--text-secondary);">Cloud deployment</div>
                        </div>
                        <button onclick="configureAPI('aws')" class="control-btn" style="padding: 4px 8px; font-size: 0.8rem;">Connect</button>
                    </div>
                </div>
            </div>
            
            <div style="display: flex; gap: 10px; justify-content: flex-end; margin-top: 20px;">
                <button onclick="closeSettings()" class="control-btn">Cancel</button>
                <button onclick="saveSettings()" class="control-btn" style="background: var(--accent-color);">Save Settings</button>
            </div>
        </div>
    </div>

    <!-- Files Modal -->
    <div id="files-modal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 1000;">
        <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); background: var(--primary-bg); padding: 30px; border-radius: 10px; max-width: 600px; width: 90%; border: 1px solid var(--border-color);">
            <h3>MITO File Management</h3>
            
            <!-- File Upload Section -->
            <div class="workbench-card" style="margin: 20px 0;">
                <h4 style="margin-bottom: 15px; color: var(--accent-color);">Upload Files for MITO</h4>
                <div style="border: 2px dashed var(--border-color); border-radius: 8px; padding: 20px; text-align: center; margin-bottom: 15px;" 
                     id="file-drop-zone"
                     ondrop="handleFileDrop(event)" 
                     ondragover="handleDragOver(event)"
                     ondragleave="handleDragLeave(event)">
                    <div style="color: var(--text-secondary); margin-bottom: 10px;">
                        📁 Drop files here or click to browse
                    </div>
                    <input type="file" id="file-input" multiple accept=".txt,.py,.js,.html,.css,.json,.xml,.yaml,.yml,.md,.csv,.pdf,.png,.jpg,.jpeg,.gif" style="display: none;" onchange="handleFileSelect(event)">
                    <button onclick="document.getElementById('file-input').click()" class="control-btn" style="background: var(--accent-color);">
                        Choose Files
                    </button>
                </div>
                
                <!-- Learning Options -->
                <div style="margin-bottom: 15px;">
                    <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
                        <input type="checkbox" id="learn-from-file" checked style="margin: 0;">
                        <span>Enable MITO learning from uploaded files</span>
                    </label>
                    <div style="font-size: 0.8rem; color: var(--text-secondary); margin-top: 5px; margin-left: 20px;">
                        MITO will analyze and learn from the content to improve responses
                    </div>
                </div>
                
                <!-- Upload Progress -->
                <div id="upload-progress" style="display: none; margin-bottom: 15px;">
                    <div style="background: var(--accent-bg); border-radius: 4px; padding: 8px; margin-bottom: 5px;">
                        <div style="background: var(--accent-color); height: 4px; border-radius: 2px; transition: width 0.3s;" id="progress-bar"></div>
                    </div>
                    <div id="upload-status" style="font-size: 0.8rem; color: var(--text-secondary);"></div>
                </div>
            </div>
            
            <!-- Knowledge Base Status -->
            <div class="workbench-card" style="margin: 20px 0;">
                <h4 style="margin-bottom: 15px; color: var(--accent-color);">MITO Knowledge Base</h4>
                <div id="knowledge-stats" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 10px; margin-bottom: 15px;">
                    <div style="background: var(--accent-bg); padding: 10px; border-radius: 6px; text-align: center;">
                        <div style="font-size: 1.2rem; font-weight: bold; color: var(--accent-color);" id="files-count">0</div>
                        <div style="font-size: 0.8rem; color: var(--text-secondary);">Files Processed</div>
                    </div>
                    <div style="background: var(--accent-bg); padding: 10px; border-radius: 6px; text-align: center;">
                        <div style="font-size: 1.2rem; font-weight: bold; color: var(--accent-color);" id="total-size">0 KB</div>
                        <div style="font-size: 0.8rem; color: var(--text-secondary);">Total Size</div>
                    </div>
                </div>
                <div id="recent-files" style="max-height: 200px; overflow-y: auto;">
                    <div style="color: var(--text-secondary); text-align: center; padding: 20px;">
                        No files uploaded yet
                    </div>
                </div>
            </div>
            
            <div style="display: flex; gap: 10px; justify-content: flex-end; margin-top: 20px;">
                <button onclick="refreshKnowledgeBase()" class="control-btn">Refresh</button>
                <button onclick="closeFiles()" class="control-btn">Close</button>
            </div>
        </div>
    </div>

    <!-- Notifications Modal -->
    <div id="notifications-modal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 1000;">
        <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); background: var(--primary-bg); padding: 30px; border-radius: 10px; max-width: 500px; width: 90%; border: 1px solid var(--border-color);">
            <h3>Notifications</h3>
            
            <div class="workbench-card" style="margin: 20px 0;">
                <div id="modal-notifications-panel" style="font-size: 0.9rem; color: var(--text-secondary); max-height: 300px; overflow-y: auto;">
                    <div id="modal-no-notifications" style="text-align: center; color: var(--text-secondary); padding: 20px;">
                        No notifications
                    </div>
                </div>
            </div>
            
            <div style="display: flex; gap: 10px; justify-content: flex-end; margin-top: 20px;">
                <button onclick="markAllNotificationsRead()" class="control-btn" style="background: var(--accent-color);">Mark All Read</button>
                <button onclick="closeNotifications()" class="control-btn">Close</button>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Giant Workbench JavaScript Functions
        function switchTool(toolName) {
            // Remove active class from all tools
            document.querySelectorAll('.nav-link').forEach(link => {
                link.classList.remove('active');
            });
            
            // Add active class to clicked tool
            if (event && event.target) {
                event.target.classList.add('active');
            }
            
            // Switch workspace content based on tool
            const workspace = document.getElementById('main-canvas');
            
            console.log('Loading tool:', toolName);
            
            switch(toolName) {
                case 'ai-factory':
                    loadAIFactory();
                    break;
                case 'code-generator':
                    loadCodeGenerator();
                    break;
                case 'model-trainer':
                    loadModelTrainer();
                    break;
                case 'nlu-processor':
                    loadNLUProcessor();
                    break;
                case 'phase-manager':
                    loadPhaseManager();
                    break;
                case 'project-templates':
                    loadProjectTemplates();
                    break;
                case 'agent-builder':
                    loadAgentBuilder();
                    break;
                case 'ecosystem-orchestrator':
                    loadEcosystemOrchestrator();
                    break;
                case 'file-manager':
                    loadFileManager();
                    break;
                case 'database-manager':
                    loadDatabaseManager();
                    break;
                case 'deployment-manager':
                    loadDeploymentManager();
                    break;
                case 'image-generator':
                    loadImageGenerator();
                    break;
                case 'whiteboard':
                    loadWhiteboard();
                    break;
                case 'terminal':
                    loadTerminal();
                    break;
                case 'package-manager':
                    loadPackageManager();
                    break;
                case 'api-tester':
                    loadAPITester();
                    break;
                case 'utilities':
                    loadUtilities();
                    break;
                case 'system-monitor':
                    loadSystemMonitor();
                    break;
                case 'knowledge-base':
                    loadKnowledgeBase();
                    break;
                case 'collaboration':
                    loadCollaboration();
                    break;
                case 'file-browser':
                    loadFileBrowser();
                    break;
                case 'code-editor':
                    window.open('/code-editor', '_blank');
                    return;
                default:
                    workspace.innerHTML = `<h3>Tool: ${toolName}</h3><p>Tool interface loading...</p>`;
            }
        }

        function loadPhaseManager() {
            const workspace = document.getElementById('main-canvas');
            workspace.innerHTML = `
                <h3>Phase Manager - Project Progress</h3>
                
                <div class="workbench-card">
                    <h5>Current Project: AI Search Engine</h5>
                    <div class="phase-indicator" style="margin-bottom: 20px;">
                        <div class="phase-step completed">1</div>
                        <div class="phase-line"></div>
                        <div class="phase-step active">2</div>
                        <div class="phase-line"></div>
                        <div class="phase-step pending">3</div>
                        <div class="phase-line"></div>
                        <div class="phase-step pending">4</div>
                        <div class="phase-line"></div>
                        <div class="phase-step pending">5</div>
                        <div class="phase-line"></div>
                        <div class="phase-step pending">6</div>
                    </div>
                    
                    <p><strong>Phase 2: Architecture Design (60% Complete)</strong></p>
                    <p>Tasks completed: Data models defined, API endpoints designed, Database schema created</p>
                    <p>Next tasks: Vector embeddings setup, Search algorithms configuration</p>
                    
                    <div style="margin-top: 20px; display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 15px;">
                        <button class="btn-success" onclick="markPhaseComplete()">Complete Phase</button>
                        <button class="btn-primary" onclick="skipToPhase()">Skip to Phase</button>
                        <button class="btn-warning" onclick="addCustomPhase()">Add Phase</button>
                    </div>
                </div>
                
                <div class="workbench-card">
                    <h5>All Project Phases</h5>
                    <div style="display: grid; gap: 10px;">
                        <div style="padding: 15px; background: var(--success-color); border-radius: 6px;">
                            <strong>Phase 1: Planning & Requirements</strong> - Completed
                        </div>
                        <div style="padding: 15px; background: var(--warning-color); border-radius: 6px;">
                            <strong>Phase 2: Architecture Design</strong> - 60% Complete
                        </div>
                        <div style="padding: 15px; background: var(--accent-bg); border-radius: 6px;">
                            <strong>Phase 3: Core Development</strong> - Pending
                        </div>
                        <div style="padding: 15px; background: var(--accent-bg); border-radius: 6px;">
                            <strong>Phase 4: Interface Development</strong> - Pending
                        </div>
                        <div style="padding: 15px; background: var(--accent-bg); border-radius: 6px;">
                            <strong>Phase 5: Testing & Optimization</strong> - Pending
                        </div>
                        <div style="padding: 15px; background: var(--accent-bg); border-radius: 6px;">
                            <strong>Phase 6: Deployment & Documentation</strong> - Pending
                        </div>
                    </div>
                </div>
            `;
        }

        function loadCodeGenerator() {
            const workspace = document.getElementById('main-canvas');
            workspace.innerHTML = `
                <h3>Code Generator - AI-Powered Development</h3>
                
                <div class="workbench-card">
                    <h5>Generate Code</h5>
                    <textarea style="width: 100%; height: 100px; background: var(--accent-bg); border: none; color: var(--text-primary); padding: 15px; border-radius: 6px; margin-bottom: 15px;" placeholder="Describe what you want to build...">Create a vector similarity search function using FAISS for my AI search engine</textarea>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 15px; margin-bottom: 15px;">
                        <select style="background: var(--accent-bg); border: none; color: var(--text-primary); padding: 10px; border-radius: 6px;">
                            <option>Python</option>
                            <option>JavaScript</option>
                            <option>TypeScript</option>
                            <option>Go</option>
                        </select>
                        <select style="background: var(--accent-bg); border: none; color: var(--text-primary); padding: 10px; border-radius: 6px;">
                            <option>Object-Oriented</option>
                            <option>Functional</option>
                            <option>Procedural</option>
                        </select>
                        <select style="background: var(--accent-bg); border: none; color: var(--text-primary); padding: 10px; border-radius: 6px;">
                            <option>Production Ready</option>
                            <option>Prototype</option>
                            <option>Learning Example</option>
                        </select>
                    </div>
                    
                    <button class="btn-primary" onclick="generateCode()">Generate Code</button>
                </div>
                
                <div class="workbench-card">
                    <h5>Generated Code</h5>
                    <div class="code-editor" style="height: 400px;">
                        <div style="color: #569cd6;">"""</div>
                        <div style="color: #6a9955;">Vector Similarity Search with FAISS</div>
                        <div style="color: #569cd6;">"""</div>
                        <div style="color: #c586c0;">import</div> <span style="color: #9cdcfe;">faiss</span>
                        <div style="color: #c586c0;">import</div> <span style="color: #9cdcfe;">numpy</span> <span style="color: #c586c0;">as</span> <span style="color: #9cdcfe;">np</span>
                        <br>
                        <div style="color: #c586c0;">class</div> <span style="color: #4ec9b0;">VectorSearchEngine</span>:
                        <div style="margin-left: 20px;">
                            <div style="color: #c586c0;">def</div> <span style="color: #dcdcaa;">__init__</span>(self, dimension=768):
                            <div style="margin-left: 20px;">
                                <div>self.dimension = dimension</div>
                                <div>self.index = faiss.IndexFlatIP(dimension)</div>
                                <div>self.vectors = []</div>
                            </div>
                        </div>
                        <br>
                        <div style="margin-left: 20px;">
                            <div style="color: #c586c0;">def</div> <span style="color: #dcdcaa;">add_vectors</span>(self, vectors):
                            <div style="margin-left: 20px;">
                                <div>vectors = np.array(vectors).astype('float32')</div>
                                <div>faiss.normalize_L2(vectors)</div>
                                <div>self.index.add(vectors)</div>
                                <div>self.vectors.extend(vectors)</div>
                            </div>
                        </div>
                        <br>
                        <div style="margin-left: 20px;">
                            <div style="color: #c586c0;">def</div> <span style="color: #dcdcaa;">search</span>(self, query_vector, k=5):
                            <div style="margin-left: 20px;">
                                <div>query = np.array([query_vector]).astype('float32')</div>
                                <div>faiss.normalize_L2(query)</div>
                                <div>scores, indices = self.index.search(query, k)</div>
                                <div style="color: #c586c0;">return</div> scores[0], indices[0]
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        function sendChatMessage() {
            const input = document.getElementById('chat-input');
            const messages = document.getElementById('chat-messages');
            
            if (input.value.trim()) {
                const userMessage = input.value.trim();
                
                // Add user message
                const userMsg = document.createElement('div');
                userMsg.style.cssText = 'margin-bottom: 10px; padding: 10px; background: var(--accent-color); border-radius: 8px; text-align: right;';
                userMsg.innerHTML = `<strong>You:</strong> ${userMessage}`;
                messages.appendChild(userMsg);
                
                // Send to MITO AI backend
                fetch('/api/generate', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        prompt: userMessage,
                        provider: 'llama'
                    })
                })
                .then(response => response.json())
                .then(data => {
                    const mitoMsg = document.createElement('div');
                    mitoMsg.style.cssText = 'margin-bottom: 10px; padding: 10px; background: var(--accent-bg); border-radius: 8px;';
                    
                    if (data.success) {
                        mitoMsg.innerHTML = `<strong>MITO:</strong> ${data.response}`;
                    } else {
                        mitoMsg.innerHTML = `<strong>MITO:</strong> I'm experiencing some technical difficulties. Please try again or check the system status.`;
                    }
                    
                    messages.appendChild(mitoMsg);
                    messages.scrollTop = messages.scrollHeight;
                })
                .catch(error => {
                    const mitoMsg = document.createElement('div');
                    mitoMsg.style.cssText = 'margin-bottom: 10px; padding: 10px; background: var(--danger-color); border-radius: 8px;';
                    mitoMsg.innerHTML = `<strong>MITO:</strong> Connection error. Please check your network and try again.`;
                    messages.appendChild(mitoMsg);
                    messages.scrollTop = messages.scrollHeight;
                });
                
                input.value = '';
                messages.scrollTop = messages.scrollHeight;
            }
        }

        function generateCustomAI() {
            const checkboxes = document.querySelectorAll('input[type="checkbox"]:checked');
            const functions = Array.from(checkboxes).map(cb => cb.parentElement.textContent.trim());
            
            const prompt = `Generate a comprehensive AI application with the following functions: ${functions.join(', ')}. Include complete implementation with proper architecture, error handling, and documentation.`;
            
            fetch('/api/generate', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    prompt: prompt,
                    provider: 'llama'
                })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    updateCodeEditor(data.response);
                    addChatMessage('MITO', 'AI application generated successfully! Check the code editor for the complete implementation.');
                } else {
                    addChatMessage('MITO', 'Generation failed. Please try again or check your configuration.');
                }
            })
            .catch(error => {
                addChatMessage('MITO', 'Network error occurred. Please check your connection.');
            });
        }

        function continueCurrentPhase() {
            const prompt = "Continue with vector embeddings setup for my AI search engine. Generate the code for FAISS integration and similarity search functionality.";
            
            fetch('/api/generate', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    prompt: prompt,
                    provider: 'llama'
                })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    updateCodeEditor(data.response);
                    addChatMessage('MITO', 'Vector embeddings implementation ready! The code includes FAISS setup and search functionality.');
                }
            });
        }

        function markPhaseComplete() {
            // Update phase progress
            const phaseSteps = document.querySelectorAll('.phase-step');
            const currentActive = document.querySelector('.phase-step.active');
            
            if (currentActive) {
                currentActive.classList.remove('active');
                currentActive.classList.add('completed');
                
                const nextStep = currentActive.parentElement.children[Array.from(currentActive.parentElement.children).indexOf(currentActive) + 2]; // +2 to skip the line
                if (nextStep && nextStep.classList.contains('phase-step')) {
                    nextStep.classList.add('active');
                }
            }
            
            addChatMessage('MITO', 'Phase completed! Moving to the next development phase. What would you like to work on next?');
        }

        function generateCode() {
            const textarea = document.querySelector('textarea');
            if (textarea && textarea.value.trim()) {
                const prompt = textarea.value.trim();
                
                // Show generating status
                addChatMessage('MITO', 'Generating code...');
                
                fetch('/api/generate-code', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        prompt: prompt,
                        language: 'python'
                    })
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        updateCodeEditor(data.code);
                        addChatMessage('MITO', 'Code generated successfully! Check the code editor for the implementation.');
                    } else {
                        addChatMessage('MITO', 'Code generation failed: ' + (data.error || 'Unknown error'));
                    }
                })
                .catch(error => {
                    addChatMessage('MITO', 'Error generating code: ' + error.message);
                });
            } else {
                addChatMessage('MITO', 'Please enter a description of what code you want to generate.');
            }
        }

        function updateCodeEditor(code) {
            // Target the main visible code display area
            const mainCodeDisplay = document.getElementById('main-code-display');
            const editors = document.querySelectorAll('.code-editor');
            const generatedCode = document.getElementById('generated-code');
            
            const cleanCode = escapeHtml(code);
            
            // Update main visible code display prominently
            if (mainCodeDisplay) {
                mainCodeDisplay.innerHTML = `<pre style="color: #f1f5f9; font-family: 'Consolas', 'Monaco', monospace; white-space: pre-wrap; margin: 0;">${cleanCode}</pre>`;
                mainCodeDisplay.scrollTop = 0; // Scroll to top to show the code
            }
            
            // Update all other code areas
            editors.forEach(editor => {
                if (editor.id !== 'main-code-display') { // Avoid duplicate update
                    editor.innerHTML = `<pre style="color: #f1f5f9; font-family: 'Consolas', 'Monaco', monospace; white-space: pre-wrap;">${cleanCode}</pre>`;
                }
            });
            
            if (generatedCode) {
                generatedCode.innerHTML = `<pre style="color: #f1f5f9; font-family: 'Consolas', 'Monaco', monospace; white-space: pre-wrap;">${cleanCode}</pre>`;
            }
            
            // Show code in active workspace if it exists
            const activeWorkspace = document.getElementById('main-canvas');
            if (activeWorkspace && activeWorkspace.querySelector('#generated-code')) {
                activeWorkspace.querySelector('#generated-code').innerHTML = `<pre style="color: #f1f5f9; font-family: 'Consolas', 'Monaco', monospace; white-space: pre-wrap;">${cleanCode}</pre>`;
            }
        }

        function escapeHtml(text) {
            const map = {
                '&': '&amp;',
                '<': '&lt;',
                '>': '&gt;',
                '"': '&quot;',
                "'": '&#039;'
            };
            return text.replace(/[&<>"']/g, function(m) { return map[m]; });
        }

        // File Upload Functions for MITO
        async function uploadFilesToMito() {
            const fileInput = document.getElementById('mito-file-upload');
            const learnFromFiles = document.getElementById('mito-learn-from-files').checked;
            const files = fileInput.files;
            
            if (files.length === 0) {
                showNotification('Please select files to upload', 'warning');
                return;
            }
            
            const statusDiv = document.getElementById('file-upload-status');
            const progressText = document.getElementById('upload-progress-text');
            const progressBar = document.getElementById('upload-progress-bar');
            const filesList = document.getElementById('uploaded-files-list');
            
            statusDiv.style.display = 'block';
            progressText.textContent = 'Preparing files for upload...';
            progressBar.style.width = '0%';
            
            try {
                for (let i = 0; i < files.length; i++) {
                    const file = files[i];
                    const progress = ((i / files.length) * 100).toFixed(0);
                    
                    progressText.textContent = `Uploading ${file.name}... (${i + 1}/${files.length})`;
                    progressBar.style.width = progress + '%';
                    
                    const formData = new FormData();
                    formData.append('file', file);
                    formData.append('learn_from_file', learnFromFiles);
                    
                    const response = await fetch('/api/mito/upload-file', {
                        method: 'POST',
                        body: formData
                    });
                    
                    const result = await response.json();
                    
                    if (result.success) {
                        addFileToList(file.name, result.analysis, result.learned);
                        
                        if (learnFromFiles) {
                            await fetch('/api/mito/process-knowledge', {
                                method: 'POST',
                                headers: { 'Content-Type': 'application/json' },
                                body: JSON.stringify({
                                    filename: file.name,
                                    content: result.content,
                                    file_type: file.type,
                                    analysis: result.analysis
                                })
                            });
                        }
                    } else {
                        showNotification(`Failed to upload ${file.name}: ${result.error}`, 'error');
                    }
                }
                
                progressText.textContent = 'Upload completed successfully!';
                progressBar.style.width = '100%';
                
                setTimeout(() => {
                    statusDiv.style.display = 'none';
                }, 3000);
                
                updateMitoKnowledgeCount();
                showNotification(`Successfully uploaded ${files.length} file(s) to MITO`, 'success');
                
            } catch (error) {
                progressText.textContent = 'Upload failed!';
                showNotification('Upload failed: ' + error.message, 'error');
            }
        }
        
        function clearFileUpload() {
            document.getElementById('mito-file-upload').value = '';
            document.getElementById('uploaded-files-list').innerHTML = '';
            document.getElementById('file-upload-status').style.display = 'none';
        }
        
        function addFileToList(filename, analysis, learned) {
            const filesList = document.getElementById('uploaded-files-list');
            
            const fileItem = document.createElement('div');
            fileItem.style.cssText = 'padding: 10px; margin-bottom: 8px; background: var(--primary-bg); border-radius: 4px; border-left: 3px solid var(--accent-color);';
            
            const fileName = document.createElement('div');
            fileName.style.cssText = 'font-weight: bold; color: var(--text-primary); margin-bottom: 4px;';
            fileName.textContent = filename;
            
            const fileAnalysis = document.createElement('div');
            fileAnalysis.style.cssText = 'font-size: 0.8rem; color: var(--text-secondary); margin-bottom: 4px;';
            fileAnalysis.textContent = analysis || 'File processed successfully';
            
            const learnStatus = document.createElement('div');
            learnStatus.style.cssText = `font-size: 0.75rem; color: ${learned ? 'var(--success-color)' : 'var(--text-muted)'};`;
            learnStatus.textContent = learned ? '✓ MITO learned from this file' : '○ File stored (learning disabled)';
            
            fileItem.appendChild(fileName);
            fileItem.appendChild(fileAnalysis);
            fileItem.appendChild(learnStatus);
            
            filesList.appendChild(fileItem);
        }
        
        async function updateMitoKnowledgeCount() {
            try {
                const response = await fetch('/api/mito/knowledge-stats');
                const stats = await response.json();
                
                const knowledgeElement = document.getElementById('settings-knowledge-files');
                if (knowledgeElement && stats.file_count !== undefined) {
                    knowledgeElement.textContent = `${stats.file_count} files`;
                }
            } catch (error) {
                console.log('Failed to update knowledge count:', error);
            }
        }

        // Enhanced Chat System with Workflow Integration
        class ChatManager {
            constructor() {
                this.chatHistory = JSON.parse(localStorage.getItem('mito-chat-history') || '[]');
                this.currentContext = null;
                this.autoSaveTimer = null;
                this.isProcessing = false;
                this.workflowState = {};
                this.init();
            }

            init() {
                this.loadChatHistory();
                this.setupAutoSave();
                this.setupKeyboardShortcuts();
                this.setupContextTracking();
            }

            sendMessage() {
                const input = document.getElementById('chat-input');
                const message = input.value.trim();
                
                if (!message) return;
                
                // Add user message
                this.addMessage('You', message);
                
                // Clear input
                input.value = '';
                
                // Focus back to input for continued conversation
                setTimeout(() => input.focus(), 100);
            }

            addDirectMessage(sender, message) {
                const timestamp = new Date().toISOString();
                const chatMessage = {
                    id: Date.now(),
                    sender,
                    message,
                    timestamp,
                    context: null,
                    workflowState: {...this.workflowState}
                };
                this.chatHistory.push(chatMessage);
                this.renderMessage(chatMessage);
                this.saveToStorage();
                this.scrollToBottom();
            }

            addMessage(sender, message, context = null) {
                const timestamp = new Date().toISOString();
                const chatMessage = {
                    id: Date.now(),
                    sender,
                    message,
                    timestamp,
                    context: context || this.getCurrentWorkspaceContext(),
                    workflowState: {...this.workflowState}
                };

                this.chatHistory.push(chatMessage);
                this.renderMessage(chatMessage);
                this.saveToStorage();
                this.scrollToBottom();

                // Process background tasks without interrupting workflow
                if (sender === 'You' && !this.isProcessing) {
                    setTimeout(() => {
                        this.processMessageInBackground(message, context);
                    }, 100);
                }
            }

            processMessageInBackground(message, context) {
                this.isProcessing = true;
                const typingIndicator = this.showTypingIndicator();

                // Send message to actual MITO AI backend
                fetch('/api/generate', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        prompt: message,
                        provider: 'auto'
                    })
                })
                .then(response => {
                    if (!response.ok) {
                        throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                    }
                    return response.json();
                })
                .then(data => {
                    console.log('API Response:', data);
                    this.hideTypingIndicator(typingIndicator);
                    
                    if (data && data.response) {
                        // Check if this is a code generation response
                        if (data.code_generated && data.code) {
                            updateCodeEditor(data.code);
                        }
                        
                        // Create new message without triggering recursive processing
                        const timestamp = new Date().toISOString();
                        const chatMessage = {
                            id: Date.now(),
                            sender: 'MITO',
                            message: data.response,
                            timestamp,
                            context: null,
                            workflowState: {...this.workflowState}
                        };
                        this.chatHistory.push(chatMessage);
                        this.renderMessage(chatMessage);
                        this.saveToStorage();
                        this.scrollToBottom();
                    } else {
                        console.warn('No response in data:', data);
                        this.addDirectMessage('MITO', 'I understand. How can I help you with your current task?');
                    }
                    this.isProcessing = false;
                })
                .catch(error => {
                    this.hideTypingIndicator(typingIndicator);
                    console.error('Chat error:', error);
                    // Fallback to contextual response if API fails
                    const response = this.generateContextualResponse(message, context);
                    this.addDirectMessage('MITO', response);
                    this.isProcessing = false;
                });
            }

            generateContextualResponse(message, context) {
                const lowerMsg = message.toLowerCase();
                
                // Check if user is requesting code generation
                if (lowerMsg.includes('generate') && lowerMsg.includes('code')) {
                    // Trigger actual code generation instead of generic response
                    this.triggerCodeGeneration(message);
                    return 'Generating code for you...';
                }
                
                // Context-aware responses based on current tool
                if (context && context.currentTool) {
                    switch (context.currentTool) {
                        case 'code-generator':
                            if (lowerMsg.includes('generate') || lowerMsg.includes('code')) {
                                this.triggerCodeGeneration(message);
                                return 'Generating code for your request...';
                            }
                            break;
                        case 'agent-builder':
                            if (lowerMsg.includes('agent') || lowerMsg.includes('ai')) {
                                return 'Great! Let me help you build that AI agent. What specific capabilities should it have?';
                            }
                            break;
                        case 'database-manager':
                            if (lowerMsg.includes('query') || lowerMsg.includes('sql')) {
                                return 'I can help optimize that database query. Would you like me to analyze performance or suggest improvements?';
                            }
                            break;
                    }
                }

                // General intelligent responses
                if (lowerMsg.includes('help') || lowerMsg.includes('how')) {
                    return 'I\'m here to assist! I can help with code generation, project management, database queries, and more. What would you like to work on?';
                }
                
                if (lowerMsg.includes('error') || lowerMsg.includes('problem')) {
                    return 'I see you\'re encountering an issue. Let me analyze the current workspace state and help troubleshoot. Can you provide more details?';
                }

                if (lowerMsg.includes('deploy') || lowerMsg.includes('production')) {
                    return 'Ready to deploy? I\'ll run pre-deployment checks and guide you through the process. Shall I start the deployment pipeline?';
                }

                return 'I understand. I\'m continuously monitoring your workspace and can assist whenever needed. Just let me know how I can help!';
            }

            getCurrentWorkspaceContext() {
                const activeTab = document.querySelector('.nav-btn.active');
                const currentTool = activeTab ? activeTab.textContent.toLowerCase().replace(/\s+/g, '-') : null;
                
                return {
                    currentTool,
                    timestamp: new Date().toISOString(),
                    workspaceState: this.captureWorkspaceState()
                };
            }

            captureWorkspaceState() {
                const state = {};
                
                // Capture form inputs
                const inputs = document.querySelectorAll('input, textarea, select');
                inputs.forEach(input => {
                    if (input.id || input.name) {
                        state[input.id || input.name] = input.value;
                    }
                });

                return state;
            }

            showTypingIndicator() {
                // Remove any existing typing indicator first
                const existingIndicator = document.getElementById('typing-indicator');
                if (existingIndicator) {
                    existingIndicator.remove();
                }
                
                const messages = document.getElementById('chat-messages');
                if (!messages) return null;
                
                const typingDiv = document.createElement('div');
                typingDiv.id = 'typing-indicator';
                typingDiv.className = 'chat-message typing-message';
                typingDiv.style.cssText = 'margin-bottom: 10px; padding: 10px; background: var(--accent-bg); border-radius: 8px; opacity: 0.8;';
                typingDiv.innerHTML = '<strong>MITO:</strong> <span class="typing-dots">●●●</span> thinking...';
                messages.appendChild(typingDiv);
                messages.scrollTop = messages.scrollHeight;
                
                // Animate typing dots
                const dots = typingDiv.querySelector('.typing-dots');
                let dotCount = 0;
                const dotInterval = setInterval(() => {
                    dotCount = (dotCount + 1) % 4;
                    dots.textContent = '●'.repeat(dotCount) + '○'.repeat(3 - dotCount);
                }, 500);
                
                typingDiv.dotInterval = dotInterval;
                return typingDiv;
            }

            hideTypingIndicator(indicator) {
                if (indicator && indicator.dotInterval) {
                    clearInterval(indicator.dotInterval);
                }
                if (indicator && indicator.parentNode) {
                    indicator.parentNode.removeChild(indicator);
                }
                // Also remove any existing typing indicators by ID
                const existingIndicator = document.getElementById('typing-indicator');
                if (existingIndicator) {
                    existingIndicator.remove();
                }
            }

            triggerCodeGeneration(prompt) {
                // Extract language if mentioned in prompt
                const language = this.extractLanguage(prompt) || 'python';
                
                fetch('/api/generate-code', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        prompt: prompt,
                        language: language
                    })
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success && data.code) {
                        // Direct DOM manipulation to avoid scope issues
                        const mainCodeDisplay = document.getElementById('main-code-display');
                        if (mainCodeDisplay) {
                            const cleanCode = data.code.replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;');
                            mainCodeDisplay.innerHTML = `<pre style="color: #f1f5f9; font-family: 'Consolas', 'Monaco', monospace; white-space: pre-wrap; margin: 0;">${cleanCode}</pre>`;
                        }
                        this.addDirectMessage('MITO', `✓ Generated ${language} code successfully`);
                    } else {
                        this.addDirectMessage('MITO', 'Code generation failed: ' + (data.error || 'No code returned'));
                    }
                })
                .catch(error => {
                    console.error('Code generation error:', error);
                    this.addDirectMessage('MITO', 'Code generation API error: ' + error.message);
                });
            }

            extractLanguage(prompt) {
                const lowerPrompt = prompt.toLowerCase();
                if (lowerPrompt.includes('python')) return 'python';
                if (lowerPrompt.includes('javascript') || lowerPrompt.includes('js')) return 'javascript';
                if (lowerPrompt.includes('java')) return 'java';
                if (lowerPrompt.includes('c++') || lowerPrompt.includes('cpp')) return 'cpp';
                if (lowerPrompt.includes('html')) return 'html';
                if (lowerPrompt.includes('css')) return 'css';
                if (lowerPrompt.includes('sql')) return 'sql';
                if (lowerPrompt.includes('react')) return 'javascript';
                if (lowerPrompt.includes('node')) return 'javascript';
                return 'python'; // default
            }

            renderMessage(chatMessage) {
                const messages = document.getElementById('chat-messages');
                const msgDiv = document.createElement('div');
                msgDiv.className = 'chat-message';
                msgDiv.dataset.messageId = chatMessage.id;
                
                const senderClass = chatMessage.sender === 'You' ? 'user-message' : 'ai-message';
                msgDiv.style.cssText = `margin-bottom: 10px; padding: 10px; background: var(--accent-bg); border-radius: 8px; position: relative;`;
                
                const timeStr = new Date(chatMessage.timestamp).toLocaleTimeString();
                msgDiv.innerHTML = `
                    <div class="message-header" style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                        <strong>${chatMessage.sender}:</strong>
                        <small style="opacity: 0.7;">${timeStr}</small>
                    </div>
                    <div class="message-content">${chatMessage.message}</div>
                    ${chatMessage.context ? `<small style="opacity: 0.5; font-size: 0.8em;">Context: ${chatMessage.context.currentTool || 'General'}</small>` : ''}
                `;
                
                messages.appendChild(msgDiv);
            }

            loadChatHistory() {
                const messages = document.getElementById('chat-messages');
                messages.innerHTML = '';
                
                this.chatHistory.slice(-50).forEach(msg => {
                    this.renderMessage(msg);
                });
                
                this.scrollToBottom();
            }

            setupAutoSave() {
                this.autoSaveTimer = setInterval(() => {
                    this.saveToStorage();
                }, 5000); // Auto-save every 5 seconds
            }

            saveToStorage() {
                try {
                    // Keep only last 100 messages to prevent storage overflow
                    const recentHistory = this.chatHistory.slice(-100);
                    localStorage.setItem('mito-chat-history', JSON.stringify(recentHistory));
                } catch (e) {
                    console.warn('Failed to save chat history to localStorage');
                }
            }

            setupKeyboardShortcuts() {
                document.addEventListener('keydown', (e) => {
                    // Ctrl/Cmd + Enter to send message quickly
                    if ((e.ctrlKey || e.metaKey) && e.key === 'Enter') {
                        const input = document.getElementById('chat-input');
                        if (input && input.value.trim()) {
                            this.sendMessage();
                            e.preventDefault();
                        }
                    }
                    
                    // Ctrl/Cmd + Shift + C to toggle chat
                    if ((e.ctrlKey || e.metaKey) && e.shiftKey && e.key === 'C') {
                        toggleChat();
                        e.preventDefault();
                    }
                });
            }

            setupContextTracking() {
                // Track workspace changes
                document.addEventListener('click', (e) => {
                    if (e.target.classList.contains('nav-btn')) {
                        this.workflowState.currentTool = e.target.textContent.toLowerCase().replace(/\s+/g, '-');
                        this.workflowState.lastToolChange = new Date().toISOString();
                    }
                });

                // Track form changes for context
                document.addEventListener('input', (e) => {
                    if (e.target.matches('input, textarea, select')) {
                        this.workflowState.lastInput = {
                            element: e.target.id || e.target.name,
                            value: e.target.value,
                            timestamp: new Date().toISOString()
                        };
                    }
                });
            }

            scrollToBottom() {
                const messages = document.getElementById('chat-messages');
                if (messages) {
                    messages.scrollTop = messages.scrollHeight;
                }
            }

            clearHistory() {
                this.chatHistory = [];
                localStorage.removeItem('mito-chat-history');
                document.getElementById('chat-messages').innerHTML = '';
                this.addMessage('MITO', 'Chat history cleared. How can I assist you with your current project?');
            }

            exportChatHistory() {
                const blob = new Blob([JSON.stringify(this.chatHistory, null, 2)], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `mito-chat-history-${new Date().toISOString().split('T')[0]}.json`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
            }
        }

        // Initialize enhanced chat system and status bar
        let chatManager;
        document.addEventListener('DOMContentLoaded', () => {
            chatManager = new ChatManager();
            initializeStatusBar();
        });

        // Global chat functions
        function sendChatMessage() {
            if (chatManager) {
                chatManager.sendMessage();
            }
        }

        function addChatMessage(sender, message) {
            if (chatManager) {
                chatManager.addMessage(sender, message);
            }
        }

        // Status Bar Management
        function initializeStatusBar() {
            updateCurrentTime();
            setInterval(updateCurrentTime, 1000);
            
            // Update AI status based on available providers
            fetch('/api/system-status')
                .then(response => response.json())
                .then(data => {
                    if (data.ai_providers) {
                        const activeProvider = Object.values(data.ai_providers).find(p => p.available);
                        const statusEl = document.getElementById('ai-status');
                        if (activeProvider) {
                            statusEl.textContent = `Connected to ${activeProvider.name}`;
                            statusEl.style.color = 'var(--success-color)';
                        } else {
                            statusEl.textContent = 'Local AI Only';
                            statusEl.style.color = 'var(--warning-color)';
                        }
                    }
                })
                .catch(() => {
                    document.getElementById('ai-status').textContent = 'Local AI Only';
                });
        }

        function updateCurrentTime() {
            const now = new Date();
            const timeString = now.toLocaleTimeString('en-US', { 
                hour12: false, 
                hour: '2-digit', 
                minute: '2-digit', 
                second: '2-digit' 
            });
            document.getElementById('current-time').textContent = timeString;
        }

        function updateStatusBar(updates) {
            if (updates.project) {
                document.getElementById('current-project').textContent = updates.project;
            }
            if (updates.phase) {
                document.getElementById('current-phase').textContent = updates.phase;
            }
            if (updates.file) {
                document.getElementById('current-file').textContent = updates.file;
            }
            if (updates.status) {
                const statusEl = document.getElementById('workspace-status');
                statusEl.textContent = updates.status;
                statusEl.style.color = updates.statusColor || 'var(--success-color)';
            }
            if (updates.autoSave !== undefined) {
                const autoSaveEl = document.getElementById('auto-save-status');
                autoSaveEl.textContent = updates.autoSave ? 'Auto-save: On' : 'Auto-save: Off';
                autoSaveEl.style.color = updates.autoSave ? 'var(--success-color)' : 'var(--warning-color)';
            }
        }

        function addChatMessage(sender, message, context = null) {
            if (chatManager) {
                chatManager.addMessage(sender, message, context);
            }
        }

        // Chat Control Functions
        function toggleChat() {
            const modal = document.getElementById('chat-modal');
            modal.classList.toggle('active');
            
            if (modal.classList.contains('active') && chatManager) {
                chatManager.addMessage('MITO', 'Ready to assist! You can continue working while we chat. What are you building today?');
            }
        }

        function minimizeChat() {
            const modal = document.getElementById('chat-modal');
            modal.classList.toggle('minimized');
        }

        function sendChatMessage() {
            const input = document.getElementById('chat-input');
            const message = input.value.trim();
            
            if (message && chatManager) {
                chatManager.addMessage('You', message);
                input.value = '';
            }
        }

        // Make chat draggable
        document.addEventListener('DOMContentLoaded', function() {
            const chatModal = document.getElementById('chat-modal');
            const chatHeader = chatModal.querySelector('.chat-header');
            let isDragging = false;
            let dragStart = { x: 0, y: 0 };
            let elementStart = { x: 0, y: 0 };

            if (chatHeader) {
                chatHeader.addEventListener('mousedown', function(e) {
                    if (e.target.classList.contains('chat-control-btn')) return;
                    
                    isDragging = true;
                    dragStart.x = e.clientX;
                    dragStart.y = e.clientY;
                    
                    const rect = chatModal.getBoundingClientRect();
                    elementStart.x = rect.left;
                    elementStart.y = rect.top;
                    
                    document.addEventListener('mousemove', handleDrag);
                    document.addEventListener('mouseup', stopDrag);
                    e.preventDefault();
                });
            }

            function handleDrag(e) {
                if (!isDragging) return;
                
                const deltaX = e.clientX - dragStart.x;
                const deltaY = e.clientY - dragStart.y;
                
                const newX = Math.max(0, Math.min(window.innerWidth - chatModal.offsetWidth, elementStart.x + deltaX));
                const newY = Math.max(0, Math.min(window.innerHeight - chatModal.offsetHeight, elementStart.y + deltaY));
                
                chatModal.style.left = newX + 'px';
                chatModal.style.top = newY + 'px';
                chatModal.style.right = 'auto';
            }

            function stopDrag() {
                isDragging = false;
                document.removeEventListener('mousemove', handleDrag);
                document.removeEventListener('mouseup', stopDrag);
            }
        });

        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        function loadCollaboration() {
            const workspace = document.getElementById('main-canvas');
            workspace.innerHTML = `
                <div class="tool-interface">
                    <h3>Live Collaboration with MITO</h3>
                    <div class="row">
                        <div class="col-md-8">
                            <div class="card">
                                <div class="card-header d-flex justify-content-between align-items-center">
                                    <span>Collaborative Workspace</span>
                                    <div>
                                        <button class="btn btn-sm btn-secondary me-2" onclick="switchCollabMode('text')">Text</button>
                                        <button class="btn btn-sm btn-secondary me-2" onclick="switchCollabMode('code')">Code</button>
                                        <button class="btn btn-sm btn-secondary me-2" onclick="switchCollabMode('image')">Image</button>
                                        <button class="btn btn-sm btn-secondary" onclick="switchCollabMode('design')">Design</button>
                                    </div>
                                </div>
                                <div class="card-body p-0">
                                    <div id="collab-workspace" style="height: 500px; display: flex; flex-direction: column;">
                                        <div id="collab-editor" style="flex: 1; display: flex;">
                                            <div id="user-side" style="flex: 1; border-right: 1px solid var(--border-color);">
                                                <div class="p-3" style="background: var(--accent-bg); border-bottom: 1px solid var(--border-color);">
                                                    <strong>Your Work</strong>
                                                    <small class="text-muted ms-2">Live editing</small>
                                                </div>
                                                <textarea id="user-content" class="form-control" style="height: 430px; border: none; border-radius: 0; resize: none;" placeholder="Start typing here..."></textarea>
                                            </div>
                                            <div id="mito-side" style="flex: 1;">
                                                <div class="p-3" style="background: var(--accent-bg); border-bottom: 1px solid var(--border-color);">
                                                    <strong>MITO's Contribution</strong>
                                                    <small class="text-muted ms-2">Real-time assistance</small>
                                                </div>
                                                <div id="mito-content" style="height: 430px; padding: 15px; overflow-y: auto; background: #1a1a1a; color: #f1f5f9; font-family: monospace;">
MITO is ready to collaborate...

Type something in your workspace and I'll provide real-time assistance, suggestions, and improvements.
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="card mb-3">
                                <div class="card-header">Collaboration Tools</div>
                                <div class="card-body">
                                    <div class="btn-group-vertical w-100 mb-3">
                                        <button class="btn btn-outline-primary mb-2" onclick="requestMitoHelp()">Ask MITO for Help</button>
                                        <button class="btn btn-outline-success mb-2" onclick="generateContent()">Generate Content</button>
                                        <button class="btn btn-outline-info mb-2" onclick="improveContent()">Improve My Work</button>
                                        <button class="btn btn-outline-warning mb-2" onclick="reviewContent()">Review & Feedback</button>
                                    </div>
                                    <div class="form-group">
                                        <label>Collaboration Mode</label>
                                        <select id="collab-mode" class="form-control" onchange="updateCollabMode()">
                                            <option value="writing">Creative Writing</option>
                                            <option value="coding">Code Development</option>
                                            <option value="design">UI/UX Design</option>
                                            <option value="brainstorm">Brainstorming</option>
                                            <option value="documentation">Documentation</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                            <div class="card mb-3">
                                <div class="card-header">Live Activity</div>
                                <div class="card-body">
                                    <div id="activity-feed" style="max-height: 200px; overflow-y: auto; font-size: 0.85rem;">
                                        <div class="activity-item mb-2 p-2" style="background: var(--accent-bg); border-radius: 4px;">
                                            <div class="text-success">MITO joined the session</div>
                                            <small class="text-muted">Just now</small>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="card">
                                <div class="card-header">Quick Actions</div>
                                <div class="card-body">
                                    <button class="btn btn-sm btn-outline-primary w-100 mb-2" onclick="saveCollabSession()">Save Session</button>
                                    <button class="btn btn-sm btn-outline-secondary w-100 mb-2" onclick="exportCollabWork()">Export Work</button>
                                    <button class="btn btn-sm btn-outline-info w-100 mb-2" onclick="shareCollabSession()">Share Session</button>
                                    <button class="btn btn-sm btn-outline-warning w-100" onclick="clearCollabWorkspace()">Clear Workspace</button>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row mt-3">
                        <div class="col-md-12">
                            <div class="card">
                                <div class="card-header">Collaboration History</div>
                                <div class="card-body">
                                    <div id="collab-history" style="max-height: 150px; overflow-y: auto;">
                                        <div class="d-flex justify-content-between align-items-center mb-2 p-2" style="background: var(--accent-bg); border-radius: 4px;">
                                            <div>
                                                <strong>AI Search Engine Documentation</strong>
                                                <small class="text-muted d-block">Collaborative writing session</small>
                                            </div>
                                            <small class="text-muted">2 hours ago</small>
                                        </div>
                                        <div class="d-flex justify-content-between align-items-center mb-2 p-2" style="background: var(--accent-bg); border-radius: 4px;">
                                            <div>
                                                <strong>React Component Development</strong>
                                                <small class="text-muted d-block">Code collaboration</small>
                                            </div>
                                            <small class="text-muted">Yesterday</small>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            // Initialize collaboration features
            initializeCollaboration();
        }

        function initializeCollaboration() {
            const userContent = document.getElementById('user-content');
            const mitoContent = document.getElementById('mito-content');
            
            let typingTimer;
            const typingDelay = 1000; // 1 second delay after user stops typing
            
            userContent.addEventListener('input', function() {
                clearTimeout(typingTimer);
                addActivityFeedItem('You are typing...', 'text-primary');
                
                typingTimer = setTimeout(() => {
                    const content = userContent.value;
                    if (content.trim()) {
                        provideMitoAssistance(content);
                    }
                }, typingDelay);
            });
        }

        function provideMitoAssistance(userContent) {
            const mitoContent = document.getElementById('mito-content');
            const mode = document.getElementById('collab-mode').value;
            
            let assistance = '';
            
            switch(mode) {
                case 'writing':
                    assistance = provideWritingAssistance(userContent);
                    break;
                case 'coding':
                    assistance = provideCodingAssistance(userContent);
                    break;
                case 'design':
                    assistance = provideDesignAssistance(userContent);
                    break;
                case 'brainstorm':
                    assistance = provideBrainstormAssistance(userContent);
                    break;
                case 'documentation':
                    assistance = provideDocumentationAssistance(userContent);
                    break;
            }
            
            mitoContent.innerHTML = assistance;
            addActivityFeedItem('MITO provided assistance', 'text-success');
        }

        function provideWritingAssistance(content) {
            const wordCount = content.split(' ').length;
            const sentences = content.split('.').length - 1;
            
            return `<div class="p-3">
                <h6 class="text-primary">Writing Analysis</h6>
                <p><strong>Word Count:</strong> ${wordCount}</p>
                <p><strong>Sentences:</strong> ${sentences}</p>
                
                <h6 class="text-primary mt-3">Suggestions</h6>
                <ul>
                    <li>Consider adding more descriptive adjectives</li>
                    <li>Vary your sentence structure for better flow</li>
                    <li>Add transitions between paragraphs</li>
                </ul>
                
                <h6 class="text-primary mt-3">MITO's Enhancement</h6>
                <div style="background: #2a2a2a; padding: 10px; border-radius: 4px; margin-top: 10px;">
                    <em>Enhanced version with improved flow and clarity...</em>
                </div>
            </div>`;
        }

        function provideCodingAssistance(content) {
            return `<div class="p-3">
                <h6 class="text-primary">Code Analysis</h6>
                <p><strong>Language:</strong> Auto-detected</p>
                <p><strong>Lines:</strong> ${content.split('\\n').length}</p>
                
                <h6 class="text-primary mt-3">Code Suggestions</h6>
                <ul>
                    <li>Add error handling</li>
                    <li>Consider using async/await</li>
                    <li>Add type annotations</li>
                </ul>
                
                <h6 class="text-primary mt-3">MITO's Code Review</h6>
                <div style="background: #2a2a2a; padding: 10px; border-radius: 4px; margin-top: 10px; font-family: monospace;">
                    // MITO's improved version
                    <br>// with best practices applied...
                </div>
            </div>`;
        }

        function provideDesignAssistance(content) {
            return `<div class="p-3">
                <h6 class="text-primary">Design Feedback</h6>
                <p>Analyzing your design concept...</p>
                
                <h6 class="text-primary mt-3">UI/UX Suggestions</h6>
                <ul>
                    <li>Consider improving color contrast</li>
                    <li>Add more whitespace for readability</li>
                    <li>Ensure mobile responsiveness</li>
                </ul>
                
                <h6 class="text-primary mt-3">MITO's Design Ideas</h6>
                <div style="background: #2a2a2a; padding: 10px; border-radius: 4px; margin-top: 10px;">
                    <em>Alternative design concepts and improvements...</em>
                </div>
            </div>`;
        }

        function provideBrainstormAssistance(content) {
            return `<div class="p-3">
                <h6 class="text-primary">Brainstorm Expansion</h6>
                <p>Building on your ideas...</p>
                
                <h6 class="text-primary mt-3">Related Concepts</h6>
                <ul>
                    <li>Machine learning integration</li>
                    <li>User experience optimization</li>
                    <li>Scalability considerations</li>
                </ul>
                
                <h6 class="text-primary mt-3">MITO's Additional Ideas</h6>
                <div style="background: #2a2a2a; padding: 10px; border-radius: 4px; margin-top: 10px;">
                    <em>Creative extensions and new perspectives...</em>
                </div>
            </div>`;
        }

        function provideDocumentationAssistance(content) {
            return `<div class="p-3">
                <h6 class="text-primary">Documentation Review</h6>
                <p>Checking for clarity and completeness...</p>
                
                <h6 class="text-primary mt-3">Documentation Tips</h6>
                <ul>
                    <li>Add code examples</li>
                    <li>Include troubleshooting section</li>
                    <li>Add API reference</li>
                </ul>
                
                <h6 class="text-primary mt-3">MITO's Structured Version</h6>
                <div style="background: #2a2a2a; padding: 10px; border-radius: 4px; margin-top: 10px;">
                    <em>Well-organized documentation with proper sections...</em>
                </div>
            </div>`;
        }

        function addActivityFeedItem(message, className = 'text-info') {
            const activityFeed = document.getElementById('activity-feed');
            const timestamp = new Date().toLocaleTimeString();
            
            const activityItem = document.createElement('div');
            activityItem.className = 'activity-item mb-2 p-2';
            activityItem.style.cssText = 'background: var(--accent-bg); border-radius: 4px;';
            
            activityItem.innerHTML = `
                <div class="${className}">${message}</div>
                <small class="text-muted">${timestamp}</small>
            `;
            
            activityFeed.insertBefore(activityItem, activityFeed.firstChild);
            
            // Keep only last 10 items
            while (activityFeed.children.length > 10) {
                activityFeed.removeChild(activityFeed.lastChild);
            }
        }

        function requestMitoHelp() {
            const userContent = document.getElementById('user-content').value;
            if (!userContent.trim()) {
                alert('Please add some content first so MITO can help you with it.');
                return;
            }
            
            addActivityFeedItem('Requesting MITO assistance...', 'text-warning');
            
            // Simulate API call for help
            setTimeout(() => {
                provideMitoAssistance(userContent);
                addChatMessage('MITO', 'I\'ve analyzed your work and provided suggestions in the collaboration panel.');
            }, 1000);
        }

        function generateContent() {
            const mode = document.getElementById('collab-mode').value;
            addActivityFeedItem('Generating content...', 'text-warning');
            
            setTimeout(() => {
                const mitoContent = document.getElementById('mito-content');
                mitoContent.innerHTML = `<div class="p-3">
                    <h6 class="text-primary">Generated Content</h6>
                    <div style="background: #2a2a2a; padding: 15px; border-radius: 4px; margin-top: 10px;">
                        <p>Here's some generated content based on your ${mode} mode:</p>
                        <p>This is a sample of what MITO can create to help jumpstart your work...</p>
                    </div>
                </div>`;
                addActivityFeedItem('Content generated successfully', 'text-success');
            }, 1500);
        }

        function improveContent() {
            const userContent = document.getElementById('user-content').value;
            if (!userContent.trim()) {
                alert('Please add some content first so MITO can improve it.');
                return;
            }
            
            addActivityFeedItem('Improving your content...', 'text-warning');
            provideMitoAssistance(userContent);
        }

        function reviewContent() {
            const userContent = document.getElementById('user-content').value;
            if (!userContent.trim()) {
                alert('Please add some content first so MITO can review it.');
                return;
            }
            
            addActivityFeedItem('Reviewing content...', 'text-warning');
            
            setTimeout(() => {
                const mitoContent = document.getElementById('mito-content');
                mitoContent.innerHTML = `<div class="p-3">
                    <h6 class="text-primary">Content Review</h6>
                    <div class="mb-3">
                        <span class="badge bg-success me-2">Strengths</span>
                        <span class="badge bg-warning me-2">Areas for Improvement</span>
                        <span class="badge bg-info">Suggestions</span>
                    </div>
                    <div style="background: #2a2a2a; padding: 15px; border-radius: 4px;">
                        <p><strong>Overall Assessment:</strong> Good foundation with room for enhancement.</p>
                        <p><strong>Key Recommendations:</strong></p>
                        <ul>
                            <li>Strengthen the opening paragraph</li>
                            <li>Add more specific examples</li>
                            <li>Improve conclusion</li>
                        </ul>
                    </div>
                </div>`;
                addActivityFeedItem('Review completed', 'text-success');
            }, 2000);
        }

        function updateCollabMode() {
            const mode = document.getElementById('collab-mode').value;
            addActivityFeedItem(`Switched to ${mode} mode`, 'text-info');
            
            const userContent = document.getElementById('user-content').value;
            if (userContent.trim()) {
                provideMitoAssistance(userContent);
            }
        }

        function loadFileBrowser() {
            const workspace = document.getElementById('main-canvas');
            workspace.innerHTML = `
                <div style="height: 100%; display: flex; flex-direction: column;">
                    <iframe src="/mito-files" 
                            style="width: 100%; height: 100%; border: none; border-radius: 8px; 
                                   background: white; box-shadow: 0 4px 12px rgba(0,0,0,0.1);">
                    </iframe>
                </div>
            `;
        }

        function switchCollabMode(mode) {
            // Update the workspace based on mode
            if (mode === 'image') {
                const workspace = document.getElementById('collab-workspace');
                workspace.innerHTML = `
                    <div style="height: 500px; display: flex;">
                        <div style="flex: 1; border-right: 1px solid var(--border-color); padding: 20px;">
                            <h6>Image Collaboration</h6>
                            <div class="form-group mb-3">
                                <label>Image Prompt</label>
                                <textarea class="form-control" rows="4" placeholder="Describe the image you want to create..."></textarea>
                            </div>
                            <button class="btn btn-primary" onclick="generateCollabImage()">Generate with MITO</button>
                            <div id="image-preview" class="mt-3" style="border: 2px dashed var(--border-color); height: 200px; display: flex; align-items: center; justify-content: center; border-radius: 8px;">
                                Image will appear here
                            </div>
                        </div>
                        <div style="flex: 1; padding: 20px;">
                            <h6>MITO's Image Suggestions</h6>
                            <div id="image-suggestions" style="background: #1a1a1a; color: #f1f5f9; padding: 15px; border-radius: 8px; height: 400px; overflow-y: auto;">
                                Describe your image idea and I'll help you create the perfect prompt and generate variations...
                            </div>
                        </div>
                    </div>
                `;
            }
            addActivityFeedItem(`Switched to ${mode} collaboration mode`, 'text-info');
        }

        function saveCollabSession() {
            const userContent = document.getElementById('user-content').value;
            const sessionName = prompt('Enter a name for this collaboration session:');
            
            if (sessionName) {
                addActivityFeedItem(`Session "${sessionName}" saved`, 'text-success');
                addChatMessage('MITO', `Collaboration session "${sessionName}" has been saved successfully.`);
            }
        }

        function exportCollabWork() {
            const userContent = document.getElementById('user-content').value;
            const mitoContent = document.getElementById('mito-content').textContent;
            
            const exportData = {
                userWork: userContent,
                mitoContribution: mitoContent,
                timestamp: new Date().toISOString(),
                mode: document.getElementById('collab-mode').value
            };
            
            const blob = new Blob([JSON.stringify(exportData, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'collaboration-export.json';
            a.click();
            
            addActivityFeedItem('Work exported successfully', 'text-success');
        }

        function shareCollabSession() {
            const shareUrl = `${window.location.origin}/collab/session/${Date.now()}`;
            navigator.clipboard.writeText(shareUrl).then(() => {
                addActivityFeedItem('Share link copied to clipboard', 'text-success');
                addChatMessage('MITO', 'Collaboration session link copied to clipboard. Share it with others to collaborate in real-time.');
            });
        }

        function clearCollabWorkspace() {
            if (confirm('Are you sure you want to clear the workspace? This action cannot be undone.')) {
                document.getElementById('user-content').value = '';
                document.getElementById('mito-content').innerHTML = 'MITO is ready to collaborate...';
                addActivityFeedItem('Workspace cleared', 'text-warning');
            }
        }

        // Terminal Functions
        function executeCommand() {
            const input = document.getElementById('terminal-input');
            const output = document.getElementById('terminal-output');
            const command = input.value.trim();
            
            if (!command) return;
            
            output.innerHTML += `$ ${command}\n`;
            
            // Simulate command execution
            setTimeout(() => {
                let result = '';
                switch(command.split(' ')[0]) {
                    case 'help':
                        result = 'Available commands: ls, pwd, ps, df, free, top, clear, help\n';
                        break;
                    case 'ls':
                        result = 'app.py  config.py  templates/  static/  requirements.txt\n';
                        break;
                    case 'pwd':
                        result = '/home/user/mito-engine\n';
                        break;
                    case 'ps':
                        result = 'PID   CMD\n1234  mito-engine\n5678  python3\n';
                        break;
                    case 'clear':
                        output.innerHTML = 'MITO Terminal v1.0.0\nType \'help\' for available commands.\n\n$ ';
                        input.value = '';
                        return;
                    default:
                        result = `Command '${command}' not found\n`;
                }
                output.innerHTML += result + '$ ';
                output.scrollTop = output.scrollHeight;
                addToCommandHistory(command);
            }, 500);
            
            input.value = '';
        }

        function runQuickCommand(command) {
            document.getElementById('terminal-input').value = command;
            executeCommand();
        }

        function clearTerminal() {
            document.getElementById('terminal-output').innerHTML = 'MITO Terminal v1.0.0\nType \'help\' for available commands.\n\n$ ';
        }

        function newTerminalTab() {
            addChatMessage('MITO', 'New terminal tab functionality would open a new terminal instance.');
        }

        function addToCommandHistory(command) {
            const history = document.getElementById('command-history');
            const item = document.createElement('div');
            item.textContent = `$ ${command}`;
            item.style.marginBottom = '5px';
            history.insertBefore(item, history.firstChild);
            
            while (history.children.length > 10) {
                history.removeChild(history.lastChild);
            }
        }

        // Package Manager Functions
        function installPackages() {
            const packageNames = document.getElementById('package-names').value;
            const packageManager = document.getElementById('package-manager-type').value;
            const saveDev = document.getElementById('save-dev').checked;
            const globalInstall = document.getElementById('global-install').checked;
            
            if (!packageNames.trim()) {
                alert('Please enter package names to install.');
                return;
            }
            
            const log = document.getElementById('package-log');
            log.innerHTML += `\nInstalling packages: ${packageNames}\n`;
            log.innerHTML += `Using ${packageManager}...\n`;
            
            setTimeout(() => {
                log.innerHTML += `✓ Installation completed successfully\n`;
                log.scrollTop = log.scrollHeight;
                updateInstalledPackages(packageNames.split(','));
            }, 2000);
        }

        function uninstallPackages() {
            const packageNames = document.getElementById('package-names').value;
            if (!packageNames.trim()) {
                alert('Please enter package names to uninstall.');
                return;
            }
            
            const log = document.getElementById('package-log');
            log.innerHTML += `\nUninstalling packages: ${packageNames}\n`;
            
            setTimeout(() => {
                log.innerHTML += `✓ Uninstallation completed\n`;
                log.scrollTop = log.scrollHeight;
            }, 1500);
        }

        function updatePackages() {
            const log = document.getElementById('package-log');
            log.innerHTML += `\nUpdating all packages...\n`;
            
            setTimeout(() => {
                log.innerHTML += `✓ All packages updated to latest versions\n`;
                log.scrollTop = log.scrollHeight;
            }, 3000);
        }

        function removePackage(packageName) {
            if (confirm(`Remove ${packageName}?`)) {
                const log = document.getElementById('package-log');
                log.innerHTML += `\nRemoving ${packageName}...\n`;
                log.innerHTML += `✓ ${packageName} removed successfully\n`;
                log.scrollTop = log.scrollHeight;
            }
        }

        function updateInstalledPackages(newPackages) {
            const container = document.getElementById('installed-packages');
            newPackages.forEach(pkg => {
                const pkgName = pkg.trim();
                if (pkgName) {
                    const item = document.createElement('div');
                    item.className = 'package-item d-flex justify-content-between align-items-center mb-2 p-2';
                    item.style.cssText = 'background: var(--accent-bg); border-radius: 4px;';
                    item.innerHTML = `
                        <div>
                            <strong>${pkgName}</strong>
                            <small class="text-muted">^1.0.0</small>
                        </div>
                        <button class="btn btn-sm btn-outline-danger" onclick="removePackage('${pkgName}')">Remove</button>
                    `;
                    container.appendChild(item);
                }
            });
        }

        // API Tester Functions
        function sendAPIRequest() {
            const method = document.getElementById('http-method').value;
            const url = document.getElementById('api-url').value;
            const headers = document.getElementById('api-headers').value;
            const body = document.getElementById('api-body').value;
            
            if (!url.trim()) {
                alert('Please enter a URL.');
                return;
            }
            
            const statusEl = document.getElementById('response-status');
            const responseEl = document.getElementById('api-response');
            const timeEl = document.getElementById('response-time');
            
            statusEl.innerHTML = '<span class="badge bg-warning">Sending...</span>';
            responseEl.textContent = 'Sending request...';
            
            const startTime = Date.now();
            
            setTimeout(() => {
                const endTime = Date.now();
                const responseTime = endTime - startTime;
                
                statusEl.innerHTML = '<span class="badge bg-success">200 OK</span>';
                timeEl.textContent = `${responseTime}ms`;
                
                responseEl.textContent = JSON.stringify({
                    message: "API request simulation",
                    status: "success",
                    data: {
                        method: method,
                        url: url,
                        timestamp: new Date().toISOString()
                    }
                }, null, 2);
                
                addToRequestHistory(method, url);
            }, Math.random() * 1000 + 500);
        }

        function addToRequestHistory(method, url) {
            const history = document.getElementById('request-history');
            const item = document.createElement('div');
            item.className = 'history-item p-2 mb-2';
            item.style.cssText = 'background: var(--accent-bg); border-radius: 4px; cursor: pointer;';
            item.innerHTML = `
                <strong>${method}</strong> ${url}
                <small class="text-muted d-block">Just now</small>
            `;
            history.insertBefore(item, history.firstChild);
        }

        function saveAPIRequest() {
            addChatMessage('MITO', 'API request saved to presets.');
        }

        function loadAPIPreset() {
            document.getElementById('http-method').value = 'GET';
            document.getElementById('api-url').value = 'https://api.example.com/users';
            document.getElementById('api-headers').value = 'Content-Type: application/json';
            addChatMessage('MITO', 'API preset loaded.');
        }

        // Utility Functions
        function formatJSON() {
            const input = document.getElementById('json-input').value;
            const result = document.getElementById('format-result');
            
            try {
                const parsed = JSON.parse(input);
                result.textContent = JSON.stringify(parsed, null, 2);
            } catch (e) {
                result.textContent = 'Invalid JSON: ' + e.message;
            }
        }

        function formatXML() {
            const input = document.getElementById('json-input').value;
            const result = document.getElementById('format-result');
            result.textContent = 'XML formatting simulated - would format XML content here';
        }

        function minifyJSON() {
            const input = document.getElementById('json-input').value;
            const result = document.getElementById('format-result');
            
            try {
                const parsed = JSON.parse(input);
                result.textContent = JSON.stringify(parsed);
            } catch (e) {
                result.textContent = 'Invalid JSON: ' + e.message;
            }
        }

        function validateJSON() {
            const input = document.getElementById('json-input').value;
            const result = document.getElementById('format-result');
            
            try {
                JSON.parse(input);
                result.textContent = '✓ Valid JSON';
            } catch (e) {
                result.textContent = '✗ Invalid JSON: ' + e.message;
            }
        }

        function transformText(type) {
            const input = document.getElementById('text-input').value;
            const result = document.getElementById('text-result');
            
            switch(type) {
                case 'uppercase':
                    result.textContent = input.toUpperCase();
                    break;
                case 'lowercase':
                    result.textContent = input.toLowerCase();
                    break;
                case 'title':
                    result.textContent = input.replace(/\w\S*/g, (txt) => 
                        txt.charAt(0).toUpperCase() + txt.substr(1).toLowerCase());
                    break;
            }
        }

        function encodeText(type) {
            const input = document.getElementById('text-input').value;
            const result = document.getElementById('text-result');
            
            switch(type) {
                case 'base64':
                    result.textContent = btoa(input);
                    break;
                case 'url':
                    result.textContent = encodeURIComponent(input);
                    break;
                case 'html':
                    result.textContent = input.replace(/[&<>"']/g, function(m) {
                        return {'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":"&#39;"}[m];
                    });
                    break;
            }
        }

        function testRegex() {
            const pattern = document.getElementById('regex-pattern').value;
            const text = document.getElementById('text-input').value;
            const result = document.getElementById('text-result');
            
            try {
                const regex = new RegExp(pattern, 'g');
                const matches = text.match(regex);
                result.textContent = matches ? `Matches: ${matches.join(', ')}` : 'No matches found';
            } catch (e) {
                result.textContent = 'Invalid regex: ' + e.message;
            }
        }

        function selectColor(color) {
            document.getElementById('color-picker').value = color;
            document.getElementById('hex-value').value = color;
            document.getElementById('color-preview').style.backgroundColor = color;
            updateRGBValue(color);
        }

        function updateRGBValue(hex) {
            const r = parseInt(hex.slice(1, 3), 16);
            const g = parseInt(hex.slice(3, 5), 16);
            const b = parseInt(hex.slice(5, 7), 16);
            document.getElementById('rgb-value').value = `rgb(${r}, ${g}, ${b})`;
        }

        function generateQR() {
            const text = document.getElementById('qr-text').value;
            const size = document.getElementById('qr-size').value;
            const result = document.getElementById('qr-result');
            
            if (!text.trim()) {
                alert('Please enter text to generate QR code.');
                return;
            }
            
            result.innerHTML = `
                <div style="width: ${size}px; height: ${size}px; background: white; border: 2px solid var(--border-color); border-radius: 8px; display: flex; align-items: center; justify-content: center; margin: 0 auto; font-family: monospace;">
                    QR Code for:<br>"${text.substring(0, 20)}${text.length > 20 ? '...' : ''}"
                </div>
            `;
        }

        // System Monitor Functions
        function refreshProcesses() {
            addChatMessage('MITO', 'Process list refreshed.');
        }

        function killProcess(pid) {
            if (confirm(`Kill process ${pid}?`)) {
                addChatMessage('MITO', `Process ${pid} terminated.`);
            }
        }

        function runTests() {
            addChatMessage('MITO', 'Running test suite for current project...');
            
            setTimeout(() => {
                const results = `
Test Results:
✓ Unit tests: 24/24 passed
✓ Integration tests: 8/8 passed  
✓ Performance tests: 5/5 passed
✓ Security scans: No issues found
✓ Code coverage: 87%

All tests completed successfully!
                `;
                addChatMessage('MITO', results);
            }, 2000);
        }

        function deployApp() {
            addChatMessage('MITO', 'Initiating deployment process...');
            
            const deploySteps = [
                'Building application bundle...',
                'Running security checks...',
                'Uploading to production server...',
                'Configuring environment variables...',
                'Starting application services...',
                'Deployment completed successfully!'
            ];
            
            deploySteps.forEach((step, index) => {
                setTimeout(() => {
                    addChatMessage('MITO', step);
                }, (index + 1) * 1000);
            });
        }

        function exportProject() {
            const projectData = {
                name: 'AI Search Engine',
                phase: 'Architecture Design',
                progress: '60%',
                files: [
                    'search_engine.py',
                    'embeddings.py', 
                    'api.py',
                    'requirements.txt',
                    'README.md'
                ],
                timestamp: new Date().toISOString()
            };
            
            const blob = new Blob([JSON.stringify(projectData, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'mito-project-export.json';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            addChatMessage('MITO', 'Project exported successfully! Download should start automatically.');
        }

        // Tool Loading Functions
        function loadCodeGenerator() {
            const workspace = document.getElementById('main-canvas');
            workspace.innerHTML = `
                <div class="tool-interface">
                    <h3> Code Generator</h3>
                    <div class="row">
                        <div class="col-md-6">
                            <div class="form-group">
                                <label>Project Description</label>
                                <textarea id="code-prompt" class="form-control" rows="4" placeholder="Describe what you want to build..."></textarea>
                            </div>
                            <div class="form-group">
                                <label>Programming Language</label>
                                <select id="code-language" class="form-control">
                                    <option value="python">Python</option>
                                    <option value="javascript">JavaScript</option>
                                    <option value="java">Java</option>
                                    <option value="cpp">C++</option>
                                    <option value="rust">Rust</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>Framework</label>
                                <select id="code-framework" class="form-control">
                                    <option value="flask">Flask</option>
                                    <option value="react">React</option>
                                    <option value="express">Express.js</option>
                                    <option value="fastapi">FastAPI</option>
                                    <option value="django">Django</option>
                                </select>
                            </div>
                            <button class="btn btn-primary" onclick="generateCompleteCode()">Generate Code</button>
                        </div>
                        <div class="col-md-6">
                            <div class="code-output" style="background: #1a1a1a; padding: 15px; border-radius: 8px; min-height: 400px;">
                                <div id="generated-code" style="color: #f1f5f9; font-family: monospace;">Generated code will appear here...</div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        function loadModelTrainer() {
            const workspace = document.getElementById('main-canvas');
            workspace.innerHTML = `
                <div class="tool-interface">
                    <h3> Model Trainer</h3>
                    <div class="row">
                        <div class="col-md-4">
                            <div class="card">
                                <div class="card-header">Training Configuration</div>
                                <div class="card-body">
                                    <div class="form-group">
                                        <label>Model Type</label>
                                        <select class="form-control">
                                            <option>Text Classification</option>
                                            <option>Image Recognition</option>
                                            <option>Language Model</option>
                                            <option>Recommendation System</option>
                                        </select>
                                    </div>
                                    <div class="form-group">
                                        <label>Dataset</label>
                                        <input type="file" class="form-control" accept=".csv,.json,.txt">
                                    </div>
                                    <div class="form-group">
                                        <label>Training Epochs</label>
                                        <input type="number" class="form-control" value="10">
                                    </div>
                                    <button class="btn btn-success" onclick="startTraining()">Start Training</button>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-8">
                            <div class="card">
                                <div class="card-header">Training Progress</div>
                                <div class="card-body">
                                    <div class="progress mb-3">
                                        <div id="training-progress" class="progress-bar" style="width: 0%">0%</div>
                                    </div>
                                    <div id="training-logs" style="background: #1a1a1a; color: #f1f5f9; padding: 15px; border-radius: 8px; height: 300px; overflow-y: auto;">
                                        Training logs will appear here...
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        function loadNLUProcessor() {
            const workspace = document.getElementById('main-canvas');
            workspace.innerHTML = `
                <div class="tool-interface">
                    <h3> NLU Processor</h3>
                    <div class="row">
                        <div class="col-md-6">
                            <div class="card">
                                <div class="card-header">Text Analysis</div>
                                <div class="card-body">
                                    <textarea id="nlu-text" class="form-control" rows="6" placeholder="Enter text to analyze..."></textarea>
                                    <div class="mt-3">
                                        <button class="btn btn-primary me-2" onclick="analyzeSentiment()">Sentiment Analysis</button>
                                        <button class="btn btn-secondary me-2" onclick="extractEntities()">Entity Extraction</button>
                                        <button class="btn btn-info" onclick="classifyText()">Text Classification</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="card">
                                <div class="card-header">Analysis Results</div>
                                <div class="card-body">
                                    <div id="nlu-results" style="background: #1a1a1a; color: #f1f5f9; padding: 15px; border-radius: 8px; min-height: 300px;">
                                        Analysis results will appear here...
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        function loadProjectTemplates() {
            const workspace = document.getElementById('main-canvas');
            workspace.innerHTML = `
                <div class="tool-interface">
                    <h3> Project Templates</h3>
                    <div class="row">
                        <div class="col-md-4">
                            <div class="card template-card" onclick="selectTemplate('web-app')">
                                <div class="card-body">
                                    <h5>Web Application</h5>
                                    <p>Full-stack web app with React + Flask</p>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="card template-card" onclick="selectTemplate('api-service')">
                                <div class="card-body">
                                    <h5>API Service</h5>
                                    <p>RESTful API with FastAPI + PostgreSQL</p>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="card template-card" onclick="selectTemplate('ai-chatbot')">
                                <div class="card-body">
                                    <h5>AI Chatbot</h5>
                                    <p>Conversational AI with LLM integration</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="mt-4">
                        <div id="template-config" style="display: none;">
                            <h4>Configure Template</h4>
                            <div class="form-group">
                                <label>Project Name</label>
                                <input type="text" id="template-name" class="form-control">
                            </div>
                            <div class="form-group">
                                <label>Description</label>
                                <textarea id="template-description" class="form-control" rows="3"></textarea>
                            </div>
                            <button class="btn btn-success" onclick="createFromTemplate()">Create Project</button>
                        </div>
                    </div>
                </div>
            `;
        }

        function loadAgentBuilder() {
            const workspace = document.getElementById('main-canvas');
            workspace.innerHTML = `
                <div class="tool-interface">
                    <h3> Agent Builder</h3>
                    <div class="row">
                        <div class="col-md-4">
                            <div class="card">
                                <div class="card-header">Agent Configuration</div>
                                <div class="card-body">
                                    <div class="form-group">
                                        <label>Agent Name</label>
                                        <input type="text" class="form-control" placeholder="My AI Agent">
                                    </div>
                                    <div class="form-group">
                                        <label>Agent Type</label>
                                        <select class="form-control">
                                            <option>Customer Support</option>
                                            <option>Data Analyst</option>
                                            <option>Content Creator</option>
                                            <option>Code Assistant</option>
                                        </select>
                                    </div>
                                    <div class="form-group">
                                        <label>Personality</label>
                                        <textarea class="form-control" rows="3" placeholder="Describe agent personality..."></textarea>
                                    </div>
                                    <div class="form-group">
                                        <label>Skills</label>
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" value="web-search">
                                            <label class="form-check-label">Web Search</label>
                                        </div>
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" value="file-analysis">
                                            <label class="form-check-label">File Analysis</label>
                                        </div>
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" value="code-generation">
                                            <label class="form-check-label">Code Generation</label>
                                        </div>
                                    </div>
                                    <button class="btn btn-primary" onclick="buildAgent()">Build Agent</button>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-8">
                            <div class="card">
                                <div class="card-header">Agent Preview</div>
                                <div class="card-body">
                                    <div id="agent-preview" style="background: #1a1a1a; color: #f1f5f9; padding: 15px; border-radius: 8px; min-height: 400px;">
                                        Agent preview will appear here...
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        function loadEcosystemOrchestrator() {
            const workspace = document.getElementById('main-canvas');
            workspace.innerHTML = `
                <div class="tool-interface">
                    <h3> Ecosystem Orchestrator</h3>
                    <div class="ecosystem-view">
                        <div class="ecosystem-node" style="top: 50px; left: 100px;" onclick="selectNode('core')">
                            <div class="node-icon">CORE</div>
                            <div class="node-label">MITO Core</div>
                        </div>
                        <div class="ecosystem-node" style="top: 150px; left: 250px;" onclick="selectNode('ai-factory')">
                            <div class="node-icon">AI</div>
                            <div class="node-label">AI Factory</div>
                        </div>
                        <div class="ecosystem-node" style="top: 250px; left: 100px;" onclick="selectNode('database')">
                            <div class="node-icon">DB</div>
                            <div class="node-label">Database</div>
                        </div>
                        <div class="ecosystem-node" style="top: 150px; left: 400px;" onclick="selectNode('apis')">
                            <div class="node-icon">API</div>
                            <div class="node-label">APIs</div>
                        </div>
                    </div>
                    <div class="ecosystem-controls mt-4">
                        <button class="btn btn-primary me-2" onclick="addEcosystemNode()">Add Node</button>
                        <button class="btn btn-secondary me-2" onclick="connectNodes()">Connect Nodes</button>
                        <button class="btn btn-success" onclick="deployEcosystem()">Deploy Ecosystem</button>
                    </div>
                </div>
            `;
        }

        function loadCodeEditor() {
            const workspace = document.getElementById('main-canvas');
            workspace.innerHTML = `
                <div class="tool-interface">
                    <h3><i class="fas fa-code"></i> MITO Code Editor & Flow Designer</h3>
                    <div class="row mb-3">
                        <div class="col-md-12">
                            <div class="btn-group">
                                <button class="btn btn-primary" onclick="openCodeEditor()">Open Full Editor</button>
                                <button class="btn btn-secondary" onclick="createNewFile()">New File</button>
                                <button class="btn btn-info" onclick="loadProjectFiles()">Load Project</button>
                                <button class="btn btn-success" onclick="savAllFiles()">Save All</button>
                            </div>
                        </div>
                    </div>
                    
                    <div class="row">
                        <div class="col-md-3">
                            <div class="card">
                                <div class="card-header">Project Files</div>
                                <div class="card-body">
                                    <div id="file-tree" style="font-family: monospace; max-height: 400px; overflow-y: auto;">
                                        <div onclick="selectFile('app.py')" class="file-item" style="padding: 8px; cursor: pointer; border-radius: 4px;">
                                            <i class="fab fa-python"></i> app.py
                                        </div>
                                        <div onclick="selectFile('config.py')" class="file-item" style="padding: 8px; cursor: pointer; border-radius: 4px;">
                                            <i class="fab fa-python"></i> config.py
                                        </div>
                                        <div onclick="selectFile('models.py')" class="file-item" style="padding: 8px; cursor: pointer; border-radius: 4px;">
                                            <i class="fab fa-python"></i> models.py
                                        </div>
                                        <div onclick="selectFile('main.py')" class="file-item" style="padding: 8px; cursor: pointer; border-radius: 4px;">
                                            <i class="fab fa-python"></i> main.py
                                        </div>
                                        <div onclick="selectFile('templates/giant_workbench.html')" class="file-item" style="padding: 8px; cursor: pointer; border-radius: 4px;">
                                            <i class="fab fa-html5"></i> giant_workbench.html
                                        </div>
                                        <div onclick="selectFile('MITO_Engine_Architecture_Flow.md')" class="file-item" style="padding: 8px; cursor: pointer; border-radius: 4px;">
                                            <i class="fas fa-file-alt"></i> Architecture_Flow.md
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="card mt-3">
                                <div class="card-header">Mermaid Diagrams</div>
                                <div class="card-body">
                                    <button class="btn btn-sm btn-primary mb-2 w-100" onclick="createMermaidDiagram('flowchart')">Create Flowchart</button>
                                    <button class="btn btn-sm btn-secondary mb-2 w-100" onclick="createMermaidDiagram('sequence')">Sequence Diagram</button>
                                    <button class="btn btn-sm btn-info mb-2 w-100" onclick="createMermaidDiagram('architecture')">System Architecture</button>
                                    <button class="btn btn-sm btn-success w-100" onclick="viewMermaidFlow()">View MITO Flow</button>
                                </div>
                            </div>
                        </div>
                        
                        <div class="col-md-9">
                            <div class="card">
                                <div class="card-header d-flex justify-content-between align-items-center">
                                    <span id="current-file-name">Select a file to edit</span>
                                    <div class="btn-group btn-group-sm">
                                        <button class="btn btn-outline-secondary" onclick="toggleCodeView()">Code</button>
                                        <button class="btn btn-outline-secondary" onclick="toggleMermaidView()">Mermaid</button>
                                        <button class="btn btn-outline-secondary" onclick="togglePreview()">Preview</button>
                                    </div>
                                </div>
                                <div class="card-body p-0">
                                    <textarea id="inline-code-editor" style="height: 500px; width: 100%; font-family: 'Consolas', 'Monaco', monospace; background: #1e1e1e; color: #d4d4d4; padding: 15px; border: none; resize: none; outline: none; white-space: pre;" placeholder="Select a file to start editing..." oncontextmenu="showContextMenu(event)"># Welcome to MITO Code Editor
# Click on a file to start editing
# 
# Features:
# - Live syntax highlighting
# - Auto-completion
# - Mermaid diagram support
# - Real-time collaboration
# - Git integration

def welcome_to_mito():
    print("MITO Engine - AI Agent & Tool Creator")
    print("Version: 1.2.0")
    print("Created by: Daniel Guzman")
    return "Ready for development!"</textarea>
                                    
                                    <div id="mermaid-preview" style="display: none; height: 500px; background: white; padding: 15px; overflow: auto;">
                                        <div id="mermaid-content"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            // Add file item hover effects
            setTimeout(() => {
                const fileItems = document.querySelectorAll('.file-item');
                fileItems.forEach(item => {
                    item.addEventListener('mouseenter', function() {
                        this.style.backgroundColor = 'var(--accent-bg)';
                    });
                    item.addEventListener('mouseleave', function() {
                        this.style.backgroundColor = 'transparent';
                    });
                });
            }, 100);
        }
        
        // Code Editor Functions
        function openCodeEditor() {
            window.open('/code-editor', '_blank');
        }
        
        function selectFile(filename) {
            document.getElementById('current-file-name').textContent = filename;
            
            // Load file content
            fetch(`/api/get-file-content?file=${encodeURIComponent(filename)}`)
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        const editor = document.getElementById('inline-code-editor');
                        editor.value = data.content;
                        applySyntaxHighlighting(filename, data.content);
                        addChatMessage('MITO', `Loaded ${filename} - ${data.size} characters`);
                    } else {
                        addChatMessage('MITO', `Could not load ${filename}: ${data.error}`);
                    }
                })
                .catch(error => {
                    addChatMessage('MITO', `Error loading file: ${error.message}`);
                });
        }
        
        function createNewFile() {
            const filename = prompt('Enter filename (e.g., new_file.py):');
            if (filename) {
                document.getElementById('current-file-name').textContent = filename;
                document.getElementById('inline-code-editor').textContent = `# New file: ${filename}\n# Created by MITO Engine\n\n`;
                addChatMessage('MITO', `Created new file: ${filename}`);
            }
        }
        
        function saveFile() {
            const filename = document.getElementById('current-file-name').textContent;
            const content = document.getElementById('inline-code-editor').value;
            
            if (filename === 'Select a file to edit') {
                alert('Please select or create a file first');
                return;
            }
            
            fetch('/api/save-file', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    filename: filename,
                    content: content
                })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    addChatMessage('MITO', `Saved ${filename} successfully`);
                } else {
                    addChatMessage('MITO', `Failed to save ${filename}: ${data.error}`);
                }
            });
        }
        
        function applySyntaxHighlighting(filename, content) {
            // Basic syntax highlighting based on file extension
            const editor = document.getElementById('inline-code-editor');
            
            // Add line numbers and basic highlighting
            if (filename.endsWith('.py')) {
                editor.setAttribute('data-language', 'python');
            } else if (filename.endsWith('.js')) {
                editor.setAttribute('data-language', 'javascript');
            } else if (filename.endsWith('.html')) {
                editor.setAttribute('data-language', 'html');
            } else if (filename.endsWith('.css')) {
                editor.setAttribute('data-language', 'css');
            } else if (filename.endsWith('.md')) {
                editor.setAttribute('data-language', 'markdown');
            } else if (filename.endsWith('.json')) {
                editor.setAttribute('data-language', 'json');
            }
        }
        
        function addKeyboardShortcuts() {
            const editor = document.getElementById('inline-code-editor');
            
            if (!editor) {
                console.log('Code editor not found, will retry later');
                return;
            }
            
            editor.addEventListener('keydown', function(e) {
                // Ctrl+S to save
                if ((e.ctrlKey || e.metaKey) && e.key === 's') {
                    e.preventDefault();
                    saveFile();
                    return false;
                }
                
                // Ctrl+C to copy
                if ((e.ctrlKey || e.metaKey) && e.key === 'c') {
                    const selectedText = this.value.substring(this.selectionStart, this.selectionEnd);
                    if (selectedText) {
                        navigator.clipboard.writeText(selectedText).then(() => {
                            addChatMessage('MITO', 'Text copied to clipboard');
                        });
                    }
                }
                
                // Ctrl+V to paste
                if ((e.ctrlKey || e.metaKey) && e.key === 'v') {
                    e.preventDefault();
                    navigator.clipboard.readText().then(text => {
                        const start = this.selectionStart;
                        const end = this.selectionEnd;
                        this.value = this.value.substring(0, start) + text + this.value.substring(end);
                        this.selectionStart = this.selectionEnd = start + text.length;
                        addChatMessage('MITO', 'Text pasted from clipboard');
                    });
                    return false;
                }
                
                // Ctrl+X to cut
                if ((e.ctrlKey || e.metaKey) && e.key === 'x') {
                    const selectedText = this.value.substring(this.selectionStart, this.selectionEnd);
                    if (selectedText) {
                        navigator.clipboard.writeText(selectedText).then(() => {
                            const start = this.selectionStart;
                            const end = this.selectionEnd;
                            this.value = this.value.substring(0, start) + this.value.substring(end);
                            this.selectionStart = this.selectionEnd = start;
                            addChatMessage('MITO', 'Text cut to clipboard');
                        });
                    }
                }
                
                // Ctrl+A to select all
                if ((e.ctrlKey || e.metaKey) && e.key === 'a') {
                    e.preventDefault();
                    this.select();
                    return false;
                }
                
                // Tab for indentation
                if (e.key === 'Tab') {
                    e.preventDefault();
                    const start = this.selectionStart;
                    const end = this.selectionEnd;
                    
                    this.value = this.value.substring(0, start) + '    ' + this.value.substring(end);
                    this.selectionStart = this.selectionEnd = start + 4;
                    return false;
                }
                
                // Auto-close brackets and quotes
                const pairs = {
                    '(': ')',
                    '[': ']',
                    '{': '}',
                    '"': '"',
                    "'": "'"
                };
                
                if (pairs[e.key]) {
                    const start = this.selectionStart;
                    const end = this.selectionEnd;
                    
                    this.value = this.value.substring(0, start) + e.key + pairs[e.key] + this.value.substring(end);
                    this.selectionStart = this.selectionEnd = start + 1;
                    e.preventDefault();
                    return false;
                }
            });
        }
        
        function loadProjectFiles() {
            fetch('/api/get-project-files')
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        const fileTree = document.getElementById('file-tree');
                        fileTree.innerHTML = '';
                        
                        data.files.forEach(file => {
                            const fileDiv = document.createElement('div');
                            fileDiv.className = 'file-item';
                            fileDiv.style.cssText = 'padding: 8px; cursor: pointer; border-radius: 4px;';
                            fileDiv.onclick = () => selectFile(file);
                            
                            let icon = '📄';
                            if (file.endsWith('.py')) icon = '<i class="fab fa-python"></i>';
                            else if (file.endsWith('.html')) icon = '<i class="fab fa-html5"></i>';
                            else if (file.endsWith('.js')) icon = '<i class="fab fa-js"></i>';
                            else if (file.endsWith('.css')) icon = '<i class="fab fa-css3"></i>';
                            else if (file.endsWith('.md')) icon = '<i class="fas fa-file-alt"></i>';
                            else if (file.endsWith('.json')) icon = '<i class="fas fa-file-code"></i>';
                            
                            fileDiv.innerHTML = `${icon} ${file}`;
                            fileTree.appendChild(fileDiv);
                        });
                        
                        addChatMessage('MITO', `Loaded ${data.files.length} project files`);
                    }
                });
        }
        
        function toggleCodeView() {
            document.getElementById('inline-code-editor').style.display = 'block';
            document.getElementById('mermaid-preview').style.display = 'none';
        }
        
        function toggleMermaidView() {
            document.getElementById('inline-code-editor').style.display = 'none';
            document.getElementById('mermaid-preview').style.display = 'block';
            renderMermaid();
        }
        
        function togglePreview() {
            const content = document.getElementById('inline-code-editor').textContent;
            const filename = document.getElementById('current-file-name').textContent;
            
            if (filename.endsWith('.md')) {
                // Render Markdown
                document.getElementById('mermaid-content').innerHTML = `<pre>${content}</pre>`;
                toggleMermaidView();
            } else if (filename.endsWith('.html')) {
                // Render HTML
                document.getElementById('mermaid-content').innerHTML = content;
                toggleMermaidView();
            } else {
                toggleCodeView();
            }
        }
        
        function createMermaidDiagram(type) {
            let template = '';
            
            switch(type) {
                case 'flowchart':
                    template = `graph TD
    A[Start] --> B{Decision}
    B -->|Yes| C[Action 1]
    B -->|No| D[Action 2]
    C --> E[End]
    D --> E`;
                    break;
                case 'sequence':
                    template = `sequenceDiagram
    participant User
    participant MITO
    participant Database
    
    User->>MITO: Request
    MITO->>Database: Query
    Database-->>MITO: Result
    MITO-->>User: Response`;
                    break;
                case 'architecture':
                    template = `graph TB
    subgraph "Frontend"
        UI[User Interface]
        WB[Workbench]
    end
    
    subgraph "Backend"
        API[API Layer]
        MITO[MITO Agent]
        DB[(Database)]
    end
    
    UI --> API
    WB --> API
    API --> MITO
    MITO --> DB`;
                    break;
            }
            
            document.getElementById('inline-code-editor').textContent = template;
            document.getElementById('current-file-name').textContent = `${type}_diagram.mmd`;
            toggleMermaidView();
        }
        
        function viewMermaidFlow() {
            fetch('/MITO_Engine_Architecture_Flow.md')
                .then(response => response.text())
                .then(content => {
                    document.getElementById('inline-code-editor').textContent = content;
                    document.getElementById('current-file-name').textContent = 'MITO_Engine_Architecture_Flow.md';
                    addChatMessage('MITO', 'Loaded MITO Engine architecture flow diagram');
                })
                .catch(error => {
                    addChatMessage('MITO', 'Could not load architecture flow diagram');
                });
        }
        
        function renderMermaid() {
            const content = document.getElementById('inline-code-editor').value;
            const mermaidContent = document.getElementById('mermaid-content');
            
            // Extract mermaid code from markdown if present
            let mermaidCode = content;
            const mermaidMatch = content.match(/```mermaid\n([\s\S]*?)\n```/);
            if (mermaidMatch) {
                mermaidCode = mermaidMatch[1];
            }
            
            try {
                // Clear previous content
                mermaidContent.innerHTML = '';
                
                // Create unique div for mermaid
                const mermaidDiv = document.createElement('div');
                mermaidDiv.className = 'mermaid';
                mermaidDiv.textContent = mermaidCode;
                mermaidContent.appendChild(mermaidDiv);
                
                // Initialize mermaid if available
                if (typeof mermaid !== 'undefined') {
                    mermaid.initialize({ startOnLoad: false, theme: 'dark' });
                    mermaid.run({ nodes: [mermaidDiv] });
                }
            } catch (error) {
                mermaidContent.innerHTML = `<div style="color: red; padding: 20px;">Error rendering diagram: ${error.message}</div>`;
            }
        }
        
        function savAllFiles() {
            saveFile();
            addChatMessage('MITO', 'All files saved successfully');
        }
        
        // Context Menu Functions
        let contextMenu = null;
        let currentEditor = null;
        
        function showContextMenu(event) {
            event.preventDefault();
            currentEditor = event.target;
            
            // Remove existing context menu
            if (contextMenu) {
                contextMenu.remove();
            }
            
            // Create context menu
            contextMenu = document.createElement('div');
            contextMenu.className = 'context-menu';
            contextMenu.style.left = event.pageX + 'px';
            contextMenu.style.top = event.pageY + 'px';
            contextMenu.style.display = 'block';
            
            const hasSelection = currentEditor.selectionStart !== currentEditor.selectionEnd;
            
            contextMenu.innerHTML = `
                <button class="context-menu-item" onclick="contextCopy()" ${hasSelection ? '' : 'disabled'}>
                    <i class="fas fa-copy"></i> Copy
                </button>
                <button class="context-menu-item" onclick="contextCut()" ${hasSelection ? '' : 'disabled'}>
                    <i class="fas fa-cut"></i> Cut
                </button>
                <button class="context-menu-item" onclick="contextPaste()">
                    <i class="fas fa-paste"></i> Paste
                </button>
                <hr style="margin: 5px 0; border-color: var(--accent-bg);">
                <button class="context-menu-item" onclick="contextSelectAll()">
                    <i class="fas fa-expand-arrows-alt"></i> Select All
                </button>
                <button class="context-menu-item" onclick="contextSave()">
                    <i class="fas fa-save"></i> Save File
                </button>
            `;
            
            document.body.appendChild(contextMenu);
            
            // Close context menu when clicking elsewhere
            setTimeout(() => {
                document.addEventListener('click', closeContextMenu, { once: true });
            }, 10);
        }
        
        function closeContextMenu() {
            if (contextMenu) {
                contextMenu.remove();
                contextMenu = null;
            }
        }
        
        function contextCopy() {
            if (currentEditor) {
                const selectedText = currentEditor.value.substring(currentEditor.selectionStart, currentEditor.selectionEnd);
                navigator.clipboard.writeText(selectedText).then(() => {
                    addChatMessage('MITO', 'Text copied to clipboard');
                });
            }
            closeContextMenu();
        }
        
        function contextCut() {
            if (currentEditor) {
                const selectedText = currentEditor.value.substring(currentEditor.selectionStart, currentEditor.selectionEnd);
                navigator.clipboard.writeText(selectedText).then(() => {
                    const start = currentEditor.selectionStart;
                    const end = currentEditor.selectionEnd;
                    currentEditor.value = currentEditor.value.substring(0, start) + currentEditor.value.substring(end);
                    currentEditor.selectionStart = currentEditor.selectionEnd = start;
                    addChatMessage('MITO', 'Text cut to clipboard');
                });
            }
            closeContextMenu();
        }
        
        function contextPaste() {
            if (currentEditor) {
                navigator.clipboard.readText().then(text => {
                    const start = currentEditor.selectionStart;
                    const end = currentEditor.selectionEnd;
                    currentEditor.value = currentEditor.value.substring(0, start) + text + currentEditor.value.substring(end);
                    currentEditor.selectionStart = currentEditor.selectionEnd = start + text.length;
                    addChatMessage('MITO', 'Text pasted from clipboard');
                });
            }
            closeContextMenu();
        }
        
        function contextSelectAll() {
            if (currentEditor) {
                currentEditor.select();
            }
            closeContextMenu();
        }
        
        function contextSave() {
            saveFile();
            closeContextMenu();
        }

        function loadFileManager() {
            const workspace = document.getElementById('main-canvas');
            workspace.innerHTML = `
                <div class="tool-interface">
                    <h3>File Manager & Converter</h3>
                    <div class="row">
                        <div class="col-md-4">
                            <div class="card">
                                <div class="card-header">File Operations</div>
                                <div class="card-body">
                                    <input type="file" id="file-upload" class="form-control mb-3" multiple>
                                    <div class="btn-group-vertical w-100">
                                        <button class="btn btn-primary mb-2" onclick="uploadFiles()">Upload Files</button>
                                        <button class="btn btn-secondary mb-2" onclick="createNewFile()">New File</button>
                                        <button class="btn btn-info mb-2" onclick="showConverter()">Convert Files</button>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="card mt-3">
                                <div class="card-header">Project Files</div>
                                <div class="card-body">
                                    <div id="file-tree" style="font-family: monospace; cursor: pointer;">
                                        <div onclick="selectFile('app.py')" style="padding: 4px; hover:background-color: var(--accent-bg);">📄 app.py</div>
                                        <div onclick="selectFile('config.py')" style="padding: 4px;">📄 config.py</div>
                                        <div onclick="selectFile('main.py')" style="padding: 4px;">📄 main.py</div>
                                        <div onclick="selectFile('models.py')" style="padding: 4px;">📄 models.py</div>
                                        <div onclick="selectFile('requirements.txt')" style="padding: 4px;">📄 requirements.txt</div>
                                        <div onclick="selectFile('.env')" style="padding: 4px;">🔧 .env</div>
                                        <div onclick="selectFile('README.md')" style="padding: 4px;">📄 README.md</div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- File Converter Panel -->
                            <div class="card mt-3" id="converter-panel" style="display: none;">
                                <div class="card-header">File Converter</div>
                                <div class="card-body">
                                    <div class="form-group mb-3">
                                        <label>Select File to Convert</label>
                                        <input type="file" class="form-control" id="convert-file-input" accept=".pdf,.docx,.csv,.json,.xml,.txt,.md,.py,.js,.html,.css">
                                    </div>
                                    <div class="form-group mb-3">
                                        <label>Convert To</label>
                                        <select class="form-control" id="convert-format">
                                            <option value="txt">Text (.txt)</option>
                                            <option value="json">JSON (.json)</option>
                                            <option value="csv">CSV (.csv)</option>
                                            <option value="md">Markdown (.md)</option>
                                            <option value="xml">XML (.xml)</option>
                                            <option value="html">HTML (.html)</option>
                                        </select>
                                    </div>
                                    <div class="btn-group w-100">
                                        <button class="btn btn-success" onclick="convertFile()">Convert</button>
                                        <button class="btn btn-secondary" onclick="hideConverter()">Cancel</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="col-md-8">
                            <div class="card">
                                <div class="card-header d-flex justify-content-between align-items-center">
                                    <span id="file-title">File Viewer/Editor</span>
                                    <div>
                                        <button class="btn btn-sm btn-outline-primary" onclick="saveFile()" id="save-btn" style="display: none;">Save</button>
                                        <button class="btn btn-sm btn-outline-secondary" onclick="downloadFile()" id="download-btn" style="display: none;">Download</button>
                                        <button class="btn btn-sm btn-outline-warning" onclick="editFile()" id="edit-btn" style="display: none;">Edit</button>
                                    </div>
                                </div>
                                <div class="card-body">
                                    <div id="file-viewer" contenteditable="false" style="background: #1a1a1a; color: #f1f5f9; padding: 15px; border-radius: 8px; min-height: 400px; font-family: monospace; white-space: pre-wrap; overflow-y: auto;">
                                        Select a file to view its content...
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Conversion Result Panel -->
                            <div class="card mt-3" id="conversion-result-panel" style="display: none;">
                                <div class="card-header">Conversion Result</div>
                                <div class="card-body">
                                    <div id="conversion-result" style="background: #1a1a1a; color: #f1f5f9; padding: 15px; border-radius: 8px; min-height: 200px; font-family: monospace; white-space: pre-wrap;">
                                        Converted content will appear here...
                                    </div>
                                    <button class="btn btn-primary mt-3" onclick="downloadConverted()">Download Result</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        function loadFileConverter() {
            const workspace = document.getElementById('main-canvas');
            workspace.innerHTML = `
                <div class="tool-interface">
                    <h3> File Converter</h3>
                    <div class="row">
                        <div class="col-md-6">
                            <div class="card">
                                <div class="card-header">Convert Files</div>
                                <div class="card-body">
                                    <div class="form-group">
                                        <label>Select File</label>
                                        <input type="file" class="form-control" accept=".pdf,.docx,.csv,.json,.xml,.yaml">
                                    </div>
                                    <div class="form-group">
                                        <label>Convert To</label>
                                        <select class="form-control">
                                            <option value="json">JSON</option>
                                            <option value="csv">CSV</option>
                                            <option value="yaml">YAML</option>
                                            <option value="xml">XML</option>
                                            <option value="txt">Text</option>
                                            <option value="md">Markdown</option>
                                        </select>
                                    </div>
                                    <button class="btn btn-success" onclick="convertFile()">Convert File</button>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="card">
                                <div class="card-header">Conversion Result</div>
                                <div class="card-body">
                                    <div id="conversion-result" style="background: #1a1a1a; color: #f1f5f9; padding: 15px; border-radius: 8px; min-height: 300px; font-family: monospace;">
                                        Converted content will appear here...
                                    </div>
                                    <button class="btn btn-primary mt-3" onclick="downloadConverted()">Download Result</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        function loadDatabaseManager() {
            const workspace = document.getElementById('main-canvas');
            workspace.innerHTML = `
                <div class="tool-interface">
                    <h3> Database Manager</h3>
                    <div class="row">
                        <div class="col-md-4">
                            <div class="card">
                                <div class="card-header">Database Schema</div>
                                <div class="card-body">
                                    <div class="table-list">
                                        <div class="table-item" onclick="selectTable('users')" style="padding: 8px; border: 1px solid #444; margin-bottom: 5px; cursor: pointer;">
                                             users
                                        </div>
                                        <div class="table-item" onclick="selectTable('projects')" style="padding: 8px; border: 1px solid #444; margin-bottom: 5px; cursor: pointer;">
                                             projects
                                        </div>
                                        <div class="table-item" onclick="selectTable('deployments')" style="padding: 8px; border: 1px solid #444; margin-bottom: 5px; cursor: pointer;">
                                             deployments
                                        </div>
                                    </div>
                                    <button class="btn btn-primary mt-3" onclick="createTable()">Create Table</button>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-8">
                            <div class="card">
                                <div class="card-header">SQL Query Interface</div>
                                <div class="card-body">
                                    <textarea id="sql-query" class="form-control mb-3" rows="4" placeholder="SELECT * FROM users;"></textarea>
                                    <button class="btn btn-success me-2" onclick="executeQuery()">Execute Query</button>
                                    <button class="btn btn-secondary" onclick="clearQuery()">Clear</button>
                                    <div id="query-results" class="mt-3" style="background: #1a1a1a; color: #f1f5f9; padding: 15px; border-radius: 8px; min-height: 200px; font-family: monospace;">
                                        Query results will appear here...
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        function loadDeploymentManager() {
            const workspace = document.getElementById('main-canvas');
            workspace.innerHTML = `
                <div class="tool-interface">
                    <h3> Deployment Manager</h3>
                    <div class="row">
                        <div class="col-md-6">
                            <div class="card">
                                <div class="card-header">Deployment Configuration</div>
                                <div class="card-body">
                                    <div class="form-group">
                                        <label>Platform</label>
                                        <select class="form-control">
                                            <option value="replit">Replit</option>
                                            <option value="heroku">Heroku</option>
                                            <option value="vercel">Vercel</option>
                                            <option value="aws">AWS</option>
                                            <option value="docker">Docker</option>
                                        </select>
                                    </div>
                                    <div class="form-group">
                                        <label>Environment</label>
                                        <select class="form-control">
                                            <option value="development">Development</option>
                                            <option value="staging">Staging</option>
                                            <option value="production">Production</option>
                                        </select>
                                    </div>
                                    <div class="form-group">
                                        <label>Environment Variables</label>
                                        <textarea class="form-control" rows="4" placeholder="API_KEY=your_key_here
DATABASE_URL=postgresql://..."></textarea>
                                    </div>
                                    <button class="btn btn-success" onclick="deployToCloud()">Deploy</button>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="card">
                                <div class="card-header">Deployment Status</div>
                                <div class="card-body">
                                    <div class="deployment-status">
                                        <div class="status-item" style="margin-bottom: 8px;">
                                            <span class="status-dot status-success" style="width: 12px; height: 12px; border-radius: 50%; background: #28a745; display: inline-block; margin-right: 8px;"></span>
                                            <span>Build: Completed</span>
                                        </div>
                                        <div class="status-item" style="margin-bottom: 8px;">
                                            <span class="status-dot status-success" style="width: 12px; height: 12px; border-radius: 50%; background: #28a745; display: inline-block; margin-right: 8px;"></span>
                                            <span>Tests: Passed</span>
                                        </div>
                                        <div class="status-item" style="margin-bottom: 8px;">
                                            <span class="status-dot status-warning" style="width: 12px; height: 12px; border-radius: 50%; background: #ffc107; display: inline-block; margin-right: 8px;"></span>
                                            <span>Deploy: In Progress</span>
                                        </div>
                                    </div>
                                    <div id="deployment-logs" class="mt-3" style="background: #1a1a1a; color: #f1f5f9; padding: 15px; border-radius: 8px; height: 200px; overflow-y: auto;">
                                        Deployment logs will appear here...
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        function loadPluginManager() {
            const workspace = document.getElementById('main-canvas');
            workspace.innerHTML = `
                <div class="tool-interface">
                    <h3> Plugin Manager</h3>
                    <div class="row">
                        <div class="col-md-6">
                            <div class="card">
                                <div class="card-header">Available Plugins</div>
                                <div class="card-body">
                                    <div class="plugin-list">
                                        <div class="plugin-item" style="padding: 10px; border: 1px solid #444; margin-bottom: 10px; border-radius: 5px;">
                                            <div class="d-flex justify-content-between align-items-center">
                                                <div>
                                                    <h6>GitHub Integration</h6>
                                                    <small>Connect to GitHub repositories</small>
                                                </div>
                                                <button class="btn btn-sm btn-primary" onclick="installPlugin('github')">Install</button>
                                            </div>
                                        </div>
                                        <div class="plugin-item" style="padding: 10px; border: 1px solid #444; margin-bottom: 10px; border-radius: 5px;">
                                            <div class="d-flex justify-content-between align-items-center">
                                                <div>
                                                    <h6>Slack Notifications</h6>
                                                    <small>Send notifications to Slack</small>
                                                </div>
                                                <button class="btn btn-sm btn-primary" onclick="installPlugin('slack')">Install</button>
                                            </div>
                                        </div>
                                        <div class="plugin-item" style="padding: 10px; border: 1px solid #444; margin-bottom: 10px; border-radius: 5px;">
                                            <div class="d-flex justify-content-between align-items-center">
                                                <div>
                                                    <h6>Image Processing</h6>
                                                    <small>Advanced image manipulation</small>
                                                </div>
                                                <button class="btn btn-sm btn-success" disabled>Installed</button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="card">
                                <div class="card-header">Plugin Configuration</div>
                                <div class="card-body">
                                    <div id="plugin-config" style="background: #1a1a1a; color: #f1f5f9; padding: 15px; border-radius: 8px; min-height: 300px;">
                                        Select a plugin to configure...
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        function loadAPIIntegrations() {
            const workspace = document.getElementById('main-canvas');
            workspace.innerHTML = `
                <div class="tool-interface">
                    <h3> API Integrations</h3>
                    <div class="row">
                        <div class="col-md-6">
                            <div class="card">
                                <div class="card-header">Available APIs</div>
                                <div class="card-body">
                                    <div class="api-list">
                                        <div class="api-item" style="padding: 10px; border: 1px solid #444; margin-bottom: 10px; border-radius: 5px;">
                                            <div class="d-flex justify-content-between align-items-center">
                                                <div>
                                                    <h6> OpenAI GPT</h6>
                                                    <small class="text-success">Connected</small>
                                                </div>
                                                <button class="btn btn-sm btn-secondary" onclick="configureAPI('openai')">Configure</button>
                                            </div>
                                        </div>
                                        <div class="api-item" style="padding: 10px; border: 1px solid #444; margin-bottom: 10px; border-radius: 5px;">
                                            <div class="d-flex justify-content-between align-items-center">
                                                <div>
                                                    <h6> Claude</h6>
                                                    <small class="text-warning">Not Connected</small>
                                                </div>
                                                <button class="btn btn-sm btn-primary" onclick="connectAPI('claude')">Connect</button>
                                            </div>
                                        </div>
                                        <div class="api-item" style="padding: 10px; border: 1px solid #444; margin-bottom: 10px; border-radius: 5px;">
                                            <div class="d-flex justify-content-between align-items-center">
                                                <div>
                                                    <h6> Supabase</h6>
                                                    <small class="text-warning">Not Connected</small>
                                                </div>
                                                <button class="btn btn-sm btn-primary" onclick="connectAPI('supabase')">Connect</button>
                                            </div>
                                        </div>
                                        <div class="api-item" style="padding: 10px; border: 1px solid #444; margin-bottom: 10px; border-radius: 5px;">
                                            <div class="d-flex justify-content-between align-items-center">
                                                <div>
                                                    <h6> Stripe</h6>
                                                    <small class="text-warning">Not Connected</small>
                                                </div>
                                                <button class="btn btn-sm btn-primary" onclick="connectAPI('stripe')">Connect</button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="card">
                                <div class="card-header">API Configuration</div>
                                <div class="card-body">
                                    <div id="api-config" style="background: #1a1a1a; color: #f1f5f9; padding: 15px; border-radius: 8px; min-height: 300px;">
                                        Select an API to configure...
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        function toggleFullscreen() {
            if (document.fullscreenElement) {
                document.exitFullscreen();
            } else {
                document.documentElement.requestFullscreen();
            }
        }

        function saveWorkspace() {
            alert('Workspace saved!');
        }

        function toggleTheme() {
            alert('Theme switching feature coming soon!');
        }

        // Chat input event listener and keyboard shortcuts
        document.addEventListener('DOMContentLoaded', function() {
            const chatInput = document.getElementById('chat-input');
            if (chatInput) {
                chatInput.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        sendChatMessage();
                    }
                });
            }
            
            // Global keyboard shortcuts
            document.addEventListener('keydown', function(e) {
                // Ctrl+S for Save
                if (e.ctrlKey && e.key === 's') {
                    e.preventDefault();
                    saveProject();
                }
                // Ctrl+Shift+S for Save As
                if (e.ctrlKey && e.shiftKey && e.key === 'S') {
                    e.preventDefault();
                    saveAsProject();
                }
                // Ctrl+O for Import
                if (e.ctrlKey && e.key === 'o') {
                    e.preventDefault();
                    importProject();
                }
                // Ctrl+E for Export
                if (e.ctrlKey && e.key === 'e') {
                    e.preventDefault();
                    exportProject();
                }
                // Ctrl+P for Print
                if (e.ctrlKey && e.key === 'p') {
                    e.preventDefault();
                    printProject();
                }
                // Ctrl+Shift+H for Share
                if (e.ctrlKey && e.shiftKey && e.key === 'H') {
                    e.preventDefault();
                    shareProject();
                }
                // F11 for Fullscreen
                if (e.key === 'F11') {
                    e.preventDefault();
                    toggleFullscreen();
                }
            });
        });

        // Backend-Connected Functions
        function generateCompleteCode() {
            const prompt = document.getElementById('code-prompt').value;
            const language = document.getElementById('code-language').value;
            const framework = document.getElementById('code-framework').value;
            
            if (!prompt.trim()) {
                addChatMessage('MITO', 'Please provide a project description first.');
                return;
            }
            
            const fullPrompt = `Generate a complete ${language} application using ${framework} framework. Requirements: ${prompt}. Include proper structure, error handling, and documentation.`;
            
            fetch('/api/generate-code', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    prompt: fullPrompt,
                    language: language,
                    framework: framework
                })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    updateCodeEditor(data.code);
                    addChatMessage('MITO', 'Code generated successfully! Complete implementation ready.');
                } else {
                    addChatMessage('MITO', 'Code generation failed: ' + data.error);
                }
            });
        }

        function startTraining() {
            simulateTrainingProgress();
            addChatMessage('MITO', 'Model training started successfully!');
        }

        function simulateTrainingProgress() {
            const progressBar = document.getElementById('training-progress');
            const logs = document.getElementById('training-logs');
            let progress = 0;
            
            const interval = setInterval(() => {
                progress += Math.random() * 10;
                if (progress > 100) progress = 100;
                
                progressBar.style.width = progress + '%';
                progressBar.textContent = Math.round(progress) + '%';
                
                logs.innerHTML += `Epoch ${Math.floor(progress/10)}: Loss: ${(1 - progress/100).toFixed(4)}\n`;
                logs.scrollTop = logs.scrollHeight;
                
                if (progress >= 100) {
                    clearInterval(interval);
                    addChatMessage('MITO', 'Model training completed successfully!');
                }
            }, 1000);
        }

        function analyzeSentiment() {
            const text = document.getElementById('nlu-text').value;
            if (!text.trim()) return;
            
            fetch('/api/nlu-analyze', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    text: text,
                    analysis_type: 'sentiment'
                })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    document.getElementById('nlu-results').innerHTML = `
                        <h5>Sentiment Analysis Results:</h5>
                        <p>Sentiment: ${data.sentiment}</p>
                        <p>Confidence: ${data.confidence}</p>
                        <p>Score: ${data.score}</p>
                    `;
                } else {
                    document.getElementById('nlu-results').innerHTML = '<p class="text-danger">Analysis failed</p>';
                }
            });
        }

        function extractEntities() {
            const text = document.getElementById('nlu-text').value;
            if (!text.trim()) return;
            
            fetch('/api/nlu-analyze', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    text: text,
                    analysis_type: 'entities'
                })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success && data.entities) {
                    let html = '<h5>Entity Extraction Results:</h5>';
                    data.entities.forEach(entity => {
                        html += `<p><strong>${entity.text}</strong> (${entity.label}) - ${entity.confidence}</p>`;
                    });
                    document.getElementById('nlu-results').innerHTML = html;
                }
            });
        }

        function classifyText() {
            const text = document.getElementById('nlu-text').value;
            if (!text.trim()) return;
            
            fetch('/api/nlu-analyze', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    text: text,
                    analysis_type: 'classification'
                })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success && data.categories) {
                    let html = '<h5>Text Classification Results:</h5>';
                    data.categories.forEach(cat => {
                        html += `<p>${cat.label}: ${(cat.confidence * 100).toFixed(1)}%</p>`;
                    });
                    document.getElementById('nlu-results').innerHTML = html;
                }
            });
        }

        function selectTemplate(templateType) {
            document.getElementById('template-config').style.display = 'block';
            addChatMessage('MITO', `Selected ${templateType} template. Configure the details below.`);
        }

        function createFromTemplate() {
            const name = document.getElementById('template-name').value;
            const description = document.getElementById('template-description').value;
            
            if (!name.trim()) {
                addChatMessage('MITO', 'Please provide a project name.');
                return;
            }
            
            fetch('/api/create-project-template', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    name: name,
                    description: description,
                    template_type: 'web-app',
                    tier: 'enterprise',
                    components: ['frontend', 'backend', 'database']
                })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    addChatMessage('MITO', `Project "${name}" created successfully from template!`);
                    document.getElementById('template-config').style.display = 'none';
                } else {
                    addChatMessage('MITO', 'Project creation failed: ' + data.error);
                }
            });
        }

        function buildAgent() {
            const agentData = {
                name: document.querySelector('input[placeholder="My AI Agent"]').value,
                type: document.querySelector('select').value,
                personality: document.querySelector('textarea').value,
                skills: Array.from(document.querySelectorAll('input[type="checkbox"]:checked')).map(cb => cb.value)
            };
            
            fetch('/api/ai-factory-generate', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    type: 'agent',
                    config: agentData
                })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    document.getElementById('agent-preview').innerHTML = `
                        <h5>Agent: ${agentData.name}</h5>
                        <p>Type: ${agentData.type}</p>
                        <p>Skills: ${agentData.skills.join(', ')}</p>
                        <pre>${escapeHtml(data.code)}</pre>
                    `;
                    addChatMessage('MITO', 'AI Agent built successfully!');
                }
            });
        }

        function executeQuery() {
            const query = document.getElementById('sql-query').value;
            if (!query.trim()) return;
            
            fetch('/api/execute-sql', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ sql_query: query })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    let html = '<h5>Query Results:</h5>';
                    if (data.results && data.results.length > 0) {
                        html += '<table class="table table-dark table-striped">';
                        html += '<thead><tr>';
                        Object.keys(data.results[0]).forEach(key => {
                            html += `<th>${key}</th>`;
                        });
                        html += '</tr></thead><tbody>';
                        data.results.forEach(row => {
                            html += '<tr>';
                            Object.values(row).forEach(value => {
                                html += `<td>${value}</td>`;
                            });
                            html += '</tr>';
                        });
                        html += '</tbody></table>';
                    } else {
                        html += '<p>Query executed successfully. No results returned.</p>';
                    }
                    document.getElementById('query-results').innerHTML = html;
                } else {
                    document.getElementById('query-results').innerHTML = `<p class="text-danger">Error: ${data.error}</p>`;
                }
            });
        }

        function clearQuery() {
            document.getElementById('sql-query').value = '';
            document.getElementById('query-results').innerHTML = 'Query results will appear here...';
        }

        function deployToCloud() {
            addChatMessage('MITO', 'Starting cloud deployment process...');
            
            fetch('/api/deploy-project', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    platform: document.querySelector('select').value,
                    environment: document.querySelectorAll('select')[1].value
                })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    addChatMessage('MITO', 'Deployment initiated successfully!');
                    simulateDeployment();
                } else {
                    addChatMessage('MITO', 'Deployment failed: ' + data.error);
                }
            });
        }

        function simulateDeployment() {
            const logs = document.getElementById('deployment-logs');
            const steps = [
                'Building application...',
                'Running tests...',
                'Creating container...',
                'Pushing to registry...',
                'Deploying to cloud...',
                'Deployment complete!'
            ];
            
            steps.forEach((step, index) => {
                setTimeout(() => {
                    logs.innerHTML += step + '\n';
                    logs.scrollTop = logs.scrollHeight;
                }, (index + 1) * 1000);
            });
        }

        function uploadFiles() {
            const fileInput = document.getElementById('file-upload');
            if (fileInput.files.length === 0) {
                addChatMessage('MITO', 'Please select files to upload.');
                return;
            }
            
            const formData = new FormData();
            for (let file of fileInput.files) {
                formData.append('files', file);
            }
            
            fetch('/api/upload-files', {
                method: 'POST',
                body: formData
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    addChatMessage('MITO', `Successfully uploaded ${fileInput.files.length} files.`);
                    updateFileTree();
                } else {
                    addChatMessage('MITO', 'File upload failed: ' + data.error);
                }
            });
        }

        function updateFileTree() {
            // Update file tree display after upload
            const fileTree = document.getElementById('file-tree');
            fileTree.innerHTML = `
                📁 project/<br>
                ├── 📄 app.py<br>
                ├── 📄 config.py<br>
                ├── 📄 uploaded_file.txt<br>
                ├── 📁 templates/<br>
                └── 📁 static/
            `;
        }

        // File Manager & Converter Functions
        function showConverter() {
            document.getElementById('converter-panel').style.display = 'block';
            addChatMessage('MITO', 'File converter panel opened. Select a file to convert.');
        }

        function hideConverter() {
            document.getElementById('converter-panel').style.display = 'none';
            document.getElementById('conversion-result-panel').style.display = 'none';
        }

        function selectFile(fileName) {
            const viewer = document.getElementById('file-viewer');
            const title = document.getElementById('file-title');
            const saveBtn = document.getElementById('save-btn');
            const downloadBtn = document.getElementById('download-btn');
            const editBtn = document.getElementById('edit-btn');
            
            title.textContent = fileName;
            saveBtn.style.display = 'inline-block';
            downloadBtn.style.display = 'inline-block';
            editBtn.style.display = 'inline-block';
            
            // Update status bar
            updateStatusBar({
                file: fileName,
                status: 'File Opened',
                statusColor: 'var(--success-color)'
            });
            
            // Simulate file content based on file type
            let content = '';
            if (fileName.endsWith('.py')) {
                content = `# ${fileName}
from flask import Flask, render_template
from config import Config

app = Flask(__name__)
app.config.from_object(Config)

@app.route('/')
def index():
    return render_template('index.html')

if __name__ == '__main__':
    app.run(debug=True)`;
            } else if (fileName.endsWith('.md')) {
                content = `# ${fileName.replace('.md', '')}

## Description
This is a sample markdown file for the MITO Engine project.

## Features
- AI-powered development
- File management and conversion
- Real-time collaboration

## Installation
\`\`\`bash
pip install -r requirements.txt
\`\`\``;
            } else if (fileName.endsWith('.txt')) {
                content = `Configuration file for ${fileName}
Debug mode: True
Database URL: sqlite:///app.db
Secret key: your-secret-key-here`;
            } else if (fileName === '.env') {
                content = `# Environment Variables
DATABASE_URL=postgresql://localhost/mito_db
SECRET_KEY=your-secret-key
DEBUG=True
FLASK_ENV=development`;
            } else {
                content = `# Sample content for ${fileName}
print("Hello from MITO Engine!")
# This is sample file content`;
            }
            
            viewer.textContent = content;
            addChatMessage('MITO', `Loaded ${fileName} for viewing and editing.`);
        }

        function editFile() {
            const viewer = document.getElementById('file-viewer');
            viewer.contentEditable = 'true';
            viewer.style.border = '2px solid var(--accent-color)';
            addChatMessage('MITO', 'File is now editable. Make your changes and click Save.');
        }

        function saveFile() {
            const viewer = document.getElementById('file-viewer');
            const fileName = document.getElementById('file-title').textContent;
            viewer.contentEditable = 'false';
            viewer.style.border = 'none';
            addChatMessage('MITO', `Changes to ${fileName} saved successfully.`);
        }

        function downloadFile() {
            const fileName = document.getElementById('file-title').textContent;
            const content = document.getElementById('file-viewer').textContent;
            const blob = new Blob([content], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = fileName;
            a.click();
            URL.revokeObjectURL(url);
            addChatMessage('MITO', `${fileName} downloaded successfully.`);
        }

        function createNewFile() {
            const fileName = prompt('Enter file name (with extension):');
            if (fileName) {
                const viewer = document.getElementById('file-viewer');
                const title = document.getElementById('file-title');
                title.textContent = fileName;
                viewer.textContent = `# New file: ${fileName}\n# Start editing...`;
                viewer.contentEditable = 'true';
                viewer.style.border = '2px solid var(--accent-color)';
                
                // Add to file tree
                const fileTree = document.getElementById('file-tree');
                const newFileDiv = document.createElement('div');
                newFileDiv.onclick = () => selectFile(fileName);
                newFileDiv.style.padding = '4px';
                newFileDiv.innerHTML = `📄 ${fileName}`;
                fileTree.appendChild(newFileDiv);
                
                addChatMessage('MITO', `New file ${fileName} created and ready for editing.`);
            }
        }

        function convertFile() {
            const fileInput = document.getElementById('convert-file-input');
            const format = document.getElementById('convert-format').value;
            
            if (!fileInput.files[0]) {
                addChatMessage('MITO', 'Please select a file to convert.');
                return;
            }
            
            const file = fileInput.files[0];
            const reader = new FileReader();
            
            reader.onload = function(e) {
                const content = e.target.result;
                let convertedContent = '';
                
                // Simple conversion simulation
                switch(format) {
                    case 'txt':
                        convertedContent = content.replace(/<[^>]*>/g, ''); // Strip HTML tags
                        break;
                    case 'json':
                        convertedContent = JSON.stringify({
                            filename: file.name,
                            content: content,
                            converted_at: new Date().toISOString()
                        }, null, 2);
                        break;
                    case 'csv':
                        const lines = content.split('\n');
                        convertedContent = lines.map(line => `"${line.replace(/"/g, '""')}"`).join('\n');
                        break;
                    case 'md':
                        convertedContent = `# ${file.name}\n\n\`\`\`\n${content}\n\`\`\``;
                        break;
                    case 'xml':
                        convertedContent = `<?xml version="1.0" encoding="UTF-8"?>
<document>
    <filename>${file.name}</filename>
    <content><![CDATA[${content}]]></content>
</document>`;
                        break;
                    case 'html':
                        convertedContent = `<!DOCTYPE html>
<html>
<head><title>${file.name}</title></head>
<body><pre>${content}</pre></body>
</html>`;
                        break;
                    default:
                        convertedContent = content;
                }
                
                document.getElementById('conversion-result').textContent = convertedContent;
                document.getElementById('conversion-result-panel').style.display = 'block';
                addChatMessage('MITO', `File converted to ${format.toUpperCase()} format successfully.`);
            };
            
            reader.readAsText(file);
        }

        function downloadConverted() {
            const content = document.getElementById('conversion-result').textContent;
            const format = document.getElementById('convert-format').value;
            const fileName = `converted_file.${format}`;
            
            const blob = new Blob([content], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = fileName;
            a.click();
            URL.revokeObjectURL(url);
            addChatMessage('MITO', `Converted file downloaded as ${fileName}.`);
        }

        function installPlugin(pluginName) {
            fetch('/api/install-plugin', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ plugin: pluginName })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    addChatMessage('MITO', `Plugin ${pluginName} installed successfully!`);
                } else {
                    addChatMessage('MITO', `Plugin installation failed: ${data.error}`);
                }
            });
        }

        function connectAPI(apiName) {
            fetch('/api/connect-integration', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ integration: apiName })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    addChatMessage('MITO', `${apiName} API connected successfully!`);
                } else {
                    addChatMessage('MITO', `API connection failed: ${data.error}`);
                }
            });
        }

        function configureAPI(apiName) {
            document.getElementById('api-config').innerHTML = `
                <h5>Configure ${apiName}</h5>
                <div class="form-group">
                    <label>API Key</label>
                    <input type="password" class="form-control" placeholder="Enter API key...">
                </div>
                <div class="form-group">
                    <label>Endpoint URL</label>
                    <input type="url" class="form-control" placeholder="https://api.example.com">
                </div>
                <button class="btn btn-primary" onclick="saveAPIConfig('${apiName}')">Save Configuration</button>
            `;
        }

        function saveAPIConfig(apiName) {
            addChatMessage('MITO', `Configuration saved for ${apiName}`);
        }

        // Plugin and API Management Functions (for Settings modal)
        function togglePlugin(pluginName) {
            const button = event.target;
            const isEnabled = button.textContent === 'Enabled';
            
            if (isEnabled) {
                button.textContent = 'Enable';
                button.style.background = 'var(--control-btn-bg)';
                addChatMessage('MITO', `${pluginName} plugin disabled.`);
            } else {
                button.textContent = 'Enabled';
                button.style.background = 'var(--success-color)';
                addChatMessage('MITO', `${pluginName} plugin enabled successfully.`);
            }
        }

        function configureAPI(apiName) {
            const button = event.target;
            const isConnected = button.textContent === 'Connected';
            
            if (isConnected) {
                if (confirm(`Disconnect ${apiName} API?`)) {
                    button.textContent = 'Connect';
                    button.style.background = 'var(--control-btn-bg)';
                    addChatMessage('MITO', `${apiName} API disconnected.`);
                }
            } else {
                // Simulate API connection
                button.textContent = 'Connecting...';
                setTimeout(() => {
                    button.textContent = 'Connected';
                    button.style.background = 'var(--success-color)';
                    addChatMessage('MITO', `${apiName} API connected successfully.`);
                }, 1500);
            }
        }

        // AI Factory Function
        function loadAIFactory() {
            const workspace = document.getElementById('main-canvas');
            workspace.innerHTML = `
                <div class="tool-interface">
                    <h3> AI Factory</h3>
                    <div class="row">
                        <div class="col-md-8">
                            <div class="card">
                                <div class="card-header">AI Application Builder</div>
                                <div class="card-body">
                                    <div class="row">
                                        <div class="col-md-6">
                                            <h5>Select Functions</h5>
                                            <div class="function-grid">
                                                <div class="form-check">
                                                    <input class="form-check-input" type="checkbox" value="chat" id="func-chat">
                                                    <label class="form-check-label" for="func-chat">AI Chat Interface</label>
                                                </div>
                                                <div class="form-check">
                                                    <input class="form-check-input" type="checkbox" value="search" id="func-search">
                                                    <label class="form-check-label" for="func-search">Semantic Search</label>
                                                </div>
                                                <div class="form-check">
                                                    <input class="form-check-input" type="checkbox" value="generate" id="func-generate">
                                                    <label class="form-check-label" for="func-generate">Content Generation</label>
                                                </div>
                                                <div class="form-check">
                                                    <input class="form-check-input" type="checkbox" value="analyze" id="func-analyze">
                                                    <label class="form-check-label" for="func-analyze">Data Analysis</label>
                                                </div>
                                                <div class="form-check">
                                                    <input class="form-check-input" type="checkbox" value="translate" id="func-translate">
                                                    <label class="form-check-label" for="func-translate">Language Translation</label>
                                                </div>
                                                <div class="form-check">
                                                    <input class="form-check-input" type="checkbox" value="summarize" id="func-summarize">
                                                    <label class="form-check-label" for="func-summarize">Text Summarization</label>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <h5>Configuration</h5>
                                            <div class="form-group">
                                                <label>Application Name</label>
                                                <input type="text" class="form-control" placeholder="My AI App" id="app-name">
                                            </div>
                                            <div class="form-group">
                                                <label>Folder Structure</label>
                                                <select class="form-control" id="folder-structure">
                                                    <option value="mvc">MVC Pattern</option>
                                                    <option value="microservices">Microservices</option>
                                                    <option value="monolith">Monolithic</option>
                                                    <option value="serverless">Serverless</option>
                                                </select>
                                            </div>
                                            <div class="form-group">
                                                <label>Deployment Type</label>
                                                <select class="form-control" id="deployment-type">
                                                    <option value="web">Web Application</option>
                                                    <option value="api">API Service</option>
                                                    <option value="cli">Command Line Tool</option>
                                                    <option value="mobile">Mobile App</option>
                                                </select>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="mt-3">
                                        <button class="btn btn-success btn-lg" onclick="generateCustomAI()">
                                             Generate AI Application
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="card">
                                <div class="card-header">Preview</div>
                                <div class="card-body">
                                    <div id="ai-preview" style="background: #1a1a1a; color: #f1f5f9; padding: 15px; border-radius: 8px; min-height: 300px; font-family: monospace;">
                                        Select functions to see application preview...
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        // Missing Ecosystem Functions
        function selectNode(nodeType) {
            addChatMessage('MITO', `Selected ${nodeType} node for configuration.`);
        }

        function addEcosystemNode() {
            addChatMessage('MITO', 'New ecosystem node added. Configure connections and dependencies.');
        }

        function connectNodes() {
            addChatMessage('MITO', 'Connecting ecosystem nodes with data flow pathways.');
        }

        function deployEcosystem() {
            addChatMessage('MITO', 'Deploying complete ecosystem with all connected services.');
        }

        // Comprehensive File Management Functions
        let autoSaveEnabled = true;
        let projectData = {
            name: 'MITO Project',
            lastSaved: new Date(),
            content: {},
            version: '1.0.0'
        };

        // Auto-save functionality
        function initAutoSave() {
            if (autoSaveEnabled) {
                setInterval(() => {
                    autoSaveProject();
                }, 30000); // Auto-save every 30 seconds
            }
        }

        function autoSaveProject() {
            if (!autoSaveEnabled) return;
            
            projectData.lastSaved = new Date();
            projectData.content = captureWorkspaceState();
            
            localStorage.setItem('mito_autosave', JSON.stringify(projectData));
            updateAutoSaveStatus('Auto-saved at ' + new Date().toLocaleTimeString());
        }

        function updateAutoSaveStatus(message) {
            const statusElement = document.getElementById('auto-save-status');
            if (statusElement) {
                statusElement.textContent = message;
                statusElement.style.color = '#28a745';
                setTimeout(() => {
                    statusElement.style.color = '';
                }, 3000);
            }
        }

        function captureWorkspaceState() {
            return {
                activePhase: document.querySelector('.phase-step.active')?.textContent || 'Phase 1',
                chatHistory: document.getElementById('chat-messages')?.innerHTML || '',
                codeContent: document.querySelector('.code-editor')?.innerHTML || '',
                timestamp: new Date().toISOString()
            };
        }

        function quickSave() {
            saveProject();
        }

        function saveProject() {
            projectData.content = captureWorkspaceState();
            projectData.lastSaved = new Date();
            
            fetch('/api/save-project', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(projectData)
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    addChatMessage('MITO', 'Project saved successfully!');
                    updateAutoSaveStatus('Saved');
                } else {
                    addChatMessage('MITO', 'Save failed: ' + data.error);
                }
            })
            .catch(() => {
                // Fallback to local storage
                localStorage.setItem('mito_project', JSON.stringify(projectData));
                addChatMessage('MITO', 'Project saved locally.');
                updateAutoSaveStatus('Saved locally');
            });
        }

        function saveAsProject() {
            const newName = prompt('Enter new project name:', projectData.name + ' Copy');
            if (newName) {
                const newProject = {
                    ...projectData,
                    name: newName,
                    lastSaved: new Date(),
                    content: captureWorkspaceState()
                };
                
                fetch('/api/save-project', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(newProject)
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        projectData = newProject;
                        addChatMessage('MITO', `Project saved as "${newName}"!`);
                    }
                });
            }
        }

        function importProject() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json,.mito';
            input.onchange = function(e) {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function(event) {
                        try {
                            const importedData = JSON.parse(event.target.result);
                            projectData = importedData;
                            loadProjectState(importedData);
                            addChatMessage('MITO', `Project "${importedData.name}" imported successfully!`);
                        } catch (error) {
                            addChatMessage('MITO', 'Import failed: Invalid file format.');
                        }
                    };
                    reader.readAsText(file);
                }
            };
            input.click();
        }

        function loadProjectState(data) {
            if (data.content) {
                // Restore workspace state
                if (data.content.chatHistory) {
                    const chatMessages = document.getElementById('chat-messages');
                    if (chatMessages) chatMessages.innerHTML = data.content.chatHistory;
                }
                if (data.content.codeContent) {
                    const codeEditor = document.querySelector('.code-editor');
                    if (codeEditor) codeEditor.innerHTML = data.content.codeContent;
                }
            }
        }

        function exportProject() {
            const exportData = {
                ...projectData,
                content: captureWorkspaceState(),
                exportedAt: new Date().toISOString(),
                version: '1.0.0',
                platform: 'MITO Engine'
            };
            
            const blob = new Blob([JSON.stringify(exportData, null, 2)], { 
                type: 'application/json' 
            });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `${projectData.name.replace(/\s+/g, '_')}.mito`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            addChatMessage('MITO', 'Project exported successfully!');
        }

        function printProject() {
            const printWindow = window.open('', '_blank');
            const projectSummary = `
                <html>
                <head>
                    <title>${projectData.name} - Project Report</title>
                    <style>
                        body { font-family: Arial, sans-serif; margin: 20px; }
                        .header { border-bottom: 2px solid #333; padding-bottom: 10px; }
                        .section { margin: 20px 0; }
                        .code-block { background: #f5f5f5; padding: 15px; border-radius: 5px; }
                        pre { white-space: pre-wrap; }
                    </style>
                </head>
                <body>
                    <div class="header">
                        <h1>${projectData.name}</h1>
                        <p>Generated by MITO Engine on ${new Date().toLocaleDateString()}</p>
                        <p>Version: ${projectData.version}</p>
                    </div>
                    <div class="section">
                        <h2>Project Overview</h2>
                        <p>Last Modified: ${projectData.lastSaved}</p>
                        <p>Current Phase: ${projectData.content?.activePhase || 'Phase 1'}</p>
                    </div>
                    <div class="section">
                        <h2>Code Content</h2>
                        <div class="code-block">
                            <pre>${projectData.content?.codeContent?.replace(/<[^>]*>/g, '') || 'No code content available'}</pre>
                        </div>
                    </div>
                    <div class="section">
                        <h2>Chat History</h2>
                        <div>${projectData.content?.chatHistory?.replace(/<[^>]*>/g, '') || 'No chat history available'}</div>
                    </div>
                </body>
                </html>
            `;
            
            printWindow.document.write(projectSummary);
            printWindow.document.close();
            printWindow.print();
            
            addChatMessage('MITO', 'Project report prepared for printing.');
        }

        function shareProject() {
            const shareData = {
                name: projectData.name,
                description: `MITO AI project created on ${new Date().toLocaleDateString()}`,
                content: captureWorkspaceState(),
                sharedAt: new Date().toISOString()
            };
            
            fetch('/api/share-project', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(shareData)
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    const shareUrl = data.shareUrl || `${window.location.origin}/shared/${data.shareId}`;
                    navigator.clipboard.writeText(shareUrl).then(() => {
                        addChatMessage('MITO', `Project shared! Link copied to clipboard: ${shareUrl}`);
                    });
                } else {
                    // Fallback sharing method
                    const shareableData = encodeURIComponent(JSON.stringify(shareData));
                    const shareUrl = `${window.location.origin}?import=${shareableData}`;
                    navigator.clipboard.writeText(shareUrl);
                    addChatMessage('MITO', 'Share link copied to clipboard!');
                }
            })
            .catch(() => {
                // Manual sharing fallback
                const shareText = `Check out my MITO AI project: ${projectData.name}`;
                if (navigator.share) {
                    navigator.share({
                        title: projectData.name,
                        text: shareText,
                        url: window.location.href
                    });
                } else {
                    prompt('Copy this link to share your project:', window.location.href);
                }
            });
        }

        function toggleAutoSave() {
            autoSaveEnabled = !autoSaveEnabled;
            const toggleText = document.getElementById('auto-save-toggle');
            if (toggleText) {
                toggleText.textContent = autoSaveEnabled ? 'Disable Auto-Save' : 'Enable Auto-Save';
            }
            
            addChatMessage('MITO', `Auto-save ${autoSaveEnabled ? 'enabled' : 'disabled'}.`);
            
            if (autoSaveEnabled) {
                initAutoSave();
            }
        }

        // Initialize auto-save and load any existing project
        function initializeWorkspace() {
            // Silently check for auto-saved data without prompting
            const autoSaved = localStorage.getItem('mito_autosave');
            if (autoSaved) {
                try {
                    const savedData = JSON.parse(autoSaved);
                    // Only restore if data is recent (within 1 hour) and user hasn't dismissed it
                    const savedTime = new Date(savedData.lastSaved);
                    const oneHourAgo = new Date(Date.now() - 60 * 60 * 1000);
                    const dismissed = localStorage.getItem('mito_autosave_dismissed');
                    
                    if (savedTime > oneHourAgo && !dismissed) {
                        // Show a subtle notification instead of blocking confirm dialog
                        showAutoSaveNotification();
                    }
                } catch (error) {
                    console.error('Failed to restore auto-saved data:', error);
                }
            }
            
            // Check for shared project in URL
            const urlParams = new URLSearchParams(window.location.search);
            const importData = urlParams.get('import');
            if (importData) {
                try {
                    const sharedProject = JSON.parse(decodeURIComponent(importData));
                    projectData = sharedProject;
                    loadProjectState(sharedProject);
                    addChatMessage('MITO', 'Shared project loaded successfully!');
                } catch (error) {
                    console.error('Failed to load shared project:', error);
                }
            }
            
            initAutoSave();
        }

        function showAutoSaveNotification() {
            // Create a subtle notification banner instead of blocking popup
            const notification = document.createElement('div');
            notification.id = 'autosave-notification';
            notification.style.cssText = `
                position: fixed;
                top: 10px;
                right: 10px;
                background: var(--accent-color);
                color: white;
                padding: 10px 15px;
                border-radius: 8px;
                z-index: 10000;
                font-size: 0.9rem;
                box-shadow: 0 4px 8px rgba(0,0,0,0.2);
                display: flex;
                align-items: center;
                gap: 10px;
            `;
            notification.innerHTML = `
                <span>Auto-saved data available</span>
                <button onclick="restoreAutoSave()" style="background: rgba(255,255,255,0.2); border: none; color: white; padding: 4px 8px; border-radius: 4px; cursor: pointer;">Restore</button>
                <button onclick="dismissAutoSave()" style="background: rgba(255,255,255,0.2); border: none; color: white; padding: 4px 8px; border-radius: 4px; cursor: pointer;">×</button>
            `;
            document.body.appendChild(notification);
            
            // Auto-hide after 10 seconds
            setTimeout(() => {
                if (notification.parentNode) {
                    notification.parentNode.removeChild(notification);
                }
            }, 10000);
        }

        function restoreAutoSave() {
            const autoSaved = localStorage.getItem('mito_autosave');
            if (autoSaved) {
                try {
                    const savedData = JSON.parse(autoSaved);
                    projectData = savedData;
                    loadProjectState(savedData);
                    addChatMessage('MITO', 'Auto-saved project restored.');
                } catch (error) {
                    console.error('Failed to restore auto-saved data:', error);
                }
            }
            dismissAutoSave();
        }

        function dismissAutoSave() {
            localStorage.setItem('mito_autosave_dismissed', 'true');
            const notification = document.getElementById('autosave-notification');
            if (notification && notification.parentNode) {
                notification.parentNode.removeChild(notification);
            }
        }

        // Initialize workbench
        document.addEventListener('DOMContentLoaded', function() {
            initializeWorkspace();
            
            // Initialize Mermaid
            if (typeof mermaid !== 'undefined') {
                mermaid.initialize({ 
                    startOnLoad: false, 
                    theme: 'dark',
                    themeVariables: {
                        darkMode: true,
                        primaryColor: '#3b82f6',
                        primaryTextColor: '#f1f5f9',
                        primaryBorderColor: '#334155',
                        lineColor: '#cbd5e1'
                    }
                });
            }
            
            // Initialize code editor keyboard shortcuts with delay to ensure element exists
            setTimeout(() => {
                addKeyboardShortcuts();
            }, 500);
            
            console.log('MITO Giant Workbench initialized with Code Editor');
        });
        // MITO Agent Monitoring Functions
        function startMitoMonitoring() {
            setInterval(updateMitoStatus, 5000);
            setInterval(updateAPIUsage, 10000);
            setInterval(updateNotifications, 3000);
            
            updateMitoStatus();
            updateAPIUsage();
            updateNotifications();
        }

        function updateMitoStatus() {
            fetch('/api/mito/status')
                .then(response => response.json())
                .then(data => {
                    const statusElement = document.getElementById('agent-status');
                    const queueElement = document.getElementById('task-queue');
                    const providerElement = document.getElementById('current-provider');
                    
                    if (statusElement) {
                        if (data.agent_status === 'working') {
                            statusElement.innerHTML = '🟡 Working';
                            statusElement.style.color = 'var(--warning-color)';
                        } else if (data.agent_status === 'idle') {
                            statusElement.innerHTML = '🟢 Idle';
                            statusElement.style.color = 'var(--success-color)';
                        } else {
                            statusElement.innerHTML = '🔴 Offline';
                            statusElement.style.color = 'var(--danger-color)';
                        }
                    }
                    
                    if (queueElement) {
                        queueElement.textContent = `${data.queue_length || 0} tasks`;
                    }
                    
                    if (providerElement) {
                        const providers = data.providers || {};
                        const activeProvider = Object.keys(providers).find(p => providers[p].available) || 'Local';
                        providerElement.textContent = activeProvider.charAt(0).toUpperCase() + activeProvider.slice(1);
                    }
                })
                .catch(error => {
                    const statusElement = document.getElementById('agent-status');
                    if (statusElement) {
                        statusElement.innerHTML = '🔴 Offline';
                    }
                });
        }

        function updateAPIUsage() {
            fetch('/api/usage/detailed')
                .then(response => response.json())
                .then(data => {
                    const usageSummary = data.usage_summary || {};
                    const costBreakdown = data.cost_breakdown || {};
                    
                    const llamaUsage = usageSummary.llama_usage || 0;
                    const llamaUsageEl = document.getElementById('llama-usage');
                    const llamaBarEl = document.getElementById('llama-bar');
                    if (llamaUsageEl) llamaUsageEl.textContent = `${llamaUsage}%`;
                    if (llamaBarEl) llamaBarEl.style.width = `${llamaUsage}%`;
                    
                    const claudeUsage = usageSummary.claude_usage || 0;
                    const claudeUsageEl = document.getElementById('claude-usage');
                    const claudeBarEl = document.getElementById('claude-bar');
                    if (claudeUsageEl) claudeUsageEl.textContent = `${claudeUsage}%`;
                    if (claudeBarEl) claudeBarEl.style.width = `${claudeUsage}%`;
                    
                    const totalCost = costBreakdown.total_cost || 0;
                    const totalCostEl = document.getElementById('total-cost');
                    const headerTotalCostEl = document.getElementById('header-total-cost');
                    if (totalCostEl) totalCostEl.textContent = `$${totalCost.toFixed(2)}`;
                    if (headerTotalCostEl) headerTotalCostEl.textContent = `$${totalCost.toFixed(2)}`;
                    
                    // Color coding for usage levels
                    if (llamaBarEl) {
                        if (llamaUsage > 80) {
                            llamaBarEl.style.background = 'var(--danger-color)';
                        } else if (llamaUsage > 60) {
                            llamaBarEl.style.background = 'var(--warning-color)';
                        }
                    }
                    
                    if (claudeBarEl) {
                        if (claudeUsage > 80) {
                            claudeBarEl.style.background = 'var(--danger-color)';
                        } else if (claudeUsage > 60) {
                            claudeBarEl.style.background = 'var(--warning-color)';
                        }
                    }
                })
                .catch(error => console.log('Usage data unavailable'));
        }

        function updateNotifications() {
            fetch('/api/notifications')
                .then(response => response.json())
                .then(data => {
                    const notifications = data.notifications || [];
                    const summary = data.summary || {};
                    
                    const countElement = document.getElementById('notification-count');
                    const headerCountElement = document.getElementById('header-notification-count');
                    const unreadCount = summary.unread_count || 0;
                    
                    if (countElement) {
                        countElement.textContent = unreadCount;
                        countElement.style.display = unreadCount > 0 ? 'inline' : 'none';
                    }
                    if (headerCountElement) {
                        headerCountElement.textContent = unreadCount;
                        headerCountElement.style.display = unreadCount > 0 ? 'inline' : 'none';
                    }
                    
                    const panelElement = document.getElementById('notifications-panel');
                    if (panelElement) {
                        if (notifications.length === 0) {
                            panelElement.innerHTML = '<div style="text-align: center; color: var(--text-secondary); padding: 20px;">No notifications</div>';
                        } else {
                            panelElement.innerHTML = notifications.slice(0, 5).map(notification => `
                                <div style="margin-bottom: 8px; padding: 8px; background: var(--accent-bg); border-radius: 4px; cursor: pointer;" 
                                     onclick="markNotificationRead('${notification.id}')">
                                    <div style="display: flex; justify-content: space-between; align-items: center;">
                                        <strong style="font-size: 0.8rem;">${notification.title}</strong>
                                        <span style="font-size: 0.7rem; color: var(--text-secondary);">
                                            ${new Date(notification.timestamp).toLocaleTimeString()}
                                        </span>
                                    </div>
                                    <div style="font-size: 0.7rem; color: var(--text-secondary); margin-top: 4px;">
                                        ${notification.message.substring(0, 80)}${notification.message.length > 80 ? '...' : ''}
                                    </div>
                                </div>
                            `).join('');
                        }
                    }
                })
                .catch(error => console.log('Notifications unavailable'));
        }

        function markNotificationRead(notificationId) {
            fetch(`/api/notifications/${notificationId}/read`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' }
            })
            .then(() => updateNotifications())
            .catch(error => console.log('Failed to mark notification as read'));
        }

        function switchAPIProvider(provider) {
            fetch('/api/mito/switch_provider', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ provider: provider })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    addChatMessage('MITO', `Switching to ${provider} API provider`);
                    setTimeout(updateMitoStatus, 2000);
                }
            })
            .catch(error => console.log('API switch failed'));
        }

        function addMitoTask(taskName, priority = 'medium') {
            fetch('/api/mito/add_task', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ 
                    name: taskName,
                    priority: priority 
                })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    addChatMessage('MITO', `Task added to autonomous queue: ${taskName}`);
                    setTimeout(updateMitoStatus, 1000);
                }
            })
            .catch(error => console.log('Failed to add task'));
        }

        // Image generation functions
        function generateImage() {
            const prompt = document.getElementById('imagePrompt').value.trim();
            const style = document.getElementById('imageStyle').value;
            const size = document.getElementById('imageSize').value;
            
            if (!prompt) {
                alert('Please enter a prompt for the image');
                return;
            }
            
            const displayDiv = document.getElementById('imageDisplay');
            displayDiv.innerHTML = '<div style="text-align: center; padding: 40px;"> Generating image...</div>';
            
            fetch('/api/generate-image', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    prompt: prompt,
                    style: style,
                    size: size
                })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    displayDiv.innerHTML = `
                        <img src="${data.image_url}" style="max-width: 100%; border-radius: 8px; margin-bottom: 15px;">
                        <div style="text-align: center;">
                            <p style="color: var(--text-secondary); margin-bottom: 10px;">Generated by: ${data.provider}</p>
                            <button onclick="downloadImage('${data.image_url}', '${prompt.substring(0, 20)}')" 
                                style="background: var(--success-color); border: none; color: white; padding: 8px 16px; 
                                border-radius: 6px; cursor: pointer; margin-right: 10px;">
                                 Download
                            </button>
                        </div>
                    `;
                } else {
                    displayDiv.innerHTML = `
                        <div style="text-align: center; padding: 40px; color: var(--danger-color);">
                            <br>
                            Generation failed: ${data.error}
                        </div>
                    `;
                }
            })
            .catch(error => {
                displayDiv.innerHTML = `
                    <div style="text-align: center; padding: 40px; color: var(--danger-color);">
                        <br>
                        Error: ${error.message}
                    </div>
                `;
            });
        }

        function setPrompt(prompt) {
            document.getElementById('imagePrompt').value = prompt;
        }

        function downloadImage(url, filename) {
            const link = document.createElement('a');
            link.href = url;
            link.download = `${filename.replace(/[^a-z0-9]/gi, '_')}.png`;
            link.click();
        }

        function loadImageGenerator() {
            const workspace = document.getElementById('main-canvas');
            workspace.innerHTML = `
                <div style="padding: 20px;">
                    <h2> AI Image Generator</h2>
                    <div style="display: grid; grid-template-columns: 1fr 400px; gap: 20px; margin-top: 20px;">
                        <div>
                            <div style="background: var(--secondary-bg); padding: 20px; border-radius: 8px; margin-bottom: 20px;">
                                <h4>Generate Image</h4>
                                <textarea id="imagePrompt" placeholder="Describe the image you want to generate..." 
                                    style="width: 100%; height: 100px; background: var(--accent-bg); border: 1px solid var(--accent-bg); 
                                    color: var(--text-primary); padding: 12px; border-radius: 6px; resize: vertical; margin: 10px 0;"></textarea>
                                
                                <div style="display: flex; gap: 15px; margin: 15px 0;">
                                    <div>
                                        <label style="color: var(--text-secondary); font-size: 0.9rem;">Style:</label>
                                        <select id="imageStyle" style="background: var(--accent-bg); border: 1px solid var(--accent-bg); 
                                            color: var(--text-primary); padding: 8px; border-radius: 6px; margin-left: 8px;">
                                            <option value="realistic">Realistic</option>
                                            <option value="artistic">Artistic</option>
                                            <option value="cartoon">Cartoon</option>
                                            <option value="abstract">Abstract</option>
                                            <option value="vintage">Vintage</option>
                                        </select>
                                    </div>
                                    <div>
                                        <label style="color: var(--text-secondary); font-size: 0.9rem;">Size:</label>
                                        <select id="imageSize" style="background: var(--accent-bg); border: 1px solid var(--accent-bg); 
                                            color: var(--text-primary); padding: 8px; border-radius: 6px; margin-left: 8px;">
                                            <option value="512x512">512×512</option>
                                            <option value="1024x1024" selected>1024×1024</option>
                                            <option value="1024x1792">1024×1792 (Portrait)</option>
                                            <option value="1792x1024">1792×1024 (Landscape)</option>
                                        </select>
                                    </div>
                                </div>
                                
                                <button onclick="generateImage()" style="background: var(--accent-color); border: none; 
                                    color: white; padding: 12px 24px; border-radius: 6px; cursor: pointer; font-size: 1rem;">
                                     Generate Image
                                </button>
                            </div>
                            
                            <div id="imageResult" style="background: var(--secondary-bg); padding: 20px; border-radius: 8px;">
                                <h4>Generated Image</h4>
                                <div id="imageDisplay" style="text-align: center; padding: 40px; color: var(--text-secondary);">
                                    No image generated yet. Enter a prompt and click Generate Image.
                                </div>
                            </div>
                        </div>
                        
                        <div>
                            <div style="background: var(--secondary-bg); padding: 20px; border-radius: 8px; margin-bottom: 20px;">
                                <h4>Quick Prompts</h4>
                                <div style="display: flex; flex-direction: column; gap: 8px; margin-top: 15px;">
                                    <button onclick="setPrompt('A futuristic cityscape at sunset')" class="quick-prompt-btn">Futuristic City</button>
                                    <button onclick="setPrompt('A serene mountain landscape with a crystal clear lake')" class="quick-prompt-btn">Mountain Lake</button>
                                    <button onclick="setPrompt('An abstract digital art piece with vibrant colors')" class="quick-prompt-btn">Abstract Art</button>
                                    <button onclick="setPrompt('A cute cartoon robot in a workshop')" class="quick-prompt-btn">Cartoon Robot</button>
                                    <button onclick="setPrompt('A vintage photograph of a classic car')" class="quick-prompt-btn">Vintage Car</button>
                                </div>
                            </div>
                            
                            <div style="background: var(--secondary-bg); padding: 20px; border-radius: 8px;">
                                <h4>Generation Tips</h4>
                                <ul style="color: var(--text-secondary); font-size: 0.9rem; line-height: 1.6;">
                                    <li>Be specific about details, colors, and style</li>
                                    <li>Include lighting conditions (sunset, bright, dark)</li>
                                    <li>Mention camera angles or perspectives</li>
                                    <li>Add artistic styles (photorealistic, watercolor, oil painting)</li>
                                    <li>Specify mood or atmosphere</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
                
                <style>
                .quick-prompt-btn {
                    background: var(--accent-bg);
                    border: 1px solid var(--accent-bg);
                    color: var(--text-primary);
                    padding: 8px 12px;
                    border-radius: 6px;
                    cursor: pointer;
                    text-align: left;
                    transition: all 0.2s;
                }
                .quick-prompt-btn:hover {
                    background: var(--accent-color);
                    border-color: var(--accent-color);
                }
                </style>
            `;
        }

        function loadWhiteboard() {
            const workspace = document.getElementById('main-canvas');
            workspace.innerHTML = `
                <div style="padding: 20px;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                        <h2> Interactive Whiteboard</h2>
                        <button onclick="openFullWhiteboard()" style="background: var(--accent-color); border: none; 
                            color: white; padding: 10px 20px; border-radius: 6px; cursor: pointer;">
                             Open Full Whiteboard
                        </button>
                    </div>
                    
                    <div style="background: var(--secondary-bg); padding: 20px; border-radius: 8px;">
                        <div style="display: grid; grid-template-columns: 1fr 300px; gap: 20px;">
                            <div>
                                <div style="background: white; border-radius: 8px; padding: 10px; margin-bottom: 15px;">
                                    <canvas id="miniWhiteboard" width="600" height="400" style="display: block; cursor: crosshair; border-radius: 6px;"></canvas>
                                </div>
                                
                                <div style="display: flex; gap: 10px; align-items: center;">
                                    <button onclick="setWhiteboardTool('pen')" class="wb-tool-btn active" data-tool="pen">
                                        
                                    </button>
                                    <button onclick="setWhiteboardTool('eraser')" class="wb-tool-btn" data-tool="eraser">
                                        
                                    </button>
                                    <input type="color" id="wbColor" value="#000000" onchange="setWhiteboardColor(this.value)" 
                                        style="width: 40px; height: 40px; border: none; border-radius: 6px; cursor: pointer;">
                                    <input type="range" id="wbSize" min="1" max="20" value="3" onchange="setWhiteboardSize(this.value)"
                                        style="margin: 0 10px;">
                                    <span style="font-size: 0.9rem;">Size: <span id="wbSizeDisplay">3</span>px</span>
                                    <button onclick="clearWhiteboard()" style="background: var(--danger-color); border: none; 
                                        color: white; padding: 8px 12px; border-radius: 6px; cursor: pointer; margin-left: auto;">
                                         Clear
                                    </button>
                                </div>
                            </div>
                            
                            <div>
                                <div style="margin-bottom: 20px;">
                                    <h4 style="margin-bottom: 10px;">Quick Actions</h4>
                                    <button onclick="saveWhiteboardImage()" style="background: var(--success-color); border: none; 
                                        color: white; padding: 10px; border-radius: 6px; cursor: pointer; width: 100%; margin-bottom: 8px;">
                                         Save as PNG
                                    </button>
                                    <button onclick="addWhiteboardText()" style="background: var(--accent-color); border: none; 
                                        color: white; padding: 10px; border-radius: 6px; cursor: pointer; width: 100%;">
                                         Add Text
                                    </button>
                                </div>
                                
                                <div>
                                    <h4 style="margin-bottom: 10px;">Shapes</h4>
                                    <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 8px;">
                                        <button onclick="addWhiteboardShape('rectangle')" class="shape-btn">
                                            
                                        </button>
                                        <button onclick="addWhiteboardShape('circle')" class="shape-btn">
                                            
                                        </button>
                                        <button onclick="addWhiteboardShape('line')" class="shape-btn">
                                            
                                        </button>
                                        <button onclick="addWhiteboardShape('arrow')" class="shape-btn">
                                            
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <style>
                .wb-tool-btn {
                    background: var(--accent-bg);
                    border: 1px solid var(--accent-bg);
                    color: var(--text-primary);
                    padding: 10px 12px;
                    border-radius: 6px;
                    cursor: pointer;
                    transition: all 0.2s;
                }
                .wb-tool-btn:hover, .wb-tool-btn.active {
                    background: var(--accent-color);
                    border-color: var(--accent-color);
                    color: white;
                }
                .shape-btn {
                    background: var(--accent-bg);
                    border: 1px solid var(--accent-bg);
                    color: var(--text-primary);
                    padding: 12px;
                    border-radius: 6px;
                    cursor: pointer;
                    font-size: 16px;
                    transition: all 0.2s;
                }
                .shape-btn:hover {
                    background: var(--accent-color);
                    border-color: var(--accent-color);
                    color: white;
                }
                </style>
            `;
            
            setTimeout(initMiniWhiteboard, 100);
        }

        // Mini whiteboard functions
        let wbCanvas, wbCtx, wbIsDrawing = false, wbTool = 'pen', wbColor = '#000000', wbSize = 3;

        function initMiniWhiteboard() {
            wbCanvas = document.getElementById('miniWhiteboard');
            if (!wbCanvas) return;
            
            wbCtx = wbCanvas.getContext('2d');
            wbCtx.lineCap = 'round';
            wbCtx.lineJoin = 'round';
            
            wbCanvas.addEventListener('mousedown', startWhiteboardDrawing);
            wbCanvas.addEventListener('mousemove', whiteboardDraw);
            wbCanvas.addEventListener('mouseup', stopWhiteboardDrawing);
            wbCanvas.addEventListener('mouseout', stopWhiteboardDrawing);
        }

        function startWhiteboardDrawing(e) {
            wbIsDrawing = true;
            const rect = wbCanvas.getBoundingClientRect();
            const x = e.clientX - rect.left;
            const y = e.clientY - rect.top;
            
            wbCtx.beginPath();
            wbCtx.moveTo(x, y);
        }

        function whiteboardDraw(e) {
            if (!wbIsDrawing) return;
            
            const rect = wbCanvas.getBoundingClientRect();
            const x = e.clientX - rect.left;
            const y = e.clientY - rect.top;
            
            wbCtx.lineWidth = wbSize;
            
            if (wbTool === 'pen') {
                wbCtx.globalCompositeOperation = 'source-over';
                wbCtx.strokeStyle = wbColor;
            } else if (wbTool === 'eraser') {
                wbCtx.globalCompositeOperation = 'destination-out';
            }
            
            wbCtx.lineTo(x, y);
            wbCtx.stroke();
        }

        function stopWhiteboardDrawing() {
            wbIsDrawing = false;
        }

        function setWhiteboardTool(tool) {
            wbTool = tool;
            document.querySelectorAll('.wb-tool-btn').forEach(btn => btn.classList.remove('active'));
            document.querySelector(`[data-tool="${tool}"]`).classList.add('active');
        }

        function setWhiteboardColor(color) {
            wbColor = color;
        }

        function setWhiteboardSize(size) {
            wbSize = size;
            document.getElementById('wbSizeDisplay').textContent = size;
        }

        function clearWhiteboard() {
            wbCtx.clearRect(0, 0, wbCanvas.width, wbCanvas.height);
        }

        function saveWhiteboardImage() {
            const link = document.createElement('a');
            link.download = 'whiteboard.png';
            link.href = wbCanvas.toDataURL();
            link.click();
        }

        function addWhiteboardText() {
            const text = prompt('Enter text to add:');
            if (text) {
                wbCtx.fillStyle = wbColor;
                wbCtx.font = `${wbSize * 5}px Arial`;
                wbCtx.fillText(text, 50, 50);
            }
        }

        function addWhiteboardShape(shape) {
            wbCtx.strokeStyle = wbColor;
            wbCtx.lineWidth = wbSize;
            
            if (shape === 'rectangle') {
                wbCtx.strokeRect(100, 100, 100, 60);
            } else if (shape === 'circle') {
                wbCtx.beginPath();
                wbCtx.arc(150, 130, 40, 0, 2 * Math.PI);
                wbCtx.stroke();
            } else if (shape === 'line') {
                wbCtx.beginPath();
                wbCtx.moveTo(100, 150);
                wbCtx.lineTo(200, 150);
                wbCtx.stroke();
            } else if (shape === 'arrow') {
                wbCtx.beginPath();
                wbCtx.moveTo(100, 150);
                wbCtx.lineTo(180, 150);
                wbCtx.lineTo(170, 140);
                wbCtx.moveTo(180, 150);
                wbCtx.lineTo(170, 160);
                wbCtx.stroke();
            }
        }

        function openFullWhiteboard() {
            window.open('/whiteboard', '_blank');
        }

        // Start monitoring when page loads
        document.addEventListener('DOMContentLoaded', function() {
            setTimeout(startMitoMonitoring, 1000); // Start after 1 second delay
        });

        // Chat functions
        function toggleChat() {
            const modal = document.getElementById('chat-modal');
            modal.classList.toggle('active');
            if (modal.classList.contains('active')) {
                document.getElementById('chat-input').focus();
            }
        }

        function sendChatMessage() {
            const input = document.getElementById('chat-input');
            const message = input.value.trim();
            if (!message) return;

            // Add user message immediately
            addChatMessage('You', message);
            input.value = '';

            // Add typing indicator
            const typingId = 'typing-' + Date.now();
            const typingDiv = document.createElement('div');
            typingDiv.id = typingId;
            typingDiv.style.cssText = 'margin-bottom: 10px; padding: 12px; border-radius: 8px; background: var(--primary-bg); border-left: 3px solid var(--accent-color); opacity: 0.7;';
            typingDiv.innerHTML = '<strong>MITO:</strong> <span class="typing-dots">●●●</span> thinking...';
            document.getElementById('chat-messages').appendChild(typingDiv);
            
            // Animate dots
            let dotCount = 0;
            const dotInterval = setInterval(() => {
                const dots = typingDiv.querySelector('.typing-dots');
                if (dots) {
                    dotCount = (dotCount + 1) % 4;
                    dots.textContent = '●'.repeat(dotCount) + '○'.repeat(3 - dotCount);
                }
            }, 500);

            // API call
            fetch('/api/generate', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ prompt: message, provider: 'auto' })
            })
            .then(response => response.json())
            .then(data => {
                clearInterval(dotInterval);
                document.getElementById(typingId)?.remove();
                
                if (data.success && data.response) {
                    addChatMessage('MITO', data.response);
                } else {
                    addChatMessage('MITO', 'I apologize, but I had trouble processing your request. Please try again.');
                }
            })
            .catch(error => {
                clearInterval(dotInterval);
                document.getElementById(typingId)?.remove();
                console.error('Chat error:', error);
                addChatMessage('MITO', 'I encountered a connection issue. Please try again.');
            });
        }

        function addChatMessage(sender, message) {
            const chatMessages = document.getElementById('chat-messages');
            const messageDiv = document.createElement('div');
            messageDiv.style.cssText = 'margin-bottom: 10px; padding: 12px; border-radius: 8px;';
            
            if (sender === 'MITO') {
                messageDiv.style.cssText += 'background: var(--primary-bg); border-left: 3px solid var(--accent-color);';
            } else {
                messageDiv.style.cssText += 'background: var(--accent-bg); text-align: right; border-right: 3px solid var(--success-color);';
            }
            
            messageDiv.innerHTML = `<strong>${sender}:</strong> ${message}`;
            chatMessages.appendChild(messageDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        // Settings functions
        function toggleSettings() {
            const modal = document.getElementById('settings-modal');
            const isVisible = modal.style.display === 'block';
            
            if (isVisible) {
                closeSettings();
            } else {
                modal.style.display = 'block';
                updateSettingsDisplay();
                
                // Focus trap for accessibility
                const firstInput = modal.querySelector('input');
                if (firstInput) {
                    setTimeout(() => firstInput.focus(), 100);
                }
            }
        }

        function closeSettings() {
            const modal = document.getElementById('settings-modal');
            modal.style.display = 'none';
            
            // Remove any focus traps
            const activeElement = document.activeElement;
            if (activeElement && modal.contains(activeElement)) {
                activeElement.blur();
            }
        }

        // Add keyboard support for settings modal
        document.addEventListener('keydown', function(e) {
            const modal = document.getElementById('settings-modal');
            if (modal && modal.style.display === 'block') {
                // Close on Escape key
                if (e.key === 'Escape') {
                    e.preventDefault();
                    closeSettings();
                }
                // Save on Ctrl+S
                if (e.ctrlKey && e.key === 's') {
                    e.preventDefault();
                    saveSettings();
                }
            }
        });

        function saveSettings() {
            const llamaKey = document.getElementById('llama-key').value;
            const claudeKey = document.getElementById('claude-key').value;
            const costThreshold = document.getElementById('cost-threshold').value;
            const usageThreshold = document.getElementById('usage-threshold').value;

            if (llamaKey) localStorage.setItem('llama-api-key', llamaKey);
            if (claudeKey) localStorage.setItem('claude-api-key', claudeKey);
            localStorage.setItem('cost-threshold', costThreshold);
            localStorage.setItem('usage-threshold', usageThreshold);

            addChatMessage('MITO', 'Settings saved successfully!');
            closeSettings();
        }

        function updateSettingsDisplay() {
            // Update system performance metrics
            updateSystemMetrics();
            
            const totalCost = document.getElementById('header-total-cost')?.textContent || '$0.00';
            document.getElementById('settings-total-cost').textContent = totalCost;

            // Copy MITO Agent Status data
            const agentStatus = document.getElementById('agent-status')?.textContent || 'Active';
            const taskQueue = document.getElementById('task-queue')?.textContent || '0 tasks';
            const currentProvider = document.getElementById('current-provider')?.textContent || 'Local';

            document.getElementById('settings-agent-status').textContent = agentStatus;
            document.getElementById('settings-task-queue').textContent = taskQueue;
            document.getElementById('settings-current-provider').textContent = currentProvider;

            document.getElementById('cost-threshold').value = localStorage.getItem('cost-threshold') || '50';
            document.getElementById('usage-threshold').value = localStorage.getItem('usage-threshold') || '80';
        }

        function updateSystemMetrics() {
            // Fetch real system metrics
            fetch('/api/system-status')
                .then(response => response.json())
                .then(data => {
                    // Update AI Health based on provider availability
                    let aiHealth = 85; // Base health
                    if (data.ai_providers) {
                        const availableProviders = Object.values(data.ai_providers).filter(p => p.available).length;
                        const totalProviders = Object.keys(data.ai_providers).length;
                        aiHealth = Math.round((availableProviders / totalProviders) * 100);
                        
                        // Adjust for local fallback
                        if (availableProviders === 1 && data.ai_providers.local?.available) {
                            aiHealth = 75; // Lower health if only local is available
                        }
                    }
                    
                    // Update memory usage (simulated based on active features)
                    const memoryUsage = (Math.random() * 2 + 7).toFixed(1); // 7-9 GB range
                    
                    // Update response time based on provider
                    let responseTime = '2.1ms';
                    if (data.ai_providers?.llama?.available) {
                        responseTime = (Math.random() * 50 + 100).toFixed(0) + 'ms';
                    } else if (data.ai_providers?.claude?.available) {
                        responseTime = (Math.random() * 100 + 150).toFixed(0) + 'ms';
                    }
                    
                    // Update API status
                    const activeProvider = Object.values(data.ai_providers || {}).find(p => p.available && p.name !== 'Local Fallback');
                    const apiStatus = activeProvider ? 'Active' : 'Local Only';
                    
                    // Apply updates to metrics
                    document.getElementById('ai-health-metric').textContent = aiHealth + '%';
                    document.getElementById('ai-health-metric').style.color = aiHealth > 80 ? 'var(--success-color)' : 
                                                                              aiHealth > 60 ? 'var(--warning-color)' : 'var(--danger-color)';
                    
                    document.getElementById('memory-metric').textContent = memoryUsage + 'GB';
                    document.getElementById('response-metric').textContent = responseTime;
                    document.getElementById('api-status-metric').textContent = apiStatus;
                    document.getElementById('api-status-metric').style.color = apiStatus === 'Active' ? 'var(--success-color)' : 'var(--warning-color)';
                })
                .catch(() => {
                    // Fallback values if API fails
                    document.getElementById('ai-health-metric').textContent = '75%';
                    document.getElementById('ai-health-metric').style.color = 'var(--warning-color)';
                    document.getElementById('memory-metric').textContent = '8.2GB';
                    document.getElementById('response-metric').textContent = '2.1ms';
                    document.getElementById('api-status-metric').textContent = 'Local Only';
                    document.getElementById('api-status-metric').style.color = 'var(--warning-color)';
                });
        }

        // Development Tools Implementation
        function loadTerminal() {
            const workspace = document.getElementById('main-canvas');
            workspace.innerHTML = `
                <div class="tool-interface">
                    <h3>Terminal Integration</h3>
                    <div class="row">
                        <div class="col-md-12">
                            <div class="card">
                                <div class="card-header d-flex justify-content-between align-items-center">
                                    <span>Command Line Interface</span>
                                    <div>
                                        <button class="btn btn-sm btn-secondary me-2" onclick="clearTerminal()">Clear</button>
                                        <button class="btn btn-sm btn-primary" onclick="newTerminalTab()">New Tab</button>
                                    </div>
                                </div>
                                <div class="card-body" style="background: #1a1a1a; color: #00ff00; font-family: 'Courier New', monospace; height: 400px; overflow-y: auto;">
                                    <div id="terminal-output" style="white-space: pre-wrap; margin-bottom: 10px;">
MITO Terminal v1.0.0
Type 'help' for available commands.

$ </div>
                                    <div style="display: flex; align-items: center;">
                                        <span>$ </span>
                                        <input type="text" id="terminal-input" style="background: transparent; border: none; color: #00ff00; outline: none; flex: 1; margin-left: 5px;" onkeypress="if(event.key==='Enter') executeCommand()" placeholder="Enter command...">
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row mt-3">
                        <div class="col-md-6">
                            <div class="card">
                                <div class="card-header">Quick Commands</div>
                                <div class="card-body">
                                    <button class="btn btn-outline-primary btn-sm me-2 mb-2" onclick="runQuickCommand('ls -la')">List Files</button>
                                    <button class="btn btn-outline-primary btn-sm me-2 mb-2" onclick="runQuickCommand('pwd')">Current Dir</button>
                                    <button class="btn btn-outline-primary btn-sm me-2 mb-2" onclick="runQuickCommand('ps aux')">Processes</button>
                                    <button class="btn btn-outline-primary btn-sm me-2 mb-2" onclick="runQuickCommand('df -h')">Disk Usage</button>
                                    <button class="btn btn-outline-primary btn-sm me-2 mb-2" onclick="runQuickCommand('free -h')">Memory</button>
                                    <button class="btn btn-outline-primary btn-sm me-2 mb-2" onclick="runQuickCommand('top')">System Monitor</button>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="card">
                                <div class="card-header">Command History</div>
                                <div class="card-body">
                                    <div id="command-history" style="max-height: 200px; overflow-y: auto; font-family: monospace; font-size: 0.9rem;">
                                        No commands executed yet...
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        function loadPackageManager() {
            const workspace = document.getElementById('main-canvas');
            workspace.innerHTML = `
                <div class="tool-interface">
                    <h3>Package Manager UI</h3>
                    <div class="row">
                        <div class="col-md-6">
                            <div class="card">
                                <div class="card-header">Install Packages</div>
                                <div class="card-body">
                                    <div class="form-group mb-3">
                                        <label>Package Manager</label>
                                        <select id="package-manager-type" class="form-control">
                                            <option value="npm">npm (Node.js)</option>
                                            <option value="pip">pip (Python)</option>
                                            <option value="yarn">yarn (Node.js)</option>
                                            <option value="conda">conda (Python)</option>
                                        </select>
                                    </div>
                                    <div class="form-group mb-3">
                                        <label>Package Name(s)</label>
                                        <input type="text" id="package-names" class="form-control" placeholder="express, lodash, axios">
                                        <small class="text-muted">Separate multiple packages with commas</small>
                                    </div>
                                    <div class="form-group mb-3">
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" id="save-dev">
                                            <label class="form-check-label">Save as dev dependency</label>
                                        </div>
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" id="global-install">
                                            <label class="form-check-label">Global installation</label>
                                        </div>
                                    </div>
                                    <button class="btn btn-success me-2" onclick="installPackages()">Install</button>
                                    <button class="btn btn-warning me-2" onclick="uninstallPackages()">Uninstall</button>
                                    <button class="btn btn-info" onclick="updatePackages()">Update All</button>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="card">
                                <div class="card-header">Installed Packages</div>
                                <div class="card-body">
                                    <div id="installed-packages" style="max-height: 300px; overflow-y: auto;">
                                        <div class="package-item d-flex justify-content-between align-items-center mb-2 p-2" style="background: var(--accent-bg); border-radius: 4px;">
                                            <div>
                                                <strong>express</strong>
                                                <small class="text-muted">^4.18.2</small>
                                            </div>
                                            <button class="btn btn-sm btn-outline-danger" onclick="removePackage('express')">Remove</button>
                                        </div>
                                        <div class="package-item d-flex justify-content-between align-items-center mb-2 p-2" style="background: var(--accent-bg); border-radius: 4px;">
                                            <div>
                                                <strong>flask</strong>
                                                <small class="text-muted">2.3.3</small>
                                            </div>
                                            <button class="btn btn-sm btn-outline-danger" onclick="removePackage('flask')">Remove</button>
                                        </div>
                                        <div class="package-item d-flex justify-content-between align-items-center mb-2 p-2" style="background: var(--accent-bg); border-radius: 4px;">
                                            <div>
                                                <strong>axios</strong>
                                                <small class="text-muted">^1.5.0</small>
                                            </div>
                                            <button class="btn btn-sm btn-outline-danger" onclick="removePackage('axios')">Remove</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row mt-3">
                        <div class="col-md-12">
                            <div class="card">
                                <div class="card-header">Installation Log</div>
                                <div class="card-body">
                                    <div id="package-log" style="background: #1a1a1a; color: #00ff00; padding: 15px; border-radius: 8px; height: 200px; overflow-y: auto; font-family: monospace;">
Ready to install packages...
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        function loadAPITester() {
            const workspace = document.getElementById('main-canvas');
            workspace.innerHTML = `
                <div class="tool-interface">
                    <h3>API Tester</h3>
                    <div class="row">
                        <div class="col-md-6">
                            <div class="card">
                                <div class="card-header">Request Configuration</div>
                                <div class="card-body">
                                    <div class="form-group mb-3">
                                        <label>HTTP Method</label>
                                        <select id="http-method" class="form-control">
                                            <option value="GET">GET</option>
                                            <option value="POST">POST</option>
                                            <option value="PUT">PUT</option>
                                            <option value="DELETE">DELETE</option>
                                            <option value="PATCH">PATCH</option>
                                        </select>
                                    </div>
                                    <div class="form-group mb-3">
                                        <label>URL</label>
                                        <input type="text" id="api-url" class="form-control" placeholder="https://api.example.com/endpoint">
                                    </div>
                                    <div class="form-group mb-3">
                                        <label>Headers</label>
                                        <textarea id="api-headers" class="form-control" rows="4" placeholder="Content-Type: application/json
Authorization: Bearer your-token"></textarea>
                                    </div>
                                    <div class="form-group mb-3">
                                        <label>Request Body</label>
                                        <textarea id="api-body" class="form-control" rows="6" placeholder='{"key": "value"}'></textarea>
                                    </div>
                                    <button class="btn btn-primary me-2" onclick="sendAPIRequest()">Send Request</button>
                                    <button class="btn btn-secondary me-2" onclick="saveAPIRequest()">Save</button>
                                    <button class="btn btn-info" onclick="loadAPIPreset()">Load Preset</button>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="card">
                                <div class="card-header">Response</div>
                                <div class="card-body">
                                    <div class="mb-3">
                                        <div id="response-status" class="mb-2">
                                            <span class="badge bg-secondary">Ready</span>
                                            <span id="response-time" class="text-muted ms-2"></span>
                                        </div>
                                    </div>
                                    <div id="api-response" style="background: #1a1a1a; color: #f1f5f9; padding: 15px; border-radius: 8px; height: 400px; overflow-y: auto; font-family: monospace; white-space: pre-wrap;">
Click "Send Request" to see response...
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row mt-3">
                        <div class="col-md-12">
                            <div class="card">
                                <div class="card-header">Request History & Presets</div>
                                <div class="card-body">
                                    <div class="row">
                                        <div class="col-md-6">
                                            <h6>Recent Requests</h6>
                                            <div id="request-history">
                                                <div class="history-item p-2 mb-2" style="background: var(--accent-bg); border-radius: 4px; cursor: pointer;" onclick="loadHistoryItem(0)">
                                                    <strong>GET</strong> /api/users
                                                    <small class="text-muted d-block">2 minutes ago</small>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <h6>Saved Presets</h6>
                                            <div id="api-presets">
                                                <div class="preset-item p-2 mb-2" style="background: var(--accent-bg); border-radius: 4px; cursor: pointer;" onclick="loadPreset('auth')">
                                                    <strong>Authentication</strong>
                                                    <small class="text-muted d-block">POST /auth/login</small>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        // Notifications functions
        function toggleNotifications() {
            const modal = document.getElementById('notifications-modal');
            modal.style.display = modal.style.display === 'none' ? 'block' : 'none';
            if (modal.style.display === 'block') {
                updateNotificationsModal();
            }
        }

        function closeNotifications() {
            document.getElementById('notifications-modal').style.display = 'none';
        }

        function markAllNotificationsRead() {
            fetch('/api/notifications/mark-all-read', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' }
            })
            .then(() => {
                updateNotifications();
                updateNotificationsModal();
                addChatMessage('MITO', 'All notifications marked as read.');
            })
            .catch(error => console.log('Failed to mark notifications as read'));
        }

        function updateNotificationsModal() {
            fetch('/api/notifications')
            .then(response => response.json())
            .then(data => {
                const notifications = data.notifications || [];
                const modalPanel = document.getElementById('modal-notifications-panel');
                
                if (notifications.length === 0) {
                    modalPanel.innerHTML = '<div style="text-align: center; color: var(--text-secondary); padding: 20px;">No notifications</div>';
                } else {
                    modalPanel.innerHTML = notifications.map(notification => `
                        <div style="margin-bottom: 12px; padding: 12px; background: var(--accent-bg); border-radius: 6px; cursor: pointer;" 
                             onclick="markNotificationRead('${notification.id}')">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
                                <strong style="font-size: 0.95rem;">${notification.title}</strong>
                                <span style="font-size: 0.8rem; color: var(--text-secondary);">
                                    ${new Date(notification.timestamp).toLocaleString()}
                                </span>
                            </div>
                            <div style="font-size: 0.85rem; color: var(--text-secondary);">
                                ${notification.message}
                            </div>
                        </div>
                    `).join('');
                }
            })
            .catch(error => console.log('Notifications unavailable'));
        }

        // Files functions
        function toggleFiles() {
            const modal = document.getElementById('files-modal');
            modal.style.display = modal.style.display === 'none' ? 'block' : 'none';
        }

        function closeFiles() {
            document.getElementById('files-modal').style.display = 'none';
        }

        // File Upload Functions for MITO
        function handleDragOver(event) {
            event.preventDefault();
            event.dataTransfer.dropEffect = 'copy';
            const dropZone = document.getElementById('file-drop-zone');
            dropZone.style.borderColor = 'var(--accent-color)';
            dropZone.style.backgroundColor = 'var(--accent-bg)';
        }

        function handleDragLeave(event) {
            event.preventDefault();
            const dropZone = document.getElementById('file-drop-zone');
            dropZone.style.borderColor = 'var(--border-color)';
            dropZone.style.backgroundColor = 'transparent';
        }

        function handleFileDrop(event) {
            event.preventDefault();
            const dropZone = document.getElementById('file-drop-zone');
            dropZone.style.borderColor = 'var(--border-color)';
            dropZone.style.backgroundColor = 'transparent';
            
            const files = event.dataTransfer.files;
            uploadFilesToMito(files);
        }

        function handleFileSelect(event) {
            const files = event.target.files;
            uploadFilesToMito(files);
        }

        function uploadFilesToMito(files) {
            const learnFromFile = document.getElementById('learn-from-file').checked;
            const progressDiv = document.getElementById('upload-progress');
            const progressBar = document.getElementById('progress-bar');
            const statusDiv = document.getElementById('upload-status');
            
            progressDiv.style.display = 'block';
            
            let uploadedCount = 0;
            const totalFiles = files.length;
            
            for (let i = 0; i < files.length; i++) {
                const file = files[i];
                const formData = new FormData();
                formData.append('file', file);
                formData.append('learn_from_file', learnFromFile);
                
                statusDiv.textContent = `Uploading ${file.name}...`;
                
                fetch('/api/mito/upload-file', {
                    method: 'POST',
                    body: formData
                })
                .then(response => response.json())
                .then(data => {
                    uploadedCount++;
                    const progress = (uploadedCount / totalFiles) * 100;
                    progressBar.style.width = progress + '%';
                    
                    if (data.success) {
                        statusDiv.textContent = `Uploaded ${uploadedCount}/${totalFiles} files`;
                        
                        // If learning is enabled, process the file knowledge
                        if (learnFromFile && data.content) {
                            fetch('/api/mito/process-knowledge', {
                                method: 'POST',
                                headers: {
                                    'Content-Type': 'application/json'
                                },
                                body: JSON.stringify({
                                    filename: data.filename,
                                    content: data.content,
                                    file_type: data.file_type,
                                    analysis: data.analysis
                                })
                            });
                        }
                        
                        // Show notification
                        showNotification(`File "${file.name}" uploaded successfully${learnFromFile ? ' and ready for MITO learning' : ''}`, 'success');
                    } else {
                        showNotification(`Error uploading "${file.name}": ${data.error}`, 'error');
                    }
                    
                    if (uploadedCount === totalFiles) {
                        setTimeout(() => {
                            progressDiv.style.display = 'none';
                            refreshKnowledgeBase();
                        }, 1000);
                    }
                })
                .catch(error => {
                    uploadedCount++;
                    showNotification(`Error uploading "${file.name}": ${error.message}`, 'error');
                    
                    if (uploadedCount === totalFiles) {
                        setTimeout(() => {
                            progressDiv.style.display = 'none';
                            refreshKnowledgeBase();
                        }, 1000);
                    }
                });
            }
        }

        function refreshKnowledgeBase() {
            // Get knowledge base statistics
            fetch('/api/mito/knowledge-stats')
                .then(response => response.json())
                .then(data => {
                    document.getElementById('files-count').textContent = data.file_count || 0;
                    document.getElementById('total-size').textContent = formatFileSize(data.total_size || 0);
                })
                .catch(error => console.error('Error fetching knowledge stats:', error));
            
            // Get recent files list
            fetch('/api/mito/knowledge-files')
                .then(response => response.json())
                .then(data => {
                    const recentFilesDiv = document.getElementById('recent-files');
                    
                    if (data.files && data.files.length > 0) {
                        recentFilesDiv.innerHTML = data.files.slice(0, 5).map(file => `
                            <div style="display: flex; justify-content: space-between; align-items: center; padding: 8px; margin-bottom: 5px; background: var(--accent-bg); border-radius: 4px;">
                                <div>
                                    <div style="font-weight: bold; font-size: 0.9rem;">${escapeHtml(file.filename)}</div>
                                    <div style="font-size: 0.7rem; color: var(--text-secondary);">${file.file_type} • ${new Date(file.upload_time).toLocaleDateString()}</div>
                                </div>
                                <div style="font-size: 0.7rem; color: ${file.learned ? 'var(--success-color)' : 'var(--text-secondary)'};">
                                    ${file.learned ? '✓ Learned' : 'Stored'}
                                </div>
                            </div>
                        `).join('');
                    } else {
                        recentFilesDiv.innerHTML = '<div style="color: var(--text-secondary); text-align: center; padding: 20px;">No files uploaded yet</div>';
                    }
                })
                .catch(error => console.error('Error fetching knowledge files:', error));
        }

        function formatFileSize(bytes) {
            if (bytes === 0) return '0 B';
            const k = 1024;
            const sizes = ['B', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(1)) + ' ' + sizes[i];
        }

        function showNotification(message, type = 'info') {
            // Create notification element
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: var(--primary-bg);
                border: 1px solid var(--border-color);
                border-radius: 6px;
                padding: 12px 16px;
                max-width: 300px;
                z-index: 10000;
                box-shadow: 0 4px 12px rgba(0,0,0,0.3);
                border-left: 4px solid ${type === 'success' ? 'var(--success-color)' : type === 'error' ? 'var(--error-color)' : 'var(--accent-color)'};
            `;
            
            notification.innerHTML = `
                <div style="font-size: 0.9rem; color: var(--text-primary);">${escapeHtml(message)}</div>
            `;
            
            document.body.appendChild(notification);
            
            // Auto remove after 3 seconds
            setTimeout(() => {
                if (notification.parentNode) {
                    notification.parentNode.removeChild(notification);
                }
            }, 3000);
        }

        // Live Collaboration Functions
        let collabMode = 'coding';
        let isCollaborating = false;
        let lastUserContent = '';

        function switchCollabMode(mode) {
            collabMode = mode;
            const userContent = document.getElementById('user-content');
            const mitoContent = document.getElementById('mito-content');
            
            switch(mode) {
                case 'text':
                    userContent.placeholder = 'Start writing here...';
                    mitoContent.innerHTML = 'MITO is ready to help with writing, editing, and creative content...';
                    break;
                case 'code':
                    userContent.placeholder = '// Start coding here...\nfunction myFunction() {\n    \n}';
                    mitoContent.innerHTML = 'MITO is ready to help with code development, debugging, and optimization...';
                    break;
                case 'image':
                    userContent.placeholder = 'Describe the image you want to create...';
                    mitoContent.innerHTML = 'MITO is ready to generate and modify images based on your descriptions...';
                    break;
                case 'design':
                    userContent.placeholder = 'Describe your design requirements...';
                    mitoContent.innerHTML = 'MITO is ready to help with UI/UX design, layouts, and styling...';
                    break;
            }
            
            addActivityFeedItem(`Switched to ${mode} mode`);
        }

        function updateCollabMode() {
            const mode = document.getElementById('collab-mode').value;
            collabMode = mode;
            addActivityFeedItem(`Changed collaboration mode to ${mode}`);
        }

        function requestMitoHelp() {
            const userContent = document.getElementById('user-content').value;
            if (!userContent.trim()) {
                addActivityFeedItem('Please add some content first');
                return;
            }
            
            addActivityFeedItem('Requesting MITO assistance...');
            
            fetch('/api/generate', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    prompt: `Help me with this ${collabMode} work: ${userContent}`,
                    provider: 'openai'
                })
            })
            .then(response => response.json())
            .then(data => {
                const mitoContent = document.getElementById('mito-content');
                mitoContent.innerHTML = `<div style="color: #4ade80; margin-bottom: 10px;">MITO's Assistance:</div>${data.response}`;
                addActivityFeedItem('MITO provided assistance');
            })
            .catch(error => {
                addActivityFeedItem('Error getting MITO help');
                console.error('Error:', error);
            });
        }

        function generateContent() {
            const userContent = document.getElementById('user-content').value;
            const prompt = userContent.trim() || `Generate ${collabMode} content`;
            
            addActivityFeedItem('MITO generating content...');
            
            fetch('/api/generate', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    prompt: `Generate ${collabMode} content based on: ${prompt}`,
                    provider: 'openai'
                })
            })
            .then(response => response.json())
            .then(data => {
                const mitoContent = document.getElementById('mito-content');
                mitoContent.innerHTML = `<div style="color: #3b82f6; margin-bottom: 10px;">Generated Content:</div>${data.response}`;
                addActivityFeedItem('Content generated by MITO');
            })
            .catch(error => {
                addActivityFeedItem('Error generating content');
                console.error('Error:', error);
            });
        }

        function improveContent() {
            const userContent = document.getElementById('user-content').value;
            if (!userContent.trim()) {
                addActivityFeedItem('Please add content to improve');
                return;
            }
            
            addActivityFeedItem('MITO improving your work...');
            
            fetch('/api/generate', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    prompt: `Improve and optimize this ${collabMode} content: ${userContent}`,
                    provider: 'openai'
                })
            })
            .then(response => response.json())
            .then(data => {
                const mitoContent = document.getElementById('mito-content');
                mitoContent.innerHTML = `<div style="color: #10b981; margin-bottom: 10px;">Improved Version:</div>${data.response}`;
                addActivityFeedItem('Content improved by MITO');
            })
            .catch(error => {
                addActivityFeedItem('Error improving content');
                console.error('Error:', error);
            });
        }

        function reviewContent() {
            const userContent = document.getElementById('user-content').value;
            if (!userContent.trim()) {
                addActivityFeedItem('Please add content to review');
                return;
            }
            
            addActivityFeedItem('MITO reviewing your work...');
            
            fetch('/api/generate', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    prompt: `Review and provide feedback on this ${collabMode} content: ${userContent}`,
                    provider: 'openai'
                })
            })
            .then(response => response.json())
            .then(data => {
                const mitoContent = document.getElementById('mito-content');
                mitoContent.innerHTML = `<div style="color: #f59e0b; margin-bottom: 10px;">MITO's Review:</div>${data.response}`;
                addActivityFeedItem('Review completed by MITO');
            })
            .catch(error => {
                addActivityFeedItem('Error reviewing content');
                console.error('Error:', error);
            });
        }

        function saveCollabSession() {
            const userContent = document.getElementById('user-content').value;
            const mitoContent = document.getElementById('mito-content').innerHTML;
            
            const sessionData = {
                userContent: userContent,
                mitoContent: mitoContent,
                mode: collabMode,
                timestamp: new Date().toISOString()
            };
            
            localStorage.setItem('mito_collab_session', JSON.stringify(sessionData));
            addActivityFeedItem('Session saved successfully');
        }

        function exportCollabWork() {
            const userContent = document.getElementById('user-content').value;
            const mitoContent = document.getElementById('mito-content').textContent;
            
            const exportData = `MITO Collaboration Session - ${new Date().toLocaleDateString()}

YOUR WORK:
${userContent}

MITO'S CONTRIBUTION:
${mitoContent}

Mode: ${collabMode}
Exported: ${new Date().toLocaleString()}`;
            
            const blob = new Blob([exportData], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `mito_collaboration_${Date.now()}.txt`;
            a.click();
            URL.revokeObjectURL(url);
            
            addActivityFeedItem('Work exported successfully');
        }

        function shareCollabSession() {
            const userContent = document.getElementById('user-content').value;
            const shareText = `Working on a ${collabMode} project with MITO AI:\n\n${userContent.substring(0, 100)}${userContent.length > 100 ? '...' : ''}`;
            
            if (navigator.share) {
                navigator.share({
                    title: 'MITO Collaboration Session',
                    text: shareText,
                    url: window.location.href
                });
            } else {
                navigator.clipboard.writeText(shareText);
                addActivityFeedItem('Session details copied to clipboard');
            }
        }

        function clearCollabWorkspace() {
            if (confirm('Clear both your work and MITO\'s contributions?')) {
                document.getElementById('user-content').value = '';
                document.getElementById('mito-content').innerHTML = 'MITO is ready to collaborate...';
                addActivityFeedItem('Workspace cleared');
            }
        }

        function addActivityFeedItem(message) {
            const feed = document.getElementById('activity-feed');
            if (feed) {
                const item = document.createElement('div');
                item.className = 'activity-item mb-2 p-2';
                item.style.cssText = 'background: var(--accent-bg); border-radius: 4px;';
                item.innerHTML = `
                    <div class="text-info">${escapeHtml(message)}</div>
                    <small class="text-muted">Just now</small>
                `;
                feed.insertBefore(item, feed.firstChild);
                
                // Keep only last 10 items
                while (feed.children.length > 10) {
                    feed.removeChild(feed.lastChild);
                }
            }
        }

        // Real-time collaboration monitoring
        function initLiveCollaboration() {
            const userContent = document.getElementById('user-content');
            if (userContent) {
                userContent.addEventListener('input', function() {
                    const currentContent = this.value;
                    if (currentContent !== lastUserContent && currentContent.trim()) {
                        lastUserContent = currentContent;
                        
                        // Auto-suggest after user pauses typing
                        clearTimeout(window.collabTimeout);
                        window.collabTimeout = setTimeout(() => {
                            if (currentContent.trim() && collabMode === 'coding') {
                                suggestCodeCompletion(currentContent);
                            }
                        }, 2000);
                    }
                });
            }
        }

        function suggestCodeCompletion(code) {
            if (code.includes('function') || code.includes('def') || code.includes('class')) {
                const mitoContent = document.getElementById('mito-content');
                mitoContent.innerHTML = `<div style="color: #8b5cf6; margin-bottom: 10px;">Code Suggestions:</div>
                <div>I see you're working on ${code.includes('function') ? 'a function' : code.includes('class') ? 'a class' : 'code'}. 
                Would you like me to help complete it, add error handling, or suggest improvements?</div>`;
                addActivityFeedItem('MITO detected coding activity');
            }
        }

        // Initialize knowledge base when files modal opens
        document.addEventListener('DOMContentLoaded', function() {
            const filesModal = document.getElementById('files-modal');
            if (filesModal) {
                const observer = new MutationObserver(function(mutations) {
                    mutations.forEach(function(mutation) {
                        if (mutation.type === 'attributes' && mutation.attributeName === 'style') {
                            if (filesModal.style.display !== 'none') {
                                refreshKnowledgeBase();
                            }
                        }
                    });
                });
                observer.observe(filesModal, { attributes: true });
            }
            
            // Initialize live collaboration if on that tool
            initLiveCollaboration();
        });

        function createNewFile() {
            const fileName = prompt('Enter file name:');
            if (fileName) {
                addChatMessage('MITO', `Creating new file: ${fileName}`);
                closeFiles();
            }
        }

        // Missing functions that are being called
        function switchTool(toolName) {
            console.log('Loading tool:', toolName);
            
            // Load the appropriate tool
            switch(toolName) {
                case 'phase-manager':
                    loadPhaseManager();
                    break;
                case 'nlu-processor':
                    loadNLUProcessor();
                    break;
                case 'model-trainer':
                    loadModelTrainer();
                    break;
                case 'code-generator':
                    loadCodeGenerator();
                    break;
                case 'ai-factory':
                    loadAIFactory();
                    break;
                case 'package-manager':
                    loadPackageManager();
                    break;
                case 'api-tester':
                    loadAPITester();
                    break;
                case 'utilities':
                    loadUtilities();
                    break;
                case 'system-monitor':
                    loadSystemMonitor();
                    break;
                case 'knowledge-base':
                    loadKnowledgeBase();
                    break;
                case 'collaboration':
                    loadCollaboration();
                    break;
                case 'project-templates':
                    loadProjectTemplates();
                    break;
                case 'agent-builder':
                    loadAgentBuilder();
                    break;
                case 'ecosystem-orchestrator':
                    loadEcosystemOrchestrator();
                    break;
                case 'file-manager':
                    loadFileManager();
                    break;
                case 'database-manager':
                    loadDatabaseManager();
                    break;
                case 'deployment-manager':
                    loadDeploymentManager();
                    break;
                case 'image-generator':
                    loadImageGenerator();
                    break;
                case 'whiteboard':
                    loadWhiteboard();
                    break;
                case 'terminal':
                    loadTerminal();
                    break;
                default:
                    console.log('Unknown tool:', toolName);
            }
        }

        function loadUtilities() {
            const workspace = document.getElementById('main-canvas');
            workspace.innerHTML = `
                <div class="tool-interface">
                    <h3>Utilities</h3>
                    <div class="row">
                        <div class="col-md-6">
                            <div class="card">
                                <div class="card-header">Text Tools</div>
                                <div class="card-body">
                                    <div class="form-group mb-3">
                                        <label>Input Text</label>
                                        <textarea id="util-text" class="form-control" rows="4" placeholder="Enter text to process..."></textarea>
                                    </div>
                                    <div class="btn-group mb-3" role="group">
                                        <button class="btn btn-outline-primary" onclick="processText('uppercase')">UPPERCASE</button>
                                        <button class="btn btn-outline-primary" onclick="processText('lowercase')">lowercase</button>
                                        <button class="btn btn-outline-primary" onclick="processText('capitalize')">Capitalize</button>
                                    </div>
                                    <div class="btn-group mb-3" role="group">
                                        <button class="btn btn-outline-secondary" onclick="processText('wordcount')">Word Count</button>
                                        <button class="btn btn-outline-secondary" onclick="processText('charcount')">Char Count</button>
                                        <button class="btn btn-outline-secondary" onclick="processText('reverse')">Reverse</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="card">
                                <div class="card-header">Result</div>
                                <div class="card-body">
                                    <div id="util-result" style="background: #1a1a1a; color: #f1f5f9; padding: 15px; border-radius: 8px; height: 200px; overflow-y: auto; font-family: monospace; white-space: pre-wrap;">
                                        Processed text will appear here...
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        function loadSystemMonitor() {
            const workspace = document.getElementById('main-canvas');
            workspace.innerHTML = `
                <div class="tool-interface">
                    <h3>System Monitor</h3>
                    <div class="row">
                        <div class="col-md-4">
                            <div class="card">
                                <div class="card-header">System Status</div>
                                <div class="card-body">
                                    <div class="metric mb-3">
                                        <div class="d-flex justify-content-between">
                                            <span>CPU Usage</span>
                                            <span id="cpu-usage">12%</span>
                                        </div>
                                        <div class="progress">
                                            <div class="progress-bar" style="width: 12%"></div>
                                        </div>
                                    </div>
                                    <div class="metric mb-3">
                                        <div class="d-flex justify-content-between">
                                            <span>Memory</span>
                                            <span id="memory-usage">256MB</span>
                                        </div>
                                        <div class="progress">
                                            <div class="progress-bar bg-warning" style="width: 45%"></div>
                                        </div>
                                    </div>
                                    <div class="metric mb-3">
                                        <div class="d-flex justify-content-between">
                                            <span>API Requests</span>
                                            <span id="api-requests">1,245</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-8">
                            <div class="card">
                                <div class="card-header">Activity Log</div>
                                <div class="card-body">
                                    <div id="activity-log" style="background: #1a1a1a; color: #f1f5f9; padding: 15px; border-radius: 8px; height: 300px; overflow-y: auto; font-family: monospace;">
                                        [INFO] System monitoring started
                                        [INFO] API endpoints responding normally
                                        [INFO] Database connection stable
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        function loadKnowledgeBase() {
            const workspace = document.getElementById('main-canvas');
            workspace.innerHTML = `
                <div class="tool-interface">
                    <h3>Knowledge Base</h3>
                    <div class="row">
                        <div class="col-md-4">
                            <div class="card">
                                <div class="card-header">Categories</div>
                                <div class="card-body">
                                    <div class="list-group">
                                        <a href="#" class="list-group-item list-group-item-action active" onclick="loadKnowledgeCategory('development')">
                                            Development
                                        </a>
                                        <a href="#" class="list-group-item list-group-item-action" onclick="loadKnowledgeCategory('ai')">
                                            AI & Machine Learning
                                        </a>
                                        <a href="#" class="list-group-item list-group-item-action" onclick="loadKnowledgeCategory('apis')">
                                            APIs & Integration
                                        </a>
                                        <a href="#" class="list-group-item list-group-item-action" onclick="loadKnowledgeCategory('deployment')">
                                            Deployment
                                        </a>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-8">
                            <div class="card">
                                <div class="card-header">Documentation</div>
                                <div class="card-body">
                                    <div id="knowledge-content">
                                        <h5>Development Best Practices</h5>
                                        <p>Here are some key development principles to follow when using MITO Engine:</p>
                                        <ul>
                                            <li>Use modular architecture for scalable applications</li>
                                            <li>Implement proper error handling and logging</li>
                                            <li>Follow security best practices for API endpoints</li>
                                            <li>Write comprehensive tests for your code</li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        function loadCollaboration() {
            const workspace = document.getElementById('main-canvas');
            workspace.innerHTML = `
                <div class="tool-interface">
                    <h3>Collaboration</h3>
                    <div class="row">
                        <div class="col-md-6">
                            <div class="card">
                                <div class="card-header">Team Members</div>
                                <div class="card-body">
                                    <div class="member-list">
                                        <div class="member-item d-flex align-items-center mb-3">
                                            <div class="avatar bg-primary rounded-circle d-flex align-items-center justify-content-center" style="width: 40px; height: 40px; margin-right: 10px;">
                                                <span class="text-white">DG</span>
                                            </div>
                                            <div>
                                                <strong>Daniel Guzman</strong>
                                                <div class="text-muted small">Owner</div>
                                            </div>
                                            <div class="ms-auto">
                                                <span class="badge bg-success">Online</span>
                                            </div>
                                        </div>
                                    </div>
                                    <button class="btn btn-outline-primary btn-sm">Invite Member</button>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="card">
                                <div class="card-header">Shared Projects</div>
                                <div class="card-body">
                                    <div class="shared-projects">
                                        <div class="project-item mb-3 p-2" style="background: var(--accent-bg); border-radius: 4px;">
                                            <strong>MITO Engine</strong>
                                            <div class="text-muted small">Last updated: 2 minutes ago</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        function loadAIChat() {
            console.log('Loading AI Chat tool');
            switchTool('ai-chat');
        }

        function loadFileManager() {
            console.log('Loading File Manager tool');
            toggleFiles();
        }

        function loadDeployment() {
            console.log('Loading Deployment tool');
            switchTool('deployment');
        }

        function loadSettings() {
            console.log('Loading Settings tool');
            switchTool('settings');
        }

        // Helper functions for utilities
        function processText(action) {
            const text = document.getElementById('util-text').value;
            const result = document.getElementById('util-result');
            
            if (!text.trim()) {
                result.textContent = 'Please enter some text to process.';
                return;
            }
            
            let processed = '';
            switch(action) {
                case 'uppercase':
                    processed = text.toUpperCase();
                    break;
                case 'lowercase':
                    processed = text.toLowerCase();
                    break;
                case 'capitalize':
                    processed = text.split(' ').map(word => 
                        word.charAt(0).toUpperCase() + word.slice(1).toLowerCase()
                    ).join(' ');
                    break;
                case 'wordcount':
                    processed = `Word count: ${text.trim().split(/\s+/).length}`;
                    break;
                case 'charcount':
                    processed = `Character count: ${text.length} (${text.replace(/\s/g, '').length} without spaces)`;
                    break;
                case 'reverse':
                    processed = text.split('').reverse().join('');
                    break;
                default:
                    processed = 'Unknown action';
            }
            
            result.textContent = processed;
        }

        function loadKnowledgeCategory(category) {
            const content = document.getElementById('knowledge-content');
            const categories = {
                'development': {
                    title: 'Development Best Practices',
                    content: `
                        <h5>Development Best Practices</h5>
                        <p>Key principles for building robust applications:</p>
                        <ul>
                            <li>Use modular architecture for scalable applications</li>
                            <li>Implement proper error handling and logging</li>
                            <li>Follow security best practices for API endpoints</li>
                            <li>Write comprehensive tests for your code</li>
                            <li>Use version control effectively</li>
                        </ul>
                    `
                },
                'ai': {
                    title: 'AI & Machine Learning',
                    content: `
                        <h5>AI & Machine Learning</h5>
                        <p>Guidelines for AI development:</p>
                        <ul>
                            <li>Choose appropriate models for your use case</li>
                            <li>Implement proper data preprocessing</li>
                            <li>Monitor model performance and drift</li>
                            <li>Consider ethical implications of AI systems</li>
                        </ul>
                    `
                },
                'apis': {
                    title: 'APIs & Integration',
                    content: `
                        <h5>APIs & Integration</h5>
                        <p>Best practices for API development:</p>
                        <ul>
                            <li>Design RESTful APIs with clear endpoints</li>
                            <li>Implement proper authentication and authorization</li>
                            <li>Use consistent error responses</li>
                            <li>Document your APIs thoroughly</li>
                        </ul>
                    `
                },
                'deployment': {
                    title: 'Deployment',
                    content: `
                        <h5>Deployment Strategies</h5>
                        <p>Deployment best practices:</p>
                        <ul>
                            <li>Use containerization for consistent environments</li>
                            <li>Implement CI/CD pipelines</li>
                            <li>Monitor application performance</li>
                            <li>Plan for rollback strategies</li>
                        </ul>
                    `
                }
            };
            
            const categoryData = categories[category] || categories['development'];
            content.innerHTML = categoryData.content;
            
            // Update active category
            document.querySelectorAll('.list-group-item').forEach(item => {
                item.classList.remove('active');
            });
            event.target.classList.add('active');
        }

        function loadProjectTemplates() {
            const workspace = document.getElementById('main-canvas');
            workspace.innerHTML = `
                <div class="tool-interface">
                    <h3>Project Templates</h3>
                    <div class="row">
                        <div class="col-md-4">
                            <div class="card">
                                <div class="card-header">Template Categories</div>
                                <div class="card-body">
                                    <div class="list-group">
                                        <a href="#" class="list-group-item list-group-item-action active" onclick="loadTemplateCategory('webapp')">
                                            Web Applications
                                        </a>
                                        <a href="#" class="list-group-item list-group-item-action" onclick="loadTemplateCategory('mobile')">
                                            Mobile Apps
                                        </a>
                                        <a href="#" class="list-group-item list-group-item-action" onclick="loadTemplateCategory('api')">
                                            APIs & Backend
                                        </a>
                                        <a href="#" class="list-group-item list-group-item-action" onclick="loadTemplateCategory('ai')">
                                            AI & ML Projects
                                        </a>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-8">
                            <div class="card">
                                <div class="card-header">Available Templates</div>
                                <div class="card-body">
                                    <div id="template-grid" class="row">
                                        <div class="col-md-6 mb-3">
                                            <div class="card border">
                                                <div class="card-body">
                                                    <h6>React + Node.js</h6>
                                                    <p class="small text-muted">Full-stack web application with modern React frontend</p>
                                                    <button class="btn btn-sm btn-primary">Use Template</button>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-md-6 mb-3">
                                            <div class="card border">
                                                <div class="card-body">
                                                    <h6>Vue.js + Express</h6>
                                                    <p class="small text-muted">Progressive web app with Vue.js frontend</p>
                                                    <button class="btn btn-sm btn-primary">Use Template</button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        function loadAgentBuilder() {
            const workspace = document.getElementById('main-canvas');
            workspace.innerHTML = `
                <div class="tool-interface">
                    <h3>AI Agent Builder</h3>
                    <div class="row">
                        <div class="col-md-6">
                            <div class="card">
                                <div class="card-header">Agent Configuration</div>
                                <div class="card-body">
                                    <div class="form-group mb-3">
                                        <label>Agent Name</label>
                                        <input type="text" id="agent-name" class="form-control" placeholder="My AI Agent">
                                    </div>
                                    <div class="form-group mb-3">
                                        <label>Agent Type</label>
                                        <select id="agent-type" class="form-control">
                                            <option value="chatbot">Chatbot</option>
                                            <option value="assistant">Virtual Assistant</option>
                                            <option value="analyzer">Data Analyzer</option>
                                            <option value="generator">Content Generator</option>
                                        </select>
                                    </div>
                                    <div class="form-group mb-3">
                                        <label>Capabilities</label>
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" id="cap-nlp" checked>
                                            <label class="form-check-label" for="cap-nlp">Natural Language Processing</label>
                                        </div>
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" id="cap-vision">
                                            <label class="form-check-label" for="cap-vision">Computer Vision</label>
                                        </div>
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" id="cap-speech">
                                            <label class="form-check-label" for="cap-speech">Speech Recognition</label>
                                        </div>
                                    </div>
                                    <button class="btn btn-primary" onclick="buildAgent()">Build Agent</button>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="card">
                                <div class="card-header">Agent Preview</div>
                                <div class="card-body">
                                    <div id="agent-preview" style="background: #f8f9fa; padding: 20px; border-radius: 8px; min-height: 300px;">
                                        <div class="text-center text-muted">
                                            Configure your agent to see preview
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        function loadEcosystemOrchestrator() {
            const workspace = document.getElementById('main-canvas');
            workspace.innerHTML = `
                <div class="tool-interface">
                    <h3>Ecosystem Orchestrator</h3>
                    <div class="row">
                        <div class="col-md-8">
                            <div class="card">
                                <div class="card-header">System Architecture</div>
                                <div class="card-body">
                                    <div id="ecosystem-diagram" style="background: #f8f9fa; padding: 20px; border-radius: 8px; min-height: 400px; position: relative;">
                                        <div class="text-center" style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);">
                                            <div class="text-muted">
                                                <h5>MITO Ecosystem</h5>
                                                <p>Orchestrating AI services and components</p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="card">
                                <div class="card-header">Active Services</div>
                                <div class="card-body">
                                    <div class="service-item mb-3">
                                        <div class="d-flex justify-content-between align-items-center">
                                            <span>AI Engine</span>
                                            <span class="badge bg-success">Active</span>
                                        </div>
                                    </div>
                                    <div class="service-item mb-3">
                                        <div class="d-flex justify-content-between align-items-center">
                                            <span>Code Generator</span>
                                            <span class="badge bg-success">Active</span>
                                        </div>
                                    </div>
                                    <div class="service-item mb-3">
                                        <div class="d-flex justify-content-between align-items-center">
                                            <span>Package Manager</span>
                                            <span class="badge bg-warning">Standby</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        function loadTemplateCategory(category) {
            // This function would load different template categories
            console.log('Loading template category:', category);
        }

        function buildAgent() {
            const name = document.getElementById('agent-name').value;
            const type = document.getElementById('agent-type').value;
            
            if (!name.trim()) {
                alert('Please enter an agent name');
                return;
            }
            
            const preview = document.getElementById('agent-preview');
            preview.innerHTML = `
                <div class="text-center">
                    <h5>${name}</h5>
                    <p class="text-muted">${type.charAt(0).toUpperCase() + type.slice(1)} Agent</p>
                    <div class="spinner-border text-primary" role="status">
                        <span class="visually-hidden">Building...</span>
                    </div>
                    <p class="small mt-2">Building your AI agent...</p>
                </div>
            `;
            
            setTimeout(() => {
                preview.innerHTML = `
                    <div class="text-center">
                        <h5>${name}</h5>
                        <p class="text-muted">${type.charAt(0).toUpperCase() + type.slice(1)} Agent</p>
                        <div class="alert alert-success">
                            Agent built successfully!
                        </div>
                        <button class="btn btn-primary btn-sm">Deploy Agent</button>
                        <button class="btn btn-secondary btn-sm ms-2">Test Agent</button>
                    </div>
                `;
            }, 2000);
        }

        function loadFileManager() {
            toggleFiles();
        }

        function loadDatabaseManager() {
            const workspace = document.getElementById('main-canvas');
            workspace.innerHTML = `
                <div class="tool-interface">
                    <h3>Database Manager</h3>
                    <div class="row">
                        <div class="col-md-4">
                            <div class="card">
                                <div class="card-header">Database Connection</div>
                                <div class="card-body">
                                    <div class="form-group mb-3">
                                        <label>Database Type</label>
                                        <select class="form-control">
                                            <option>PostgreSQL</option>
                                            <option>MySQL</option>
                                            <option>MongoDB</option>
                                            <option>SQLite</option>
                                        </select>
                                    </div>
                                    <div class="connection-status">
                                        <span class="badge bg-success">Connected</span>
                                        <small class="text-muted">PostgreSQL Database</small>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-8">
                            <div class="card">
                                <div class="card-header">Query Editor</div>
                                <div class="card-body">
                                    <textarea class="form-control mb-3" rows="8" placeholder="SELECT * FROM users;">SELECT * FROM users;</textarea>
                                    <button class="btn btn-primary">Execute Query</button>
                                    <button class="btn btn-secondary ms-2">Save Query</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        function loadDeploymentManager() {
            const workspace = document.getElementById('main-canvas');
            workspace.innerHTML = `
                <div class="tool-interface">
                    <h3>Deployment Manager</h3>
                    <div class="row">
                        <div class="col-md-6">
                            <div class="card">
                                <div class="card-header">Deploy to Production</div>
                                <div class="card-body">
                                    <div class="form-group mb-3">
                                        <label>Environment</label>
                                        <select class="form-control">
                                            <option>Production</option>
                                            <option>Staging</option>
                                            <option>Development</option>
                                        </select>
                                    </div>
                                    <div class="form-group mb-3">
                                        <label>Deployment Method</label>
                                        <select class="form-control">
                                            <option>Docker Container</option>
                                            <option>Traditional Server</option>
                                            <option>Serverless</option>
                                        </select>
                                    </div>
                                    <button class="btn btn-success">Deploy Now</button>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="card">
                                <div class="card-header">Deployment Status</div>
                                <div class="card-body">
                                    <div class="deployment-item mb-3">
                                        <div class="d-flex justify-content-between">
                                            <span>Production</span>
                                            <span class="badge bg-success">Active</span>
                                        </div>
                                        <small class="text-muted">Last deployed: 2 hours ago</small>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        function loadImageGenerator() {
            const workspace = document.getElementById('main-canvas');
            workspace.innerHTML = `
                <div class="tool-interface">
                    <h3>Image Generator</h3>
                    <div class="row">
                        <div class="col-md-6">
                            <div class="card">
                                <div class="card-header">Generate Image</div>
                                <div class="card-body">
                                    <div class="form-group mb-3">
                                        <label>Image Description</label>
                                        <textarea class="form-control" rows="4" placeholder="Describe the image you want to generate..."></textarea>
                                    </div>
                                    <div class="form-group mb-3">
                                        <label>Style</label>
                                        <select class="form-control">
                                            <option>Realistic</option>
                                            <option>Artistic</option>
                                            <option>Cartoon</option>
                                            <option>Abstract</option>
                                        </select>
                                    </div>
                                    <button class="btn btn-primary">Generate Image</button>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="card">
                                <div class="card-header">Generated Image</div>
                                <div class="card-body">
                                    <div style="background: #f8f9fa; height: 300px; display: flex; align-items: center; justify-content: center; border-radius: 8px;">
                                        <span class="text-muted">Generated image will appear here</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        function loadWhiteboard() {
            const workspace = document.getElementById('main-canvas');
            workspace.innerHTML = `
                <div class="tool-interface">
                    <h3>Interactive Whiteboard</h3>
                    <div class="card">
                        <div class="card-header d-flex justify-content-between align-items-center">
                            <span>Drawing Canvas</span>
                            <div>
                                <button class="btn btn-sm btn-outline-primary">Clear</button>
                                <button class="btn btn-sm btn-outline-secondary">Save</button>
                            </div>
                        </div>
                        <div class="card-body">
                            <canvas id="whiteboard-canvas" width="800" height="400" style="border: 1px solid #ddd; width: 100%; background: white;"></canvas>
                        </div>
                    </div>
                </div>
            `;
        }

        function loadTerminal() {
            const workspace = document.getElementById('main-canvas');
            workspace.innerHTML = `
                <div class="tool-interface">
                    <h3>Terminal</h3>
                    <div class="card">
                        <div class="card-header">Command Line Interface</div>
                        <div class="card-body">
                            <div id="terminal-output" style="background: #1a1a1a; color: #00ff00; padding: 15px; border-radius: 8px; height: 400px; overflow-y: auto; font-family: monospace;">
$ MITO Terminal v1.0.0
$ Ready for commands...
                            </div>
                            <div class="input-group mt-3">
                                <span class="input-group-text">$</span>
                                <input type="text" class="form-control" id="terminal-input" placeholder="Enter command..." style="font-family: monospace;">
                                <button class="btn btn-success" onclick="executeCommand()">Execute</button>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        function executeCommand() {
            const input = document.getElementById('terminal-input');
            const output = document.getElementById('terminal-output');
            const command = input.value.trim();
            
            if (command) {
                output.innerHTML += `\n$ ${command}\n`;
                
                // Simulate command execution
                setTimeout(() => {
                    output.innerHTML += `Command executed: ${command}\n`;
                    output.scrollTop = output.scrollHeight;
                }, 500);
                
                input.value = '';
            }
        }
    </script>
</body>
</html>